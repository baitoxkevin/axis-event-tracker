(()=>{var a={};a.id=841,a.ids=[841],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},434:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"00253ae66b66cbc5bfc0864290f6e3843dbd481aae":()=>d.O});var d=c(14021)},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(71237),e=c(55088),f=c(17679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14021:(a,b,c)=>{"use strict";c.d(b,{O:()=>g});var d=c(75879);c(68633);var e=c(23802),f=c(86802);async function g(){let a="https://myzzbxhbyiobkmuquwun.supabase.co",b="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15enpieGhieWlvYmttdXF1d3VuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNzE0NjcsImV4cCI6MjA3OTY0NzQ2N30.GvNA4g1zBSSUufkCx52NFLaGbgriwQXCXOPhj3WUEwM";if(!a||!b)return null;let c=await (0,f.UL)();return(0,e.createServerClient)(a,b,{cookies:{getAll:()=>c.getAll(),setAll(a){try{a.forEach(({name:a,value:b,options:d})=>c.set(a,b,d))}catch{}}}})}(0,c(51669).D)([g]),(0,d.A)(g,"00253ae66b66cbc5bfc0864290f6e3843dbd481aae",null)},14369:(a,b,c)=>{"use strict";c.d(b,{db:()=>h});var d=c(41237),e=c(49122),f=c(30314);let g=process.env.DATABASE_URL,h=null;if(g){let a=(0,e.A)(g,{prepare:!1});h=(0,d.f)(a,{schema:f})}},21820:a=>{"use strict";a.exports=require("os")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30314:(a,b,c)=>{"use strict";c.r(b),c.d(b,{auditLogs:()=>v,auditLogsRelations:()=>C,chatbotConversations:()=>D,chatbotConversationsRelations:()=>F,chatbotMessages:()=>E,chatbotMessagesRelations:()=>G,guestTransportAssignments:()=>t,guestTransportAssignmentsRelations:()=>A,guests:()=>q,guestsRelations:()=>x,importSessions:()=>u,importSessionsRelations:()=>B,transportSchedules:()=>s,transportSchedulesRelations:()=>z,users:()=>p,usersRelations:()=>w,vehicles:()=>r,vehiclesRelations:()=>y});var d=c(67969),e=c(29205),f=c(57789),g=c(62352),h=c(46886),i=c(19831),j=c(4396),k=c(84266),l=c(65828),m=c(29745),n=c(94728),o=c(98445);let p=(0,d.cJ)("users",{id:(0,e.uR)("id").defaultRandom().primaryKey(),email:(0,f.yf)("email",{length:255}).notNull().unique(),name:(0,f.yf)("name",{length:255}).notNull(),role:(0,f.yf)("role",{length:50}).notNull().$type(),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,g.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),q=(0,d.cJ)("guests",{id:(0,e.uR)("id").defaultRandom().primaryKey(),externalId:(0,f.yf)("external_id",{length:50}),email:(0,f.yf)("email",{length:255}).notNull(),firstName:(0,f.yf)("first_name",{length:100}).notNull(),lastName:(0,f.yf)("last_name",{length:100}).notNull(),axisEmail:(0,f.yf)("axis_email",{length:255}),reportingLevel1:(0,f.yf)("reporting_level_1",{length:100}),reportingLevel2:(0,f.yf)("reporting_level_2",{length:100}),reportingLevel3:(0,f.yf)("reporting_level_3",{length:100}),function:(0,f.yf)("function",{length:100}),location:(0,f.yf)("location",{length:100}),arrivalDate:(0,h.p6)("arrival_date"),arrivalTime:(0,i.kB)("arrival_time"),arrivalFlightNumber:(0,f.yf)("arrival_flight_number",{length:20}),arrivalAirport:(0,f.yf)("arrival_airport",{length:100}),arrivalFlightRoute:(0,f.yf)("arrival_flight_route",{length:50}),arrivalTerminal:(0,f.yf)("arrival_terminal",{length:20}),arrivalGate:(0,f.yf)("arrival_gate",{length:20}),arrivalVerifiedTime:(0,i.kB)("arrival_verified_time"),arrivalFlightStatus:(0,f.yf)("arrival_flight_status",{length:50}).$type(),arrivalVerifiedAt:(0,g.vE)("arrival_verified_at",{withTimezone:!0}),arrivalTimeMismatch:(0,j.zM)("arrival_time_mismatch").default(!1),departureDate:(0,h.p6)("departure_date"),departureTime:(0,i.kB)("departure_time"),departureFlightNumber:(0,f.yf)("departure_flight_number",{length:20}),departureAirport:(0,f.yf)("departure_airport",{length:100}),departureFlightRoute:(0,f.yf)("departure_flight_route",{length:50}),departureTerminal:(0,f.yf)("departure_terminal",{length:20}),departureGate:(0,f.yf)("departure_gate",{length:20}),departureVerifiedTime:(0,i.kB)("departure_verified_time"),departureFlightStatus:(0,f.yf)("departure_flight_status",{length:50}).$type(),departureVerifiedAt:(0,g.vE)("departure_verified_at",{withTimezone:!0}),departureTimeMismatch:(0,j.zM)("departure_time_mismatch").default(!1),hotelCheckinDate:(0,h.p6)("hotel_checkin_date"),hotelCheckoutDate:(0,h.p6)("hotel_checkout_date"),extendStayBefore:(0,j.zM)("extend_stay_before").default(!1),extendStayAfter:(0,j.zM)("extend_stay_after").default(!1),earlyCheckin:(0,f.yf)("early_checkin",{length:50}),lateCheckout:(0,f.yf)("late_checkout",{length:50}),needsArrivalTransfer:(0,j.zM)("needs_arrival_transfer"),needsDepartureTransfer:(0,j.zM)("needs_departure_transfer"),registrationStatus:(0,f.yf)("registration_status",{length:50}).default("pending").$type(),travelType:(0,f.yf)("travel_type",{length:50}),isDuplicate:(0,j.zM)("is_duplicate").default(!1),isRemoved:(0,j.zM)("is_removed").default(!1),version:(0,k.nd)("version").default(1).notNull(),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,g.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull(),deletedAt:(0,g.vE)("deleted_at",{withTimezone:!0})},a=>[(0,l.GL)("guests_email_unique").on(a.email),(0,l.Pe)("idx_guests_arrival").on(a.arrivalDate),(0,l.Pe)("idx_guests_departure").on(a.departureDate),(0,l.Pe)("idx_guests_status").on(a.registrationStatus)]),r=(0,d.cJ)("vehicles",{id:(0,e.uR)("id").defaultRandom().primaryKey(),name:(0,f.yf)("name",{length:100}).notNull(),type:(0,f.yf)("type",{length:50}).notNull(),capacity:(0,k.nd)("capacity").notNull(),driverName:(0,f.yf)("driver_name",{length:100}),driverPhone:(0,f.yf)("driver_phone",{length:50}),licensePlate:(0,f.yf)("license_plate",{length:20}),isActive:(0,j.zM)("is_active").default(!0),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,g.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),s=(0,d.cJ)("transport_schedules",{id:(0,e.uR)("id").defaultRandom().primaryKey(),vehicleId:(0,e.uR)("vehicle_id").references(()=>r.id),direction:(0,f.yf)("direction",{length:20}).notNull().$type(),scheduleDate:(0,h.p6)("schedule_date").notNull(),pickupTime:(0,i.kB)("pickup_time").notNull(),pickupLocation:(0,f.yf)("pickup_location",{length:255}),dropoffLocation:(0,f.yf)("dropoff_location",{length:255}),status:(0,f.yf)("status",{length:50}).default("scheduled").$type(),notes:(0,m.Qq)("notes"),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,g.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,l.Pe)("idx_transport_date").on(a.scheduleDate),(0,l.Pe)("idx_transport_vehicle").on(a.vehicleId)]),t=(0,d.cJ)("guest_transport_assignments",{id:(0,e.uR)("id").defaultRandom().primaryKey(),guestId:(0,e.uR)("guest_id").references(()=>q.id).notNull(),scheduleId:(0,e.uR)("schedule_id").references(()=>s.id).notNull(),assignmentType:(0,f.yf)("assignment_type",{length:20}).notNull().$type(),status:(0,f.yf)("status",{length:50}).default("assigned").$type(),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,l.GL)("guest_assignment_unique").on(a.guestId,a.assignmentType),(0,l.Pe)("idx_assignment_schedule").on(a.scheduleId)]),u=(0,d.cJ)("import_sessions",{id:(0,e.uR)("id").defaultRandom().primaryKey(),filename:(0,f.yf)("filename",{length:255}).notNull(),fileHash:(0,f.yf)("file_hash",{length:64}),uploadedBy:(0,e.uR)("uploaded_by").references(()=>p.id),status:(0,f.yf)("status",{length:50}).default("pending").$type(),totalRows:(0,k.nd)("total_rows"),rowsAdded:(0,k.nd)("rows_added").default(0),rowsModified:(0,k.nd)("rows_modified").default(0),rowsRemoved:(0,k.nd)("rows_removed").default(0),rowsUnchanged:(0,k.nd)("rows_unchanged").default(0),rowsError:(0,k.nd)("rows_error").default(0),errorDetails:(0,n.Fx)("error_details"),startedAt:(0,g.vE)("started_at",{withTimezone:!0}),completedAt:(0,g.vE)("completed_at",{withTimezone:!0}),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull()}),v=(0,d.cJ)("audit_logs",{id:(0,e.uR)("id").defaultRandom().primaryKey(),entityType:(0,f.yf)("entity_type",{length:50}).notNull().$type(),entityId:(0,e.uR)("entity_id").notNull(),action:(0,f.yf)("action",{length:20}).notNull().$type(),changes:(0,n.Fx)("changes").notNull().$type(),changeSource:(0,f.yf)("change_source",{length:20}).$type(),importSessionId:(0,e.uR)("import_session_id").references(()=>u.id),performedBy:(0,e.uR)("performed_by").references(()=>p.id),performedAt:(0,g.vE)("performed_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,l.Pe)("idx_audit_entity").on(a.entityType,a.entityId),(0,l.Pe)("idx_audit_timestamp").on(a.performedAt)]),w=(0,o.K1)(p,({many:a})=>({auditLogs:a(v),importSessions:a(u)})),x=(0,o.K1)(q,({many:a})=>({transportAssignments:a(t)})),y=(0,o.K1)(r,({many:a})=>({schedules:a(s)})),z=(0,o.K1)(s,({one:a,many:b})=>({vehicle:a(r,{fields:[s.vehicleId],references:[r.id]}),assignments:b(t)})),A=(0,o.K1)(t,({one:a})=>({guest:a(q,{fields:[t.guestId],references:[q.id]}),schedule:a(s,{fields:[t.scheduleId],references:[s.id]})})),B=(0,o.K1)(u,({one:a,many:b})=>({uploadedByUser:a(p,{fields:[u.uploadedBy],references:[p.id]}),auditLogs:b(v)})),C=(0,o.K1)(v,({one:a})=>({performedByUser:a(p,{fields:[v.performedBy],references:[p.id]}),importSession:a(u,{fields:[v.importSessionId],references:[u.id]})})),D=(0,d.cJ)("chatbot_conversations",{id:(0,e.uR)("id").defaultRandom().primaryKey(),userId:(0,e.uR)("user_id").references(()=>p.id),sessionId:(0,f.yf)("session_id",{length:100}).notNull(),title:(0,f.yf)("title",{length:255}),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,g.vE)("updated_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,l.Pe)("idx_conversation_user").on(a.userId),(0,l.Pe)("idx_conversation_session").on(a.sessionId)]),E=(0,d.cJ)("chatbot_messages",{id:(0,e.uR)("id").defaultRandom().primaryKey(),conversationId:(0,e.uR)("conversation_id").references(()=>D.id).notNull(),role:(0,f.yf)("role",{length:20}).notNull().$type(),content:(0,m.Qq)("content").notNull(),metadata:(0,n.Fx)("metadata").$type(),createdAt:(0,g.vE)("created_at",{withTimezone:!0}).defaultNow().notNull()},a=>[(0,l.Pe)("idx_message_conversation").on(a.conversationId),(0,l.Pe)("idx_message_created").on(a.createdAt)]),F=(0,o.K1)(D,({one:a,many:b})=>({user:a(p,{fields:[D.userId],references:[p.id]}),messages:b(E)})),G=(0,o.K1)(E,({one:a})=>({conversation:a(D,{fields:[E.conversationId],references:[D.id]})}))},34631:a=>{"use strict";a.exports=require("tls")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48152:(a,b,c)=>{"use strict";c.d(b,{$:()=>f,U:()=>g});var d=c(23802),e=c(86802);function f(){return!0}async function g(){let a="https://myzzbxhbyiobkmuquwun.supabase.co",b="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15enpieGhieWlvYmttdXF1d3VuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwNzE0NjcsImV4cCI6MjA3OTY0NzQ2N30.GvNA4g1zBSSUufkCx52NFLaGbgriwQXCXOPhj3WUEwM";if(!a||!b)return null;let c=await (0,e.UL)();return(0,d.createServerClient)(a,b,{cookies:{getAll:()=>c.getAll(),setAll(a){try{a.forEach(({name:a,value:b,options:d})=>c.set(a,b,d))}catch{}}}})}},51669:(a,b)=>{"use strict";function c(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(b,"D",{enumerable:!0,get:function(){return c}})},55511:a=>{"use strict";a.exports=require("crypto")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68633:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{decryptActionBoundArgs:function(){return s},encryptActionBoundArgs:function(){return r}}),c(77925);let d=c(97954),e=c(27825),f=c(47686),g=c(77533),h=c(63033),i=c(26906),j=function(a){return a&&a.__esModule?a:{default:a}}(c(74515)),k=new TextEncoder,l=new TextDecoder,m=void 0,n=void 0;async function o(a,b){let c=await (0,g.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=atob(b),e=d.slice(0,16),f=d.slice(16),h=l.decode(await (0,g.decrypt)(c,(0,g.stringToUint8Array)(e),(0,g.stringToUint8Array)(f)));if(!h.startsWith(a))throw Object.defineProperty(Error("Invalid Server Action payload: failed to decrypt."),"__NEXT_ERROR_CODE",{value:"E191",enumerable:!1,configurable:!0});return h.slice(a.length)}async function p(a,b){let c=await (0,g.getActionEncryptionKey)();if(void 0===c)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let d=new Uint8Array(16);h.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(d));let e=(0,g.arrayBufferToString)(d.buffer),f=await (0,g.encrypt)(c,d,k.encode(a+b));return btoa(e+(0,g.arrayBufferToString)(f))}var q=function(a){return a[a.Ready=0]="Ready",a[a.Pending=1]="Pending",a[a.Complete=2]="Complete",a}(q||{});let r=j.default.cache(async function a(b,...c){let e=h.workUnitAsyncStorage.getStore(),j=e?(0,h.getCacheSignal)(e):void 0,{clientModules:k}=(0,g.getClientReferenceManifestForRsc)(),l=Error();Error.captureStackTrace(l,a);let n=!1,o=e?(0,i.createHangingInputAbortSignal)(e):void 0,q=0;function r(){0===q&&(q=1,null==j||j.beginRead())}function s(){1===q&&(null==j||j.endRead()),q=2}o&&j&&o.addEventListener("abort",r,{once:!0});let t=await (0,f.streamToString)((0,d.renderToReadableStream)(c,k,{filterStackFrame:m,signal:o,onError(a){(null==o||!o.aborted)&&(n||(n=!0,l.message=a instanceof Error?a.message:String(a)))}}),o);if(n)throw s(),l;if(!e)return p(b,t);r();let u=(0,h.getPrerenderResumeDataCache)(e),v=(0,h.getRenderResumeDataCache)(e),w=b+t,x=(null==u?void 0:u.encryptedBoundArgs.get(w))??(null==v?void 0:v.encryptedBoundArgs.get(w));if(x)return x;let y=await p(b,t);return s(),null==u||u.encryptedBoundArgs.set(w,y),y});async function s(a,b){let c,d=await b,f=h.workUnitAsyncStorage.getStore();if(f){let b=(0,h.getCacheSignal)(f),e=(0,h.getPrerenderResumeDataCache)(f),g=(0,h.getRenderResumeDataCache)(f);(c=(null==e?void 0:e.decryptedBoundArgs.get(d))??(null==g?void 0:g.decryptedBoundArgs.get(d)))||(null==b||b.beginRead(),c=await o(a,d),null==b||b.endRead(),null==e||e.decryptedBoundArgs.set(d,c))}else c=await o(a,d);let{edgeRscModuleMapping:i,rscModuleMapping:j}=(0,g.getClientReferenceManifestForRsc)();return await (0,e.createFromReadableStream)(new ReadableStream({start(a){switch(a.enqueue(k.encode(c)),null==f?void 0:f.type){case"prerender":case"prerender-runtime":f.renderSignal.aborted?a.close():f.renderSignal.addEventListener("abort",()=>a.close(),{once:!0});break;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":case void 0:return a.close()}}}),{findSourceMapURL:n,serverConsumerManifest:{moduleLoading:null,moduleMap:j,serverModuleMap:(0,g.getServerModuleMap)()}})}},74998:a=>{"use strict";a.exports=require("perf_hooks")},75879:(a,b,c)=>{"use strict";Object.defineProperty(b,"A",{enumerable:!0,get:function(){return d.registerServerReference}});let d=c(97954)},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},91725:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{handler:()=>hF,patchFetch:()=>hE,routeModule:()=>hA,serverHooks:()=>hD,workAsyncStorage:()=>hB,workUnitAsyncStorage:()=>hC});var e,f,g,h,i,j,k,l={};c.r(l),c.d(l,{GET:()=>hz,POST:()=>hz});var m=c(95736),n=c(9117),o=c(4044),p=c(39326),q=c(32324),r=c(261),s=c(54290),t=c(85328),u=c(38928),v=c(46595),w=c(3421),x=c(17679),y=c(41681),z=c(63446),A=c(86439),B=c(51356);let C={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,BAD_GATEWAY:-32603,SERVICE_UNAVAILABLE:-32603,GATEWAY_TIMEOUT:-32603,UNAUTHORIZED:-32001,PAYMENT_REQUIRED:-32002,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNSUPPORTED_MEDIA_TYPE:-32015,UNPROCESSABLE_CONTENT:-32022,PRECONDITION_REQUIRED:-32028,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099},D={[-32700]:"PARSE_ERROR",[-32600]:"BAD_REQUEST",[-32603]:"INTERNAL_SERVER_ERROR",[-32001]:"UNAUTHORIZED",[-32002]:"PAYMENT_REQUIRED",[-32003]:"FORBIDDEN",[-32004]:"NOT_FOUND",[-32005]:"METHOD_NOT_SUPPORTED",[-32008]:"TIMEOUT",[-32009]:"CONFLICT",[-32012]:"PRECONDITION_FAILED",[-32013]:"PAYLOAD_TOO_LARGE",[-32015]:"UNSUPPORTED_MEDIA_TYPE",[-32022]:"UNPROCESSABLE_CONTENT",[-32028]:"PRECONDITION_REQUIRED",[-32029]:"TOO_MANY_REQUESTS",[-32099]:"CLIENT_CLOSED_REQUEST"};function E(a,...b){let c=Object.assign(Object.create(null),a);for(let a of b)for(let b in a){if(b in c&&c[b]!==a[b])throw Error(`Duplicate key ${b}`);c[b]=a[b]}return c}function F(a){return!!a&&!Array.isArray(a)&&"object"==typeof a}function G(a){return"function"==typeof a}function H(a){return Object.assign(Object.create(null),a)}C.BAD_GATEWAY,C.SERVICE_UNAVAILABLE,C.GATEWAY_TIMEOUT,C.INTERNAL_SERVER_ERROR;let I="function"==typeof Symbol&&!!Symbol.asyncIterator;function J(a){return I&&F(a)&&Symbol.asyncIterator in a}let K=a=>a();function L(a){return a}var M=Object.create,N=Object.defineProperty,O=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyNames,Q=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,S=(a,b)=>function(){return b||(0,a[P(a)[0]])((b={exports:{}}).exports,b),b.exports},T=(a,b,c)=>(c=null!=a?M(Q(a)):{},((a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(var e,f=P(b),g=0,h=f.length;g<h;g++)e=f[g],R.call(a,e)||e===c||N(a,e,{get:(a=>b[a]).bind(null,e),enumerable:!(d=O(b,e))||d.enumerable});return a})(!b&&a&&a.__esModule?c:N(c,"default",{value:a,enumerable:!0}),a));let U=()=>{},V=a=>{Object.freeze&&Object.freeze(a)},W={PARSE_ERROR:400,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_SUPPORTED:405,TIMEOUT:408,CONFLICT:409,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,UNSUPPORTED_MEDIA_TYPE:415,UNPROCESSABLE_CONTENT:422,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,CLIENT_CLOSED_REQUEST:499,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504};function X(a){var b;return null!=(b=W[a])?b:500}var Y=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/typeof.js"(a,b){function c(a){return b.exports=c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b.exports.__esModule=!0,b.exports.default=b.exports,c(a)}b.exports=c,b.exports.__esModule=!0,b.exports.default=b.exports}}),Z=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPrimitive.js"(a,b){var c=Y().default;b.exports=function(a,b){if("object"!=c(a)||!a)return a;var d=a[Symbol.toPrimitive];if(void 0!==d){var e=d.call(a,b||"default");if("object"!=c(e))return e;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)},b.exports.__esModule=!0,b.exports.default=b.exports}}),$=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/toPropertyKey.js"(a,b){var c=Y().default,d=Z();b.exports=function(a){var b=d(a,"string");return"symbol"==c(b)?b:b+""},b.exports.__esModule=!0,b.exports.default=b.exports}}),_=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/defineProperty.js"(a,b){var c=$();b.exports=function(a,b,d){return(b=c(b))in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d,a},b.exports.__esModule=!0,b.exports.default=b.exports}}),aa=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/objectSpread2.js"(a,b){var c=_();function d(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}b.exports=function(a){for(var b=1;b<arguments.length;b++){var e=null!=arguments[b]?arguments[b]:{};b%2?d(Object(e),!0).forEach(function(b){c(a,b,e[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(e,b))})}return a},b.exports.__esModule=!0,b.exports.default=b.exports}}),ab=T(aa(),1);function ac(a){let{path:b,error:c,config:d}=a,{code:e}=a.error,f={message:c.message,code:C[e],data:{code:e,httpStatus:X(c.code)}};return d.isDev&&"string"==typeof a.error.stack&&(f.data.stack=a.error.stack),"string"==typeof b&&(f.data.path=b),d.errorFormatter((0,ab.default)((0,ab.default)({},a),{},{shape:f}))}let ad=({shape:a})=>a;var ae=T(_(),1),af=class extends Error{};function ag(a){if(a instanceof ah||a instanceof Error&&"TRPCError"===a.name)return a;let b=new ah({code:"INTERNAL_SERVER_ERROR",cause:a});return a instanceof Error&&a.stack&&(b.stack=a.stack),b}var ah=class extends Error{constructor(a){var b,c;let d=function(a){if(a instanceof Error)return a;let b=typeof a;if("undefined"!==b&&"function"!==b&&null!==a){if("object"!==b)return Error(String(a));if(F(a))return Object.assign(new af,a)}}(a.cause);super(null!=(b=null!=(c=a.message)?c:null==d?void 0:d.message)?b:a.code,{cause:d}),(0,ae.default)(this,"cause",void 0),(0,ae.default)(this,"code",void 0),this.code=a.code,this.name="TRPCError",null!=this.cause||(this.cause=d)}},ai=T(aa(),1);let aj={input:{serialize:a=>a,deserialize:a=>a},output:{serialize:a=>a,deserialize:a=>a}};function ak(a,b){return"error"in b?(0,ai.default)((0,ai.default)({},b),{},{error:a.transformer.output.serialize(b.error)}):"data"in b.result?(0,ai.default)((0,ai.default)({},b),{},{result:(0,ai.default)((0,ai.default)({},b.result),{},{data:a.transformer.output.serialize(b.result.data)})}):b}function al(a,b){return Array.isArray(b)?b.map(b=>ak(a,b)):ak(a,b)}var am=T(aa(),1);let an={_ctx:null,_errorShape:null,_meta:null,queries:{},mutations:{},subscriptions:{},errorFormatter:ad,transformer:aj},ao=["then","call","apply"];function ap(a){return function(b){let c=new Set(Object.keys(b).filter(a=>ao.includes(a)));if(c.size>0)throw Error("Reserved words used in `router({})` call: "+Array.from(c).join(", "));let d=H({}),e=H({}),f=function a(b,c=[]){let f=H({});for(let[g,h]of Object.entries(null!=b?b:{})){if("function"==typeof h&&"lazyMarker"in h){e[[...c,g].join(".")]=function b(c){return{ref:c.ref,load:function(a){let b=Symbol(),c=b;return()=>(c===b&&(c=a()),c)}(async()=>{let d=await c.ref(),f=[...c.path,c.key],g=f.join(".");for(let[h,i]of(c.aggregate[c.key]=a(d._def.record,f),delete e[g],Object.entries(d._def.lazy)))e[[...f,h].join(".")]=b({ref:i.ref,path:f,key:h,aggregate:c.aggregate[c.key]})})}}({path:c,ref:h,key:g,aggregate:f});continue}if(F(h)&&F(h._def)&&"router"in h._def){f[g]=a(h._def.record,[...c,g]);continue}if("function"!=typeof h){f[g]=a(h,[...c,g]);continue}let b=[...c,g].join(".");if(d[b])throw Error(`Duplicate key: ${b}`);d[b]=h,f[g]=h}return f}(b),g=(0,am.default)((0,am.default)({_config:a,router:!0,procedures:d,lazy:e},an),{},{record:f});return(0,am.default)((0,am.default)({},f),{},{_def:g,createCaller:ar()({_def:g})})}}async function aq(a,b){let{_def:c}=a,d=c.procedures[b];for(;!d;){let a=Object.keys(c.lazy).find(a=>b.startsWith(a));if(!a)return null;let e=c.lazy[a];await e.load(),d=c.procedures[b]}return d}function ar(){return function(a){let{_def:b}=a;return function(c,d){return function a(b,c,d){let e=c.join(".");return null!=d[e]||(d[e]=new Proxy(U,{get(e,f){if("string"==typeof f&&"then"!==f)return a(b,[...c,f],d)},apply(a,d,e){let f=c[c.length-1],g={args:e,path:c};return"call"===f?g={args:e.length>=2?[e[1]]:[],path:c.slice(0,-1)}:"apply"===f&&(g={args:e.length>=2?e[1]:[],path:c.slice(0,-1)}),V(g.args),V(g.path),b(g)}})),d[e]}(async e=>{let f,{path:g,args:h}=e,i=g.join(".");if(1===g.length&&"_def"===g[0])return b;let j=await aq(a,i);try{if(!j)throw new ah({code:"NOT_FOUND",message:`No procedure found on path "${g}"`});return f=G(c)?await Promise.resolve(c()):c,await j({path:i,getRawInput:async()=>h[0],ctx:f,type:j._def.type,signal:null==d?void 0:d.signal})}catch(a){var k,l;throw null==d||null==(k=d.onError)||k.call(d,{ctx:f,error:ag(a),input:h[0],path:i,type:null!=(l=null==j?void 0:j._def.type)?l:"unknown"}),a}},[],Object.create(null))}}}function as(...a){var b,c;let d=E({},...a.map(a=>a._def.record));return ap({errorFormatter:a.reduce((a,b)=>{if(b._def._config.errorFormatter&&b._def._config.errorFormatter!==ad){if(a!==ad&&a!==b._def._config.errorFormatter)throw Error("You seem to have several error formatters");return b._def._config.errorFormatter}return a},ad),transformer:a.reduce((a,b)=>{if(b._def._config.transformer&&b._def._config.transformer!==aj){if(a!==aj&&a!==b._def._config.transformer)throw Error("You seem to have several transformers");return b._def._config.transformer}return a},aj),isDev:a.every(a=>a._def._config.isDev),allowOutsideOfServer:a.every(a=>a._def._config.allowOutsideOfServer),isServer:a.every(a=>a._def._config.isServer),$types:null==(b=a[0])?void 0:b._def._config.$types,sse:null==(c=a[0])?void 0:c._def._config.sse})(d)}let at=Symbol();function au(a){return"object"==typeof a&&null!==a&&"subscribe"in a}function av(a,b){let c=(function(a,b){let c=null,d=()=>{null==c||c.unsubscribe(),c=null,b.removeEventListener("abort",d)};return new ReadableStream({start(e){c=a.subscribe({next(a){e.enqueue({ok:!0,value:a})},error(a){e.enqueue({ok:!1,error:a}),e.close()},complete(){e.close()}}),b.aborted?d():b.addEventListener("abort",d,{once:!0})},cancel(){d()}})})(a,b).getReader(),d={async next(){let a=await c.read();if(a.done)return{value:void 0,done:!0};let{value:b}=a;if(!b.ok)throw b.error;return{value:b.value,done:!1}},return:async()=>(await c.cancel(),{value:void 0,done:!0})};return{[Symbol.asyncIterator]:()=>d}}var aw=T(aa(),1);function ax(a){let b=null,c=Symbol.for("@trpc/server/http/memo"),d=c;return{read:async()=>(d!==c||(null!=b||(b=a().catch(a=>{if(a instanceof ah)throw a;throw new ah({code:"BAD_REQUEST",message:a instanceof Error?a.message:"Invalid input",cause:a})})),d=await b,b=null),d),result:()=>d!==c?d:void 0}}let ay={isMatch(a){var b;return!!(null==(b=a.headers.get("content-type"))?void 0:b.startsWith("application/json"))},async parse(a){var b;let{req:c}=a,d="1"===a.searchParams.get("batch"),e=d?a.path.split(","):[a.path],f=ax(async()=>{let b;if("GET"===c.method){let c=a.searchParams.get("input");c&&(b=JSON.parse(c))}else b=await c.json();if(void 0===b)return{};if(!d)return{0:a.router._def._config.transformer.input.deserialize(b)};if(!F(b))throw new ah({code:"BAD_REQUEST",message:'"input" needs to be an object when doing a batch call'});let f={};for(let c of e.keys()){let d=b[c];void 0!==d&&(f[c]=a.router._def._config.transformer.input.deserialize(d))}return f}),g=await Promise.all(e.map(async(b,c)=>{let d=await aq(a.router,b);return{path:b,procedure:d,getRawInput:async()=>{let b=(await f.read())[c];if((null==d?void 0:d._def.type)==="subscription"){var e,g;let c=null!=(e=null!=(g=a.headers.get("last-event-id"))?g:a.searchParams.get("lastEventId"))?e:a.searchParams.get("Last-Event-Id");c&&(F(b)?b=(0,aw.default)((0,aw.default)({},b),{},{lastEventId:c}):null!=b||(b={lastEventId:c}))}return b},result:()=>{var a;return null==(a=f.result())?void 0:a[c]}}})),h=new Set(g.map(a=>{var b;return null==(b=a.procedure)?void 0:b._def.type}).filter(Boolean));if(h.size>1)throw new ah({code:"BAD_REQUEST",message:`Cannot mix procedure types in call: ${Array.from(h).join(", ")}`});let i=null!=(b=h.values().next().value)?b:"unknown",j=a.searchParams.get("connectionParams");return{isBatchCall:d,accept:c.headers.get("trpc-accept"),calls:g,type:i,connectionParams:null===j?null:function(a){let b;try{b=JSON.parse(a)}catch(a){throw new ah({code:"PARSE_ERROR",message:"Not JSON-parsable query params",cause:a})}var c=b;try{if(null===c)return null;if(!F(c))throw Error("Expected object");let a=Object.entries(c).filter(([a,b])=>"string"!=typeof b);if(a.length>0)throw Error(`Expected connectionParams to be string values. Got ${a.map(([a,b])=>`${a}: ${typeof b}`).join(", ")}`);return c}catch(a){throw new ah({code:"PARSE_ERROR",message:"Invalid connection params shape",cause:a})}}(j),signal:c.signal,url:a.url}}},az=[ay,{isMatch(a){var b;return!!(null==(b=a.headers.get("content-type"))?void 0:b.startsWith("multipart/form-data"))},async parse(a){let{req:b}=a;if("POST"!==b.method)throw new ah({code:"METHOD_NOT_SUPPORTED",message:"Only POST requests are supported for multipart/form-data requests"});let c=ax(async()=>await b.formData()),d=await aq(a.router,a.path);return{accept:null,calls:[{path:a.path,getRawInput:c.read,result:c.result,procedure:d}],isBatchCall:!1,type:"mutation",connectionParams:null,signal:b.signal,url:a.url}}},{isMatch(a){var b;return!!(null==(b=a.headers.get("content-type"))?void 0:b.startsWith("application/octet-stream"))},async parse(a){let{req:b}=a;if("POST"!==b.method)throw new ah({code:"METHOD_NOT_SUPPORTED",message:"Only POST requests are supported for application/octet-stream requests"});let c=ax(async()=>b.body);return{calls:[{path:a.path,getRawInput:c.read,result:c.result,procedure:await aq(a.router,a.path)}],isBatchCall:!1,accept:null,type:"mutation",connectionParams:null,signal:b.signal,url:a.url}}}];async function aA(a){let b=function(a){let b=az.find(b=>b.isMatch(a));if(b)return b;if(!b&&"GET"===a.method)return ay;throw new ah({code:"UNSUPPORTED_MEDIA_TYPE",message:a.headers.has("content-type")?`Unsupported content-type "${a.headers.get("content-type")}`:"Missing content-type header"})}(a.req);return await b.parse(a)}function aB(a="AbortError"){throw new DOMException(a,"AbortError")}function aC(a){return"[object Object]"===Object.prototype.toString.call(a)}var aD=T(_(),1);let aE=new WeakMap,aF=()=>{};d=Symbol.toStringTag;var aG=class a{constructor(a){(0,aD.default)(this,"promise",void 0),(0,aD.default)(this,"subscribers",[]),(0,aD.default)(this,"settlement",null),(0,aD.default)(this,d,"Unpromise"),"function"==typeof a?this.promise=new Promise(a):this.promise=a;let b=this.promise.then(a=>{let{subscribers:b}=this;this.subscribers=null,this.settlement={status:"fulfilled",value:a},null==b||b.forEach(({resolve:b})=>{b(a)})});"catch"in b&&b.catch(a=>{let{subscribers:b}=this;this.subscribers=null,this.settlement={status:"rejected",reason:a},null==b||b.forEach(({reject:b})=>{b(a)})})}subscribe(){let a,b,{settlement:c}=this;if(null===c){var d;let c,e;if(null===this.subscribers)throw Error("Unpromise settled but still has subscribers");let f={promise:new Promise((a,b)=>{c=a,e=b}),resolve:c,reject:e};this.subscribers=(d=this.subscribers,[...d,f]),a=f.promise,b=()=>{null!==this.subscribers&&(this.subscribers=function(a,b){let c=a.indexOf(b);if(-1!==c)return[...a.slice(0,c),...a.slice(c+1)];return a}(this.subscribers,f))}}else{let{status:d}=c;a="fulfilled"===d?Promise.resolve(c.value):Promise.reject(c.reason),b=aF}return Object.assign(a,{unsubscribe:b})}then(a,b){let c=this.subscribe(),{unsubscribe:d}=c;return Object.assign(c.then(a,b),{unsubscribe:d})}catch(a){let b=this.subscribe(),{unsubscribe:c}=b;return Object.assign(b.catch(a),{unsubscribe:c})}finally(a){let b=this.subscribe(),{unsubscribe:c}=b;return Object.assign(b.finally(a),{unsubscribe:c})}static proxy(b){let c=a.getSubscribablePromise(b);return void 0!==c?c:a.createSubscribablePromise(b)}static createSubscribablePromise(b){let c=new a(b);return aE.set(b,c),aE.set(c,c),c}static getSubscribablePromise(a){return aE.get(a)}static resolve(b){let c="object"==typeof b&&null!==b&&"then"in b&&"function"==typeof b.then?b:Promise.resolve(b);return a.proxy(c).subscribe()}static async any(b){let c=(Array.isArray(b)?b:[...b]).map(a.resolve);try{return await Promise.any(c)}finally{c.forEach(({unsubscribe:a})=>{a()})}}static async race(b){let c=(Array.isArray(b)?b:[...b]).map(a.resolve);try{return await Promise.race(c)}finally{c.forEach(({unsubscribe:a})=>{a()})}}static async raceReferences(a){let b=a.map(aH);try{return await Promise.race(b)}finally{for(let a of b)a.unsubscribe()}}};function aH(a){return aG.proxy(a).then(()=>[a])}function aI(a,b){let c=a[Symbol.asyncDispose];return a[Symbol.asyncDispose]=async()=>{await b(),await (null==c?void 0:c())},a}null!=(e=Symbol).dispose||(e.dispose=Symbol()),null!=(f=Symbol).asyncDispose||(f.asyncDispose=Symbol());let aJ=Symbol();function aK(a){let b=null;return function(a,b){let c=a[Symbol.dispose];return a[Symbol.dispose]=()=>{b(),null==c||c()},a}({start(){if(b)throw Error("Timer already started");return new Promise(c=>{b=setTimeout(()=>c(aJ),a)})}},()=>{b&&clearTimeout(b)})}var aL=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/usingCtx.js"(a,b){b.exports=function(){var a="function"==typeof SuppressedError?SuppressedError:function(a,b){var c=Error();return c.name="SuppressedError",c.error=a,c.suppressed=b,c},b={},c=[];function d(a,b){if(null!=b){if(Object(b)!==b)throw TypeError("using declarations can only be used with objects, functions, null, or undefined.");if(a)var d=b[Symbol.asyncDispose||Symbol.for("Symbol.asyncDispose")];if(void 0===d&&(d=b[Symbol.dispose||Symbol.for("Symbol.dispose")],a))var e=d;if("function"!=typeof d)throw TypeError("Object is not disposable.");e&&(d=function(){try{e.call(b)}catch(a){return Promise.reject(a)}}),c.push({v:b,d:d,a:a})}else a&&c.push({d:b,a:a});return b}return{e:b,u:d.bind(null,!1),a:d.bind(null,!0),d:function(){var d,e=this.e,f=0;function g(){for(;d=c.pop();)try{if(!d.a&&1===f)return f=0,c.push(d),Promise.resolve().then(g);if(d.d){var a=d.d.call(d.v);if(d.a)return f|=2,Promise.resolve(a).then(g,h)}else f|=1}catch(a){return h(a)}if(1===f)return e!==b?Promise.reject(e):Promise.resolve();if(e!==b)throw e}function h(c){return e=e!==b?new a(c,e):c,g()}return g()}}},b.exports.__esModule=!0,b.exports.default=b.exports}}),aM=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/OverloadYield.js"(a,b){b.exports=function(a,b){this.v=a,this.k=b},b.exports.__esModule=!0,b.exports.default=b.exports}}),aN=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/awaitAsyncGenerator.js"(a,b){var c=aM();b.exports=function(a){return new c(a,0)},b.exports.__esModule=!0,b.exports.default=b.exports}}),aO=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/wrapAsyncGenerator.js"(a,b){var c=aM();function d(a){var b,d;function e(b,d){try{var g=a[b](d),h=g.value,i=h instanceof c;Promise.resolve(i?h.v:h).then(function(c){if(i){var d="return"===b?"return":"next";if(!h.k||c.done)return e(d,c);c=a[d](c).value}f(g.done?"return":"normal",c)},function(a){e("throw",a)})}catch(a){f("throw",a)}}function f(a,c){switch(a){case"return":b.resolve({value:c,done:!0});break;case"throw":b.reject(c);break;default:b.resolve({value:c,done:!1})}(b=b.next)?e(b.key,b.arg):d=null}this._invoke=function(a,c){return new Promise(function(f,g){var h={key:a,arg:c,resolve:f,reject:g,next:null};d?d=d.next=h:(b=d=h,e(a,c))})},"function"!=typeof a.return&&(this.return=void 0)}d.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},d.prototype.next=function(a){return this._invoke("next",a)},d.prototype.throw=function(a){return this._invoke("throw",a)},d.prototype.return=function(a){return this._invoke("return",a)},b.exports=function(a){return function(){return new d(a.apply(this,arguments))}},b.exports.__esModule=!0,b.exports.default=b.exports}}),aP=T(aL(),1),aQ=T(aN(),1),aR=T(aO(),1);function aS(a){let b=a[Symbol.asyncIterator]();return b[Symbol.asyncDispose]?b:aI(b,async()=>{var a;await (null==(a=b.return)?void 0:a.call(b))})}function aT(){return(aT=(0,aR.default)(function*(a,b){try{let d;var c=(0,aP.default)();let e=c.a(aS(a)),f=c.u(aK(b.maxDurationMs)).start();for(;;){if((d=yield(0,aQ.default)(aG.race([e.next(),f])))===aJ&&aB(),d.done)return d;yield d.value,d=null}}catch(a){c.e=a}finally{yield(0,aQ.default)(c.d())}})).apply(this,arguments)}function aU(){return(aU=(0,aR.default)(function*(a,b){try{let d;var c=(0,aP.default)();let e=c.a(aS(a)),f=c.u(aK(b.gracePeriodMs)),g=b.count,h=new Promise(()=>{});for(;;){if((d=yield(0,aQ.default)(aG.race([e.next(),h])))===aJ&&aB(),d.done)return d.value;yield d.value,0==--g&&(h=f.start()),d=null}}catch(a){c.e=a}finally{yield(0,aQ.default)(c.d())}})).apply(this,arguments)}function aV(){let a,b;return{promise:new Promise((c,d)=>{a=c,b=d}),resolve:a,reject:b}}var aW=T(aL(),1),aX=T(aN(),1),aY=T(aO(),1);function aZ(a){let b=a[Symbol.asyncIterator]();return new ReadableStream({async cancel(){var a;await (null==(a=b.return)?void 0:a.call(b))},async pull(a){let c=await b.next();if(c.done)return void a.close();a.enqueue(c.value)}})}var a$=T(aL(),1),a_=T(aN(),1),a0=T(aO(),1);let a1=Symbol("ping");function a2(a,b){return a3.apply(this,arguments)}function a3(){return(a3=(0,a0.default)(function*(a,b){try{let e;var c=(0,a$.default)();let f=c.a(aS(a)),g=f.next();for(;;)try{var d=(0,a$.default)();let a=d.u(aK(b));if((e=yield(0,a_.default)(aG.race([g,a.start()])))===aJ){yield a1;continue}if(e.done)return e.value;g=f.next(),yield e.value,e=null}catch(a){d.e=a}finally{d.d()}}catch(a){c.e=a}finally{yield(0,a_.default)(c.d())}})).apply(this,arguments)}var a4=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/asyncIterator.js"(a,b){function c(a){function b(a){if(Object(a)!==a)return Promise.reject(TypeError(a+" is not an object."));var b=a.done;return Promise.resolve(a.value).then(function(a){return{value:a,done:b}})}return(c=function(a){this.s=a,this.n=a.next}).prototype={s:null,n:null,next:function(){return b(this.n.apply(this.s,arguments))},return:function(a){var c=this.s.return;return void 0===c?Promise.resolve({value:a,done:!0}):b(c.apply(this.s,arguments))},throw:function(a){var c=this.s.return;return void 0===c?Promise.reject(a):b(c.apply(this.s,arguments))}},new c(a)}b.exports=function(a){var b,d,e,f=2;for("undefined"!=typeof Symbol&&(d=Symbol.asyncIterator,e=Symbol.iterator);f--;){if(d&&null!=(b=a[d]))return b.call(a);if(e&&null!=(b=a[e]))return new c(b.call(a));d="@@asyncIterator",e="@@iterator"}throw TypeError("Object is not async iterable")},b.exports.__esModule=!0,b.exports.default=b.exports}}),a5=T(aN(),1),a6=T(aO(),1),a7=T(aL(),1),a8=T(a4(),1);function a9(a){return(F(a)||G(a))&&"function"==typeof(null==a?void 0:a.then)&&"function"==typeof(null==a?void 0:a.catch)}var ba=class extends Error{constructor(a){super("Max depth reached at path: "+a.join(".")),this.path=a}};function bb(){return(bb=(0,a6.default)(function*(a){let{data:b}=a,c=0,d=function(){let a="idle",b=aV(),c=[],d=new Set,e=[];function f(c){if("pending"!==a)return;let f=function(a,b){let c=a[Symbol.asyncIterator](),d="idle";function e(){d="done",b=()=>{}}return{pull:function(){"idle"===d&&(d="pending",c.next().then(a=>{if(a.done){d="done",b({status:"return",value:a.value}),e();return}d="idle",b({status:"yield",value:a.value})}).catch(a=>{b({status:"error",error:a}),e()}))},destroy:async()=>{var a;e(),await (null==(a=c.return)?void 0:a.call(c))}}}(c,c=>{if("pending"===a){switch(c.status){case"yield":e.push([f,c]);break;case"return":d.delete(f);break;case"error":e.push([f,c]),d.delete(f)}b.resolve()}});d.add(f),f.pull()}return{add(b){switch(a){case"idle":c.push(b);break;case"pending":f(b)}},[Symbol.asyncIterator]:()=>(0,aY.default)(function*(){try{var g=(0,aW.default)();if("idle"!==a)throw Error("Cannot iterate twice");for(a="pending",g.a(aI({},async()=>{a="done";let c=[];if(await Promise.all(Array.from(d.values()).map(async a=>{try{await a.destroy()}catch(a){c.push(a)}})),e.length=0,d.clear(),b.resolve(),c.length>0)throw AggregateError(c)}));c.length>0;)f(c.shift());for(;d.size>0;){for(yield(0,aX.default)(b.promise);e.length>0;){let[a,b]=e.shift();switch(b.status){case"yield":yield b.value,a.pull();break;case"error":throw b.error}}b=aV()}}catch(a){g.e=a}finally{yield(0,aX.default)(g.d())}})()}}();function e(a){let b=c++,e=a(b);return d.add(e),b}function f(b){return a.maxDepth&&b.length>a.maxDepth?new ba(b):null}function g(b,c){var d,g,i;if(a9(b))return[0,(d=b,e((g=(0,a6.default)(function*(b){let e=f(c);e&&(d.catch(b=>{var d;null==(d=a.onError)||d.call(a,{error:b,path:c})}),d=Promise.reject(e));try{let a=yield(0,a5.default)(d);yield[b,0,h(a,c)]}catch(d){var g,i;null==(g=a.onError)||g.call(a,{error:d,path:c}),yield[b,1,null==(i=a.formatError)?void 0:i.call(a,{error:d,path:c})]}}),function(a){return g.apply(this,arguments)})))];if(J(b)){if(a.maxDepth&&c.length>=a.maxDepth)throw Error("Max depth reached");return[1,e((i=(0,a6.default)(function*(d){try{var e,g,i=(0,a7.default)();let j=f(c);if(j)throw j;let k=i.a(aS(b));try{for(;;){let a=yield(0,a5.default)(k.next());if(a.done){yield[d,0,h(a.value,c)];break}yield[d,1,h(a.value,c)]}}catch(b){null==(e=a.onError)||e.call(a,{error:b,path:c}),yield[d,2,null==(g=a.formatError)?void 0:g.call(a,{error:b,path:c})]}}catch(a){i.e=a}finally{yield(0,a5.default)(i.d())}}),function(a){return i.apply(this,arguments)}))]}return null}function h(a,b){var c,d;if(void 0===a)return[[]];let e=g(a,b);if(e)return[[0],[null,...e]];if(!1===aC(a)||void 0!==(c=a.constructor)&&(!1===aC(d=c.prototype)||!1===d.hasOwnProperty("isPrototypeOf")))return[[a]];let f={},h=[];for(let[c,d]of Object.entries(a)){let a=g(d,[...b,c]);if(!a){f[c]=d;continue}f[c]=0,h.push([c,...a])}return[[f],...h]}let i={};for(let[a,c]of Object.entries(b))i[a]=h(c,[a]);yield i;let j=d;a.pingMs&&(j=a2(d,a.pingMs));var k=!1,l=!1;try{for(var m,n,o=(0,a8.default)(j);k=!(n=yield(0,a5.default)(o.next())).done;k=!1){let a=n.value;yield a}}catch(a){l=!0,m=a}finally{try{k&&null!=o.return&&(yield(0,a5.default)(o.return()))}finally{if(l)throw m}}})).apply(this,arguments)}var bc=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/asyncGeneratorDelegate.js"(a,b){var c=aM();b.exports=function(a){var b={},d=!1;function e(b,e){return d=!0,{done:!1,value:new c(e=new Promise(function(c){c(a[b](e))}),1)}}return b["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},b.next=function(a){return d?(d=!1,a):e("next",a)},"function"==typeof a.throw&&(b.throw=function(a){if(d)throw d=!1,a;return e("throw",a)}),"function"==typeof a.return&&(b.return=function(a){return d?(d=!1,a):e("return",a)}),b},b.exports.__esModule=!0,b.exports.default=b.exports}}),bd=T(a4(),1),be=T(aN(),1),bf=T(aO(),1),bg=T(bc(),1);T(aL(),1);let bh={"Content-Type":"text/event-stream","Cache-Control":"no-cache, no-transform","X-Accel-Buffering":"no",Connection:"keep-alive"};var bi=T(aO(),1),bj=T(aa(),1);function bk(a){return K((0,bi.default)(function*(){throw a}))}let bl={mutation:["POST"],query:["GET"],subscription:["GET"]},bm={mutation:["POST"],query:["GET","POST"],subscription:["GET","POST"]};function bn(a){var b,c,d;let{ctx:e,info:f,responseMeta:g,untransformedJSON:h,errors:i=[],headers:j}=a,k=h?function(a){let b=new Set((Array.isArray(a)?a:[a]).map(a=>{if("error"in a&&F(a.error.data)){var b;return"number"==typeof(null==(b=a.error.data)?void 0:b.httpStatus)?a.error.data.httpStatus:X(D[a.error.code])}return 200}));return 1!==b.size?207:b.values().next().value}(h):200,l=!h,m=l?[]:Array.isArray(h)?h:[h],n=null!=(b=null==g?void 0:g({ctx:e,info:f,paths:null==f?void 0:f.calls.map(a=>a.path),data:m,errors:i,eagerGeneration:l,type:null!=(c=null==f||null==(d=f.calls.find(a=>{var b;return null==(b=a.procedure)?void 0:b._def.type}))||null==(d=d.procedure)?void 0:d._def.type)?c:"unknown"}))?b:{};if(n.headers)if(n.headers instanceof Headers)for(let[a,b]of n.headers.entries())j.append(a,b);else for(let[a,b]of Object.entries(n.headers))if(Array.isArray(b))for(let c of b)j.append(a,c);else"string"==typeof b&&j.set(a,b);return n.status&&(k=n.status),{status:k}}function bo(a){return!!F(a)&&(!!J(a)||Object.values(a).some(a9)||Object.values(a).some(J))}async function bp(a){var b,c,d,e,f,g,h;let{router:i,req:j}=a,k=new Headers([["vary","trpc-accept"]]),l=i._def._config,m=new URL(j.url);if("HEAD"===j.method)return new Response(null,{status:204});let n=null==(b=null!=(c=a.allowBatching)?c:null==(d=a.batching)?void 0:d.enabled)||b,o=null!=(e=a.allowMethodOverride)&&e&&"POST"===j.method,p=await K(async()=>{try{return[void 0,await aA({req:j,path:decodeURIComponent(a.path),router:i,searchParams:m.searchParams,headers:a.req.headers,url:m})]}catch(a){return[ag(a),void 0]}}),q=K(()=>{let b;return{valueOrUndefined:()=>{if(b)return b[1]},value:()=>{let[a,c]=b;if(a)throw a;return c},create:async c=>{if(b)throw Error("This should only be called once - report a bug in tRPC");try{let d=await a.createContext({info:c});b=[void 0,d]}catch(a){b=[ag(a),void 0]}}}}),r=o?bm:bl,s="application/jsonl"===j.headers.get("trpc-accept"),t=null==(f=null==(g=l.sse)?void 0:g.enabled)||f;try{let[b,c]=p;if(b)throw b;if(c.isBatchCall&&!n)throw new ah({code:"BAD_REQUEST",message:"Batching is not enabled on the server"});if(s&&!c.isBatchCall)throw new ah({message:"Streaming requests must be batched (you can do a batch of 1)",code:"BAD_REQUEST"});await q.create(c);let d=c.calls.map(async b=>{let d=b.procedure;try{if(a.error)throw a.error;if(!d)throw new ah({code:"NOT_FOUND",message:`No procedure found on path "${b.path}"`});if(!r[d._def.type].includes(j.method))throw new ah({code:"METHOD_NOT_SUPPORTED",message:`Unsupported ${j.method}-request to ${d._def.type} procedure at path "${b.path}"`});if("subscription"===d._def.type&&c.isBatchCall)throw new ah({code:"BAD_REQUEST",message:"Cannot batch subscription calls"});let e=await d({path:b.path,getRawInput:b.getRawInput,ctx:q.value(),type:d._def.type,signal:a.req.signal});return[void 0,{data:e}]}catch(h){var e,f,g;let c=ag(h),d=b.result();return null==(e=a.onError)||e.call(a,{error:c,path:b.path,input:d,ctx:q.valueOrUndefined(),type:null!=(f=null==(g=b.procedure)?void 0:g._def.type)?f:"unknown",req:a.req}),[c,void 0]}});if(!c.isBatchCall){let[b]=c.calls,[e,f]=await d[0];switch(c.type){case"unknown":case"mutation":case"query":{if(k.set("content-type","application/json"),bo(null==f?void 0:f.data))throw new ah({code:"UNSUPPORTED_MEDIA_TYPE",message:"Cannot use stream-like response in non-streaming request - use httpBatchStreamLink"});let d=e?{error:ac({config:l,ctx:q.valueOrUndefined(),error:e,input:b.result(),path:b.path,type:c.type})}:{result:{data:f.data}},g=bn({ctx:q.valueOrUndefined(),info:c,responseMeta:a.responseMeta,errors:e?[e]:[],headers:k,untransformedJSON:[d]});return new Response(JSON.stringify(al(l,d)),{status:g.status,headers:k})}case"subscription":{let d=K(()=>e?bk(e):t?au(f.data)||J(f.data)?au(f.data)?av(f.data,a.req.signal):f.data:bk(new ah({message:`Subscription ${b.path} did not return an observable or a AsyncGenerator`,code:"INTERNAL_SERVER_ERROR"})):bk(new ah({code:"METHOD_NOT_SUPPORTED",message:'Missing experimental flag "sseSubscriptions"'}))),g=function(a){var b,c,d,e,f;let{serialize:g=L}=a,h={enabled:null!=(b=null==(c=a.ping)?void 0:c.enabled)&&b,intervalMs:null!=(d=null==(e=a.ping)?void 0:e.intervalMs)?d:1e3},i=null!=(f=a.client)?f:{};if(h.enabled&&i.reconnectAfterInactivityMs&&h.intervalMs>i.reconnectAfterInactivityMs)throw Error(`Ping interval must be less than client reconnect interval to prevent unnecessary reconnection - ping.intervalMs: ${h.intervalMs} client.reconnectAfterInactivityMs: ${i.reconnectAfterInactivityMs}`);function j(){return(j=(0,bf.default)(function*(){let b,c;yield{event:"connected",data:JSON.stringify(i)};let d=a.data;a.emitAndEndImmediately&&(d=function(a,b){return aU.apply(this,arguments)}(d,{count:1,gracePeriodMs:1})),a.maxDurationMs&&a.maxDurationMs>0&&a.maxDurationMs!==1/0&&(d=function(a,b){return aT.apply(this,arguments)}(d,{maxDurationMs:a.maxDurationMs})),h.enabled&&h.intervalMs!==1/0&&h.intervalMs>0&&(d=a2(d,h.intervalMs));var e=!1,f=!1;try{for(var j,k,l,m=(0,bd.default)(d);e=!(l=yield(0,be.default)(m.next())).done;e=!1){if((b=l.value)===a1){yield{event:"ping",data:""};continue}(j=b,c=Array.isArray(j)&&j[2]===at?{id:b[0],data:b[1]}:{data:b}).data=JSON.stringify(g(c.data)),yield c,b=null,c=null}}catch(a){f=!0,k=a}finally{try{e&&null!=m.return&&(yield(0,be.default)(m.return()))}finally{if(f)throw k}}})).apply(this,arguments)}function k(){return(k=(0,bf.default)(function*(){try{yield*(0,bg.default)((0,bd.default)(function(){return j.apply(this,arguments)}())),yield{event:"return",data:""}}catch(f){var b,c;if(F(f)&&"AbortError"===f.name)return;let d=ag(f),e=null!=(b=null==(c=a.formatError)?void 0:c.call(a,{error:d}))?b:null;yield{event:"serialized-error",data:JSON.stringify(g(e))}}})).apply(this,arguments)}return aZ(function(){return k.apply(this,arguments)}()).pipeThrough(new TransformStream({transform(a,b){"event"in a&&b.enqueue(`event: ${a.event}
`),"data"in a&&b.enqueue(`data: ${a.data}
`),"id"in a&&b.enqueue(`id: ${a.id}
`),"comment"in a&&b.enqueue(`: ${a.comment}
`),b.enqueue("\n\n")}})).pipeThrough(new TextEncoderStream)}((0,bj.default)((0,bj.default)({},l.sse),{},{data:d,serialize:a=>l.transformer.output.serialize(a),formatError(c){var d,e,f;let g=ag(c.error),h=null==b?void 0:b.result(),i=null==b?void 0:b.path,j=null!=(d=null==b||null==(e=b.procedure)?void 0:e._def.type)?d:"unknown";return null==(f=a.onError)||f.call(a,{error:g,path:i,input:h,ctx:q.valueOrUndefined(),req:a.req,type:j}),ac({config:l,ctx:q.valueOrUndefined(),error:g,input:h,path:i,type:j})}}));for(let[a,b]of Object.entries(bh))k.set(a,b);let h=bn({ctx:q.valueOrUndefined(),info:c,responseMeta:a.responseMeta,errors:[],headers:k,untransformedJSON:null});return new Response(g,{headers:k,status:h.status})}}}if("application/jsonl"===c.accept){k.set("content-type","application/json"),k.set("transfer-encoding","chunked");let b=bn({ctx:q.valueOrUndefined(),info:c,responseMeta:a.responseMeta,errors:[],headers:k,untransformedJSON:null}),e=function(a){let b=aZ(function(a){return bb.apply(this,arguments)}(a)),{serialize:c}=a;return c&&(b=b.pipeThrough(new TransformStream({transform(a,b){a===a1?b.enqueue(a1):b.enqueue(c(a))}}))),b.pipeThrough(new TransformStream({transform(a,b){a===a1?b.enqueue(" "):b.enqueue(JSON.stringify(a)+"\n")}})).pipeThrough(new TextEncoderStream)}((0,bj.default)((0,bj.default)({},l.jsonl),{},{maxDepth:1/0,data:d.map(async b=>{let[d,e]=await b,f=c.calls[0];if(d){var g,h;return{error:ac({config:l,ctx:q.valueOrUndefined(),error:d,input:f.result(),path:f.path,type:null!=(g=null==(h=f.procedure)?void 0:h._def.type)?g:"unknown"})}}let i=au(e.data)?av(e.data,a.req.signal):Promise.resolve(e.data);return{result:Promise.resolve({data:i})}}),serialize:a=>l.transformer.output.serialize(a),onError:b=>{var d,e;null==(d=a.onError)||d.call(a,{error:ag(b),path:void 0,input:void 0,ctx:q.valueOrUndefined(),req:a.req,type:null!=(e=null==c?void 0:c.type)?e:"unknown"})},formatError(a){var b,d;let e=null==c?void 0:c.calls[a.path[0]],f=ag(a.error),g=null==e?void 0:e.result(),h=null==e?void 0:e.path,i=null!=(b=null==e||null==(d=e.procedure)?void 0:d._def.type)?b:"unknown";return ac({config:l,ctx:q.valueOrUndefined(),error:f,input:g,path:h,type:i})}}));return new Response(e,{headers:k,status:b.status})}k.set("content-type","application/json");let e=(await Promise.all(d)).map(a=>{let[b,c]=a;return b?a:bo(c.data)?[new ah({code:"UNSUPPORTED_MEDIA_TYPE",message:"Cannot use stream-like response in non-streaming request - use httpBatchStreamLink"}),void 0]:a}),f=e.map(([a,b],d)=>{let e=c.calls[d];if(a){var f,g;return{error:ac({config:l,ctx:q.valueOrUndefined(),error:a,input:e.result(),path:e.path,type:null!=(f=null==(g=e.procedure)?void 0:g._def.type)?f:"unknown"})}}return{result:{data:b.data}}}),g=e.map(([a])=>a).filter(Boolean),h=bn({ctx:q.valueOrUndefined(),info:c,responseMeta:a.responseMeta,untransformedJSON:f,errors:g,headers:k});return new Response(JSON.stringify(al(l,f)),{status:h.status,headers:k})}catch(i){let[b,c]=p,d=q.valueOrUndefined(),{error:e,untransformedJSON:f,body:g}=function(a,b){let{router:c,req:d,onError:e}=b.opts,f=ag(a);null==e||e({error:f,path:b.path,input:b.input,ctx:b.ctx,type:b.type,req:d});let g={error:ac({config:c._def._config,error:f,type:b.type,path:b.path,input:b.input,ctx:b.ctx})},h=JSON.stringify(al(c._def._config,g));return{error:f,untransformedJSON:g,body:h}}(i,{opts:a,ctx:q.valueOrUndefined(),type:null!=(h=null==c?void 0:c.type)?h:"unknown"});return new Response(g,{status:bn({ctx:d,info:c,responseMeta:a.responseMeta,untransformedJSON:f,errors:[e],headers:k}).status,headers:k})}}var bq=T(aa(),1);let br=a=>a=(a=a.startsWith("/")?a.slice(1):a).endsWith("/")?a.slice(0,-1):a;async function bs(a){let b=new Headers,c=async c=>{var d;return null==(d=a.createContext)?void 0:d.call(a,(0,bq.default)({req:a.req,resHeaders:b},c))},d=br(new URL(a.req.url).pathname),e=br(a.endpoint),f=br(d.slice(e.length));return await bp((0,bq.default)((0,bq.default)({},a),{},{req:a.req,createContext:c,path:f,error:null,onError(b){var c;null==a||null==(c=a.onError)||c.call(a,(0,bq.default)((0,bq.default)({},b),{},{req:a.req}))},responseMeta(c){var d;let e=null==(d=a.responseMeta)?void 0:d.call(a,c);if(null==e?void 0:e.headers)if(e.headers instanceof Headers)for(let[a,c]of e.headers.entries())b.append(a,c);else for(let[a,c]of Object.entries(e.headers))if(Array.isArray(c))for(let d of c)b.append(a,d);else"string"==typeof c&&b.set(a,c);return{headers:b,status:null==e?void 0:e.status}}}))}var bt=T(aa(),1);let bu="middlewareMarker";var bv=T(_(),1),bw=class extends Error{constructor(a){var b;super(null==(b=a[0])?void 0:b.message),(0,bv.default)(this,"issues",void 0),this.name="SchemaError",this.issues=a}};function bx(a){let b="~standard"in a;if("function"==typeof a&&"function"==typeof a.assert)return a.assert.bind(a);if("function"==typeof a&&!b)return a;if("function"==typeof a.parseAsync)return a.parseAsync.bind(a);if("function"==typeof a.parse)return a.parse.bind(a);if("function"==typeof a.validateSync)return a.validateSync.bind(a);if("function"==typeof a.create)return a.create.bind(a);if("function"==typeof a.assert)return b=>(a.assert(b),b);if(b)return async b=>{let c=await a["~standard"].validate(b);if(c.issues)throw new bw(c.issues);return c.value};throw Error("Could not find a validator fn")}var by=S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/objectWithoutPropertiesLoose.js"(a,b){b.exports=function(a,b){if(null==a)return{};var c={};for(var d in a)if(({}).hasOwnProperty.call(a,d)){if(b.includes(d))continue;c[d]=a[d]}return c},b.exports.__esModule=!0,b.exports.default=b.exports}}),bz=T(S({"../../node_modules/.pnpm/@oxc-project+runtime@0.72.2/node_modules/@oxc-project/runtime/src/helpers/objectWithoutProperties.js"(a,b){var c=by();b.exports=function(a,b){if(null==a)return{};var d,e,f=c(a,b);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(a);for(e=0;e<g.length;e++)d=g[e],b.includes(d)||({}).propertyIsEnumerable.call(a,d)&&(f[d]=a[d])}return f},b.exports.__esModule=!0,b.exports.default=b.exports}})(),1),bA=T(aa(),1);let bB=["middlewares","inputs","meta"];function bC(a,b){let{middlewares:c=[],inputs:d,meta:e}=b,f=(0,bz.default)(b,bB);return bD((0,bA.default)((0,bA.default)({},E(a,f)),{},{inputs:[...a.inputs,...null!=d?d:[]],middlewares:[...a.middlewares,...c],meta:a.meta&&e?(0,bA.default)((0,bA.default)({},a.meta),e):null!=e?e:a.meta}))}function bD(a={}){let b=(0,bA.default)({procedure:!0,inputs:[],middlewares:[]},a);return{_def:b,input(a){let c=bx(a);return bC(b,{inputs:[a],middlewares:[function(a){let b=async function(b){let c,d=await b.getRawInput();try{c=await a(d)}catch(a){throw new ah({code:"BAD_REQUEST",cause:a})}let e=F(b.input)&&F(c)?(0,bt.default)((0,bt.default)({},b.input),c):c;return b.next({input:e})};return b._type="input",b}(c)]})},output(a){let c=bx(a);return bC(b,{output:a,middlewares:[function(a){let b=async function({next:b}){let c=await b();if(!c.ok)return c;try{let b=await a(c.data);return(0,bt.default)((0,bt.default)({},c),{},{data:b})}catch(a){throw new ah({message:"Output validation failed",code:"INTERNAL_SERVER_ERROR",cause:a})}};return b._type="output",b}(c)]})},meta:a=>bC(b,{meta:a}),use:a=>bC(b,{middlewares:"_middlewares"in a?a._middlewares:[a]}),unstable_concat:a=>bC(b,a._def),concat:a=>bC(b,a._def),query:a=>bE((0,bA.default)((0,bA.default)({},b),{},{type:"query"}),a),mutation:a=>bE((0,bA.default)((0,bA.default)({},b),{},{type:"mutation"}),a),subscription:a=>bE((0,bA.default)((0,bA.default)({},b),{},{type:"subscription"}),a),experimental_caller:a=>bC(b,{caller:a})}}function bE(a,b){let c=bC(a,{resolver:b,middlewares:[async function(a){return{marker:bu,ok:!0,data:await b(a),ctx:a.ctx}}]}),d=(0,bA.default)((0,bA.default)({},c._def),{},{type:a.type,experimental_caller:!!c._def.caller,meta:c._def.meta,$types:null}),e=function(a){async function b(b){if(!b||!("getRawInput"in b))throw Error(bF);let c=await bG(0,a,b);if(!c)throw new ah({code:"INTERNAL_SERVER_ERROR",message:"No result from middlewares - did you forget to `return next()`?"});if(!c.ok)throw c.error;return c.data}return b._def=a,b.procedure=!0,b.meta=a.meta,b}(c._def),f=c._def.caller;if(!f)return e;let g=async(...a)=>await f({args:a,invoke:e,_def:d});return g._def=d,g}let bF=`
This is a client-only function.
If you want to call this function on the server, see https://trpc.io/docs/v11/server/server-side-calls
`.trim();async function bG(a,b,c){try{let d=b.middlewares[a];return await d((0,bA.default)((0,bA.default)({},c),{},{meta:b.meta,input:c.input,next(d){var e;return bG(a+1,b,(0,bA.default)((0,bA.default)({},c),{},{ctx:(null==d?void 0:d.ctx)?(0,bA.default)((0,bA.default)({},c.ctx),d.ctx):c.ctx,input:d&&"input"in d?d.input:c.input,getRawInput:null!=(e=null==d?void 0:d.getRawInput)?e:c.getRawInput}))}}))}catch(a){return{ok:!1,error:ag(a),marker:bu}}}let bH="undefined"==typeof window||"Deno"in window||(null==(g=globalThis.process)||null==(g=g.env)?void 0:g.NODE_ENV)==="test"||!!(null==(h=globalThis.process)||null==(h=h.env)?void 0:h.JEST_WORKER_ID)||!!(null==(i=globalThis.process)||null==(i=i.env)?void 0:i.VITEST_WORKER_ID);var bI=T(aa(),1);let bJ=new class a{context(){return new a}meta(){return new a}create(a){var b,c,d,e,f,g,h,i;let j=(0,bI.default)((0,bI.default)({},a),{},{transformer:"input"in(i=null!=(b=null==a?void 0:a.transformer)?b:aj)?i:{input:i,output:i},isDev:null!=(c=null==a?void 0:a.isDev)?c:(null==(d=globalThis.process)?void 0:d.env.NODE_ENV)!=="production",allowOutsideOfServer:null!=(e=null==a?void 0:a.allowOutsideOfServer)&&e,errorFormatter:null!=(f=null==a?void 0:a.errorFormatter)?f:ad,isServer:null!=(g=null==a?void 0:a.isServer)?g:bH,$types:null});if(!(null!=(h=null==a?void 0:a.isServer)?h:bH)&&(null==a?void 0:a.allowOutsideOfServer)!==!0)throw Error("You're trying to use @trpc/server in a non-server environment. This is not supported by default.");return{_config:j,procedure:bD({meta:null==a?void 0:a.defaultMeta}),middleware:function(a){return function a(b){return{_middlewares:b,unstable_pipe:c=>a([...b,..."_middlewares"in c?c._middlewares:[c]])}}([a])},router:ap(j),mergeRouters:as,createCallerFactory:ar()}}};var bK=c(48152),bL=c(14021),bM=c(14369);async function bN(){if(!(0,bK.$)())return{db:null,supabase:null,user:{id:"demo-user-id",email:"demo@example.com",role:"event_registration_crew"},isDemoMode:!0};let a=await (0,bL.O)(),b=!!process.env.DATABASE_URL&&null!==bM.db,c=await (0,bK.U)(),d=null;if(c){let{data:{user:b}}=await c.auth.getUser();if(b&&a){let{data:c}=await a.from("users").select("*").eq("email",b.email).single();d=c?{id:c.id,email:c.email,role:c.role}:{id:b.id,email:b.email,role:"event_registration_crew"}}}return{db:b?bM.db:null,supabase:a,user:d,isDemoMode:!a}}let bO=bJ.context().create(),bP=bO.router;bO.procedure;let bQ=bO.middleware(({ctx:a,next:b})=>{if(!a.user)throw new ah({code:"UNAUTHORIZED",message:"You must be logged in to access this resource"});return b({ctx:{...a,user:a.user}})}),bR=a=>bO.middleware(({ctx:b,next:c})=>{if(!b.user)throw new ah({code:"UNAUTHORIZED",message:"You must be logged in to access this resource"});if(!a.includes(b.user.role))throw new ah({code:"FORBIDDEN",message:"You do not have permission to access this resource"});return c({ctx:{...b,user:b.user}})}),bS=bO.procedure.use(bQ),bT=bO.procedure.use(bR(["event_registration_crew"])),bU=bO.procedure.use(bR(["event_registration_crew","transport_arranger"]));function bV(a,b,c){function d(c,d){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:d,constr:g,traits:new Set},enumerable:!1}),c._zod.traits.has(a))return;c._zod.traits.add(a),b(c,d);let e=g.prototype,f=Object.keys(e);for(let a=0;a<f.length;a++){let b=f[a];b in c||(c[b]=e[b].bind(c))}}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}Object.freeze({status:"aborted"}),Symbol("zod_brand");class bW extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class bX extends Error{constructor(a){super(`Encountered unidirectional transform during encode: ${a}`),this.name="ZodEncodeError"}}let bY={};function bZ(a){return a&&Object.assign(bY,a),bY}function b$(a,b="|"){return a.map(a=>cg(a)).join(b)}function b_(a,b){return"bigint"==typeof b?b.toString():b}function b0(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function b1(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}let b2=Symbol("evaluating");function b3(a,b,c){let d;Object.defineProperty(a,b,{get(){if(d!==b2)return void 0===d&&(d=b2,d=c()),d},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function b4(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function b5(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function b6(a){return JSON.stringify(a)}let b7="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function b8(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let b9=b0(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function ca(a){if(!1===b8(a))return!1;let b=a.constructor;if(void 0===b||"function"!=typeof b)return!0;let c=b.prototype;return!1!==b8(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function cb(a){return ca(a)?{...a}:Array.isArray(a)?[...a]:a}let cc=new Set(["string","number","symbol"]);function cd(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ce(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function cf(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function cg(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}let ch={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function ci(a,b=0){if(!0===a.aborted)return!0;for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function cj(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function ck(a){return"string"==typeof a?a:a?.message}function cl(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=ck(a.inst?._zod.def?.error?.(a))??ck(b?.error?.(a))??ck(c.customError?.(a))??ck(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function cm(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function cn(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}let co=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,b_,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},cp=bV("$ZodError",co),cq=bV("$ZodError",co,{Parent:Error}),cr=a=>(b,c,d,e)=>{let f=d?Object.assign(d,{async:!1}):{async:!1},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise)throw new bW;if(g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>cl(a,f,bZ())));throw b7(b,e?.callee),b}return g.value},cs=a=>async(b,c,d,e)=>{let f=d?Object.assign(d,{async:!0}):{async:!0},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise&&(g=await g),g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>cl(a,f,bZ())));throw b7(b,e?.callee),b}return g.value},ct=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new bW;return f.issues.length?{success:!1,error:new(a??cp)(f.issues.map(a=>cl(a,e,bZ())))}:{success:!0,data:f.value}},cu=ct(cq),cv=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>cl(a,e,bZ())))}:{success:!0,data:f.value}},cw=cv(cq),cx=/^[cC][^\s-]{8,}$/,cy=/^[0-9a-z]+$/,cz=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,cA=/^[0-9a-vA-V]{20}$/,cB=/^[A-Za-z0-9]{27}$/,cC=/^[a-zA-Z0-9_-]{21}$/,cD=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,cE=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,cF=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,cG=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,cH=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cI=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,cJ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,cK=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cL=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,cM=/^[A-Za-z0-9_-]*$/,cN=/^\+(?:[0-9]){6,14}[0-9]$/,cO="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",cP=RegExp(`^${cO}$`);function cQ(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}let cR=/^-?\d+n?$/,cS=/^-?\d+$/,cT=/^-?\d+(?:\.\d+)?/,cU=/^(?:true|false)$/i,cV=/^[^A-Z]*$/,cW=/^[^a-z]*$/,cX=bV("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),cY={number:"number",bigint:"bigint",object:"date"},cZ=bV("$ZodCheckLessThan",(a,b)=>{cX.init(a,b);let c=cY[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),c$=bV("$ZodCheckGreaterThan",(a,b)=>{cX.init(a,b);let c=cY[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),c_=bV("$ZodCheckMultipleOf",(a,b)=>{cX.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===function(a,b){let c=(a.toString().split(".")[1]||"").length,d=b.toString(),e=(d.split(".")[1]||"").length;if(0===e&&/\d?e-\d?/.test(d)){let a=d.match(/\d?e-(\d?)/);a?.[1]&&(e=Number.parseInt(a[1]))}let f=c>e?c:e;return Number.parseInt(a.toFixed(f).replace(".",""))%Number.parseInt(b.toFixed(f).replace(".",""))/10**f}(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),c0=bV("$ZodCheckNumberFormat",(a,b)=>{cX.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=ch[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=cS)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",continue:!1,input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),c1=bV("$ZodCheckMaxLength",(a,b)=>{var c;cX.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=cm(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),c2=bV("$ZodCheckMinLength",(a,b)=>{var c;cX.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=cm(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),c3=bV("$ZodCheckLengthEquals",(a,b)=>{var c;cX.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=cm(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),c4=bV("$ZodCheckStringFormat",(a,b)=>{var c,d;cX.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),c5=bV("$ZodCheckRegex",(a,b)=>{c4.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),c6=bV("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=cV),c4.init(a,b)}),c7=bV("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=cW),c4.init(a,b)}),c8=bV("$ZodCheckIncludes",(a,b)=>{cX.init(a,b);let c=cd(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),c9=bV("$ZodCheckStartsWith",(a,b)=>{cX.init(a,b);let c=RegExp(`^${cd(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),da=bV("$ZodCheckEndsWith",(a,b)=>{cX.init(a,b);let c=RegExp(`.*${cd(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),db=bV("$ZodCheckOverwrite",(a,b)=>{cX.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});class dc{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}let dd={major:4,minor:1,patch:13},de=bV("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=dd;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=ci(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new bW;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=ci(a,b)))});else{if(a.issues.length===b)continue;e||(e=ci(a,b))}}return d?d.then(()=>a):a},c=(c,e,f)=>{if(ci(c))return c.aborted=!0,c;let g=b(e,d,f);if(g instanceof Promise){if(!1===f.async)throw new bW;return g.then(b=>a._zod.parse(b,f))}return a._zod.parse(g,f)};a._zod.run=(e,f)=>{if(f.skipChecks)return a._zod.parse(e,f);if("backward"===f.direction){let b=a._zod.parse({value:e.value,issues:[]},{...f,skipChecks:!0});return b instanceof Promise?b.then(a=>c(a,e,f)):c(b,e,f)}let g=a._zod.parse(e,f);if(g instanceof Promise){if(!1===f.async)throw new bW;return g.then(a=>b(a,d,f))}return b(g,d,f)}}a["~standard"]={validate:b=>{try{let c=cu(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return cw(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),df=bV("$ZodString",(a,b)=>{de.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??(a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)})(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),dg=bV("$ZodStringFormat",(a,b)=>{c4.init(a,b),df.init(a,b)}),dh=bV("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=cE),dg.init(a,b)}),di=bV("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=cF(a))}else b.pattern??(b.pattern=cF());dg.init(a,b)}),dj=bV("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=cG),dg.init(a,b)}),dk=bV("$ZodURL",(a,b)=>{dg.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:b.hostname.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),dl=bV("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),dg.init(a,b)}),dm=bV("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=cC),dg.init(a,b)}),dn=bV("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=cx),dg.init(a,b)}),dp=bV("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=cy),dg.init(a,b)}),dq=bV("$ZodULID",(a,b)=>{b.pattern??(b.pattern=cz),dg.init(a,b)}),dr=bV("$ZodXID",(a,b)=>{b.pattern??(b.pattern=cA),dg.init(a,b)}),ds=bV("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=cB),dg.init(a,b)}),dt=bV("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=function(a){let b=cQ({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${cO}T(?:${d})$`)}(b)),dg.init(a,b)}),du=bV("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=cP),dg.init(a,b)}),dv=bV("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=RegExp(`^${cQ(b)}$`)),dg.init(a,b)}),dw=bV("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=cD),dg.init(a,b)}),dx=bV("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=cH),dg.init(a,b),a._zod.bag.format="ipv4"}),dy=bV("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=cI),dg.init(a,b),a._zod.bag.format="ipv6",a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),dz=bV("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=cJ),dg.init(a,b)}),dA=bV("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=cK),dg.init(a,b),a._zod.check=c=>{let d=c.value.split("/");try{if(2!==d.length)throw Error();let[a,b]=d;if(!b)throw Error();let c=Number(b);if(`${c}`!==b||c<0||c>128)throw Error();new URL(`http://[${a}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function dB(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let dC=bV("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=cL),dg.init(a,b),a._zod.bag.contentEncoding="base64",a._zod.check=c=>{dB(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),dD=bV("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=cM),dg.init(a,b),a._zod.bag.contentEncoding="base64url",a._zod.check=c=>{!function(a){if(!cM.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return dB(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),dE=bV("$ZodE164",(a,b)=>{b.pattern??(b.pattern=cN),dg.init(a,b)}),dF=bV("$ZodJWT",(a,b)=>{dg.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),dG=bV("$ZodNumber",(a,b)=>{de.init(a,b),a._zod.pattern=a._zod.bag.pattern??cT,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),dH=bV("$ZodNumberFormat",(a,b)=>{c0.init(a,b),dG.init(a,b)}),dI=bV("$ZodBoolean",(a,b)=>{de.init(a,b),a._zod.pattern=cU,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),dJ=((a,b)=>{de.init(a,b),a._zod.pattern=cR,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=BigInt(c.value)}catch(a){}return"bigint"==typeof c.value||c.issues.push({expected:"bigint",code:"invalid_type",input:c.value,inst:a}),c}},bV("$ZodAny",(a,b)=>{de.init(a,b),a._zod.parse=a=>a})),dK=bV("$ZodUnknown",(a,b)=>{de.init(a,b),a._zod.parse=a=>a}),dL=bV("$ZodNever",(a,b)=>{de.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)});function dM(a,b,c){a.issues.length&&b.issues.push(...cj(c,a.issues)),b.value[c]=a.value}(a,b)=>{de.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}};let dN=bV("$ZodArray",(a,b)=>{de.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>dM(b,c,a))):dM(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function dO(a,b,c,d){a.issues.length&&b.issues.push(...cj(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}function dP(a){var b;let c=Object.keys(a.shape);for(let b of c)if(!a.shape?.[b]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${b}": expected a Zod schema`);let d=Object.keys(b=a.shape).filter(a=>"optional"===b[a]._zod.optin&&"optional"===b[a]._zod.optout);return{...a,keys:c,keySet:new Set(c),numKeys:c.length,optionalKeys:new Set(d)}}function dQ(a,b,c,d,e,f){let g=[],h=e.keySet,i=e.catchall._zod,j=i.def.type;for(let e in b){if(h.has(e))continue;if("never"===j){g.push(e);continue}let f=i.run({value:b[e],issues:[]},d);f instanceof Promise?a.push(f.then(a=>dO(a,c,e,b))):dO(f,c,e,b)}return(g.length&&c.issues.push({code:"unrecognized_keys",keys:g,input:b,inst:f}),a.length)?Promise.all(a).then(()=>c):c}let dR=bV("$ZodObject",(a,b)=>{let c;de.init(a,b);let d=Object.getOwnPropertyDescriptor(b,"shape");if(!d?.get){let a=b.shape;Object.defineProperty(b,"shape",{get:()=>{let c={...a};return Object.defineProperty(b,"shape",{value:c}),c}})}let e=b0(()=>dP(b));b3(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=b.catchall;a._zod.parse=(b,d)=>{c??(c=e.value);let g=b.value;if(!b8(g))return b.issues.push({expected:"object",code:"invalid_type",input:g,inst:a}),b;b.value={};let h=[],i=c.shape;for(let a of c.keys){let c=i[a]._zod.run({value:g[a],issues:[]},d);c instanceof Promise?h.push(c.then(c=>dO(c,b,a,g))):dO(c,b,a,g)}return f?dQ(h,g,b,d,e.value,a):h.length?Promise.all(h).then(()=>b):b}}),dS=bV("$ZodObjectJIT",(a,b)=>{let c,d;dR.init(a,b);let e=a._zod.parse,f=b0(()=>dP(b)),g=!bY.jitless,h=g&&b9.value,i=b.catchall;a._zod.parse=(j,k)=>{d??(d=f.value);let l=j.value;return b8(l)?g&&h&&k?.async===!1&&!0!==k.jitless?(c||(c=(a=>{let b=new dc(["shape","payload","ctx"]),c=f.value,d=a=>{let b=b6(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let e=Object.create(null),g=0;for(let a of c.keys)e[a]=`key_${g++}`;for(let a of(b.write("const newResult = {};"),c.keys)){let c=e[a],f=b6(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${f}, ...iss.path] : [${f}]
          })));
        }
        
        
        if (${c}.value === undefined) {
          if (${f} in input) {
            newResult[${f}] = undefined;
          }
        } else {
          newResult[${f}] = ${c}.value;
        }
        
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),j=c(j,k),i)?dQ([],l,j,k,d,a):j:e(j,k):(j.issues.push({expected:"object",code:"invalid_type",input:l,inst:a}),j)}});function dT(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let e=a.filter(a=>!ci(a));return 1===e.length?(b.value=e[0].value,e[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>cl(a,d,bZ())))}),b)}let dU=bV("$ZodUnion",(a,b)=>{de.init(a,b),b3(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),b3(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),b3(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),b3(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>b1(a.source)).join("|")})$`)}});let c=1===b.options.length,d=b.options[0]._zod.run;a._zod.parse=(e,f)=>{if(c)return d(e,f);let g=!1,h=[];for(let a of b.options){let b=a._zod.run({value:e.value,issues:[]},f);if(b instanceof Promise)h.push(b),g=!0;else{if(0===b.issues.length)return b;h.push(b)}}return g?Promise.all(h).then(b=>dT(b,e,a,f)):dT(h,e,a,f)}}),dV=bV("$ZodIntersection",(a,b)=>{de.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>dW(a,b,c)):dW(a,e,f)}});function dW(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),ci(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(ca(b)&&ca(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let dX=bV("$ZodRecord",(a,b)=>{de.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!ca(e))return c.issues.push({expected:"record",code:"invalid_type",input:e,inst:a}),c;let f=[],g=b.keyType._zod.values;if(g){let h;c.value={};let i=new Set;for(let a of g)if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){i.add("number"==typeof a?a.toString():a);let g=b.valueType._zod.run({value:e[a],issues:[]},d);g instanceof Promise?f.push(g.then(b=>{b.issues.length&&c.issues.push(...cj(a,b.issues)),c.value[a]=b.value})):(g.issues.length&&c.issues.push(...cj(a,g.issues)),c.value[a]=g.value)}for(let a in e)i.has(a)||(h=h??[]).push(a);h&&h.length>0&&c.issues.push({code:"unrecognized_keys",input:e,inst:a,keys:h})}else for(let g of(c.value={},Reflect.ownKeys(e))){if("__proto__"===g)continue;let h=b.keyType._zod.run({value:g,issues:[]},d);if(h instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(h.issues.length){c.issues.push({code:"invalid_key",origin:"record",issues:h.issues.map(a=>cl(a,d,bZ())),input:g,path:[g],inst:a}),c.value[h.value]=h.value;continue}let i=b.valueType._zod.run({value:e[g],issues:[]},d);i instanceof Promise?f.push(i.then(a=>{a.issues.length&&c.issues.push(...cj(g,a.issues)),c.value[h.value]=a.value})):(i.issues.length&&c.issues.push(...cj(g,i.issues)),c.value[h.value]=i.value)}return f.length?Promise.all(f).then(()=>c):c}}),dY=bV("$ZodEnum",(a,b)=>{de.init(a,b);let c=function(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>cc.has(typeof a)).map(a=>"string"==typeof a?cd(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),dZ=bV("$ZodTransform",(a,b)=>{de.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new bX(a.constructor.name);let e=b.transform(c.value,c);if(d.async)return(e instanceof Promise?e:Promise.resolve(e)).then(a=>(c.value=a,c));if(e instanceof Promise)throw new bW;return c.value=e,c}});function d$(a,b){return a.issues.length&&void 0===b?{issues:[],value:void 0}:a}let d_=bV("$ZodOptional",(a,b)=>{de.init(a,b),a._zod.optin="optional",a._zod.optout="optional",b3(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),b3(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${b1(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>{if("optional"===b.innerType._zod.optin){let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>d$(b,a.value)):d$(d,a.value)}return void 0===a.value?a:b.innerType._zod.run(a,c)}}),d0=bV("$ZodNullable",(a,b)=>{de.init(a,b),b3(a._zod,"optin",()=>b.innerType._zod.optin),b3(a._zod,"optout",()=>b.innerType._zod.optout),b3(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${b1(a.source)}|null)$`):void 0}),b3(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),d1=bV("$ZodDefault",(a,b)=>{de.init(a,b),a._zod.optin="optional",b3(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>d2(a,b)):d2(d,b)}});function d2(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let d3=bV("$ZodPrefault",(a,b)=>{de.init(a,b),a._zod.optin="optional",b3(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>("backward"===c.direction||void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),d4=bV("$ZodNonOptional",(a,b)=>{de.init(a,b),b3(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>d5(b,a)):d5(e,a)}});function d5(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let d6=bV("$ZodCatch",(a,b)=>{de.init(a,b),b3(a._zod,"optin",()=>b.innerType._zod.optin),b3(a._zod,"optout",()=>b.innerType._zod.optout),b3(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>cl(a,c,bZ()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>cl(a,c,bZ()))},input:a.value}),a.issues=[]),a)}}),d7=bV("$ZodPipe",(a,b)=>{de.init(a,b),b3(a._zod,"values",()=>b.in._zod.values),b3(a._zod,"optin",()=>b.in._zod.optin),b3(a._zod,"optout",()=>b.out._zod.optout),b3(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{if("backward"===c.direction){let d=b.out._zod.run(a,c);return d instanceof Promise?d.then(a=>d8(a,b.in,c)):d8(d,b.in,c)}let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>d8(a,b.out,c)):d8(d,b.out,c)}});function d8(a,b,c){return a.issues.length?(a.aborted=!0,a):b._zod.run({value:a.value,issues:a.issues},c)}let d9=bV("$ZodReadonly",(a,b)=>{de.init(a,b),b3(a._zod,"propValues",()=>b.innerType._zod.propValues),b3(a._zod,"values",()=>b.innerType._zod.values),b3(a._zod,"optin",()=>b.innerType?._zod?.optin),b3(a._zod,"optout",()=>b.innerType?._zod?.optout),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(ea):ea(d)}});function ea(a){return a.value=Object.freeze(a.value),a}let eb=bV("$ZodCustom",(a,b)=>{cX.init(a,b),de.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>ec(b,c,d,a));ec(e,c,d,a)}});function ec(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(cn(a))}}Symbol("ZodOutput"),Symbol("ZodInput");class ed{constructor(){this._map=new WeakMap,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}(j=globalThis).__zod_globalRegistry??(j.__zod_globalRegistry=new ed);let ee=globalThis.__zod_globalRegistry;function ef(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...cf(b)})}function eg(a,b){return new cZ({check:"less_than",...cf(b),value:a,inclusive:!1})}function eh(a,b){return new cZ({check:"less_than",...cf(b),value:a,inclusive:!0})}function ei(a,b){return new c$({check:"greater_than",...cf(b),value:a,inclusive:!1})}function ej(a,b){return new c$({check:"greater_than",...cf(b),value:a,inclusive:!0})}function ek(a,b){return new c_({check:"multiple_of",...cf(b),value:a})}function el(a,b){return new c1({check:"max_length",...cf(b),maximum:a})}function em(a,b){return new c2({check:"min_length",...cf(b),minimum:a})}function en(a,b){return new c3({check:"length_equals",...cf(b),length:a})}function eo(a){return new db({check:"overwrite",tx:a})}let ep=bV("ZodISODateTime",(a,b)=>{dt.init(a,b),eL.init(a,b)}),eq=bV("ZodISODate",(a,b)=>{du.init(a,b),eL.init(a,b)}),er=bV("ZodISOTime",(a,b)=>{dv.init(a,b),eL.init(a,b)}),es=bV("ZodISODuration",(a,b)=>{dw.init(a,b),eL.init(a,b)}),et=(a,b)=>{cp.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b=a=>a.message){let c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code&&e.errors.length)e.errors.map(a=>d({issues:a}));else if("invalid_key"===e.code)d({issues:e.issues});else if("invalid_element"===e.code)d({issues:e.issues});else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(a),c})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,b_,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,b_,2)}},isEmpty:{get:()=>0===a.issues.length}})};bV("ZodError",et);let eu=bV("ZodError",et,{Parent:Error}),ev=cr(eu),ew=cs(eu),ex=ct(eu),ey=cv(eu),ez=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cr(eu)(a,b,d)},eA=(a,b,c)=>cr(eu)(a,b,c),eB=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cs(eu)(a,b,d)},eC=async(a,b,c)=>cs(eu)(a,b,c),eD=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return ct(eu)(a,b,d)},eE=(a,b,c)=>ct(eu)(a,b,c),eF=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cv(eu)(a,b,d)},eG=async(a,b,c)=>cv(eu)(a,b,c),eH=bV("ZodType",(a,b)=>(de.init(a,b),a.def=b,a.type=b.type,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone(b5(b,{checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]})),a.clone=(b,c)=>ce(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>ev(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>ex(a,b,c),a.parseAsync=async(b,c)=>ew(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>ey(a,b,c),a.spa=a.safeParseAsync,a.encode=(b,c)=>ez(a,b,c),a.decode=(b,c)=>eA(a,b,c),a.encodeAsync=async(b,c)=>eB(a,b,c),a.decodeAsync=async(b,c)=>eC(a,b,c),a.safeEncode=(b,c)=>eD(a,b,c),a.safeDecode=(b,c)=>eE(a,b,c),a.safeEncodeAsync=async(b,c)=>eF(a,b,c),a.safeDecodeAsync=async(b,c)=>eG(a,b,c),a.refine=(b,c)=>a.check(function(a,b={}){return new fA({type:"custom",check:"custom",fn:a,...cf(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a,b){let c=new cX({check:"custom",...cf(void 0)});return c._zod.check=a,c}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(cn(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(cn(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(eo(b)),a.optional=()=>fq(a),a.nullable=()=>fs(a),a.nullish=()=>fq(fs(a)),a.nonoptional=b=>new fv({type:"nonoptional",innerType:a,...cf(b)}),a.array=()=>ff(a),a.or=b=>new fi({type:"union",options:[a,b],...cf(void 0)}),a.and=b=>new fj({type:"intersection",left:a,right:b}),a.transform=b=>fy(a,new fo({type:"transform",transform:b})),a.default=b=>(function(a,b){return new ft({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():cb(b)}})})(a,b),a.prefault=b=>(function(a,b){return new fu({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():cb(b)}})})(a,b),a.catch=b=>(function(a,b){return new fw({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>fy(a,b),a.readonly=()=>new fz({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return ee.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>ee.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return ee.get(a);let c=a.clone();return ee.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),eI=bV("_ZodString",(a,b)=>{df.init(a,b),eH.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(function(a,b){return new c5({check:"string_format",format:"regex",...cf(b),pattern:a})}(...b)),a.includes=(...b)=>a.check(function(a,b){return new c8({check:"string_format",format:"includes",...cf(b),includes:a})}(...b)),a.startsWith=(...b)=>a.check(function(a,b){return new c9({check:"string_format",format:"starts_with",...cf(b),prefix:a})}(...b)),a.endsWith=(...b)=>a.check(function(a,b){return new da({check:"string_format",format:"ends_with",...cf(b),suffix:a})}(...b)),a.min=(...b)=>a.check(em(...b)),a.max=(...b)=>a.check(el(...b)),a.length=(...b)=>a.check(en(...b)),a.nonempty=(...b)=>a.check(em(1,...b)),a.lowercase=b=>a.check(new c6({check:"string_format",format:"lowercase",...cf(b)})),a.uppercase=b=>a.check(new c7({check:"string_format",format:"uppercase",...cf(b)})),a.trim=()=>a.check(eo(a=>a.trim())),a.normalize=(...b)=>a.check(function(a){return eo(b=>b.normalize(a))}(...b)),a.toLowerCase=()=>a.check(eo(a=>a.toLowerCase())),a.toUpperCase=()=>a.check(eo(a=>a.toUpperCase())),a.slugify=()=>a.check(eo(a=>a.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")))}),eJ=bV("ZodString",(a,b)=>{df.init(a,b),eI.init(a,b),a.email=b=>a.check(new eM({type:"string",format:"email",check:"string_format",abort:!1,...cf(b)})),a.url=b=>a.check(new eP({type:"string",format:"url",check:"string_format",abort:!1,...cf(b)})),a.jwt=b=>a.check(new e2({type:"string",format:"jwt",check:"string_format",abort:!1,...cf(b)})),a.emoji=b=>a.check(new eQ({type:"string",format:"emoji",check:"string_format",abort:!1,...cf(b)})),a.guid=b=>a.check(ef(eN,b)),a.uuid=b=>a.check(new eO({type:"string",format:"uuid",check:"string_format",abort:!1,...cf(b)})),a.uuidv4=b=>a.check(new eO({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...cf(b)})),a.uuidv6=b=>a.check(new eO({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...cf(b)})),a.uuidv7=b=>a.check(new eO({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...cf(b)})),a.nanoid=b=>a.check(new eR({type:"string",format:"nanoid",check:"string_format",abort:!1,...cf(b)})),a.guid=b=>a.check(ef(eN,b)),a.cuid=b=>a.check(new eS({type:"string",format:"cuid",check:"string_format",abort:!1,...cf(b)})),a.cuid2=b=>a.check(new eT({type:"string",format:"cuid2",check:"string_format",abort:!1,...cf(b)})),a.ulid=b=>a.check(new eU({type:"string",format:"ulid",check:"string_format",abort:!1,...cf(b)})),a.base64=b=>a.check(new e_({type:"string",format:"base64",check:"string_format",abort:!1,...cf(b)})),a.base64url=b=>a.check(new e0({type:"string",format:"base64url",check:"string_format",abort:!1,...cf(b)})),a.xid=b=>a.check(new eV({type:"string",format:"xid",check:"string_format",abort:!1,...cf(b)})),a.ksuid=b=>a.check(new eW({type:"string",format:"ksuid",check:"string_format",abort:!1,...cf(b)})),a.ipv4=b=>a.check(new eX({type:"string",format:"ipv4",check:"string_format",abort:!1,...cf(b)})),a.ipv6=b=>a.check(new eY({type:"string",format:"ipv6",check:"string_format",abort:!1,...cf(b)})),a.cidrv4=b=>a.check(new eZ({type:"string",format:"cidrv4",check:"string_format",abort:!1,...cf(b)})),a.cidrv6=b=>a.check(new e$({type:"string",format:"cidrv6",check:"string_format",abort:!1,...cf(b)})),a.e164=b=>a.check(new e1({type:"string",format:"e164",check:"string_format",abort:!1,...cf(b)})),a.datetime=b=>a.check(new ep({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...cf(b)})),a.date=b=>a.check(new eq({type:"string",format:"date",check:"string_format",...cf(b)})),a.time=b=>a.check(new er({type:"string",format:"time",check:"string_format",precision:null,...cf(b)})),a.duration=b=>a.check(new es({type:"string",format:"duration",check:"string_format",...cf(b)}))});function eK(a){return new eJ({type:"string",...cf(a)})}let eL=bV("ZodStringFormat",(a,b)=>{dg.init(a,b),eI.init(a,b)}),eM=bV("ZodEmail",(a,b)=>{dj.init(a,b),eL.init(a,b)}),eN=bV("ZodGUID",(a,b)=>{dh.init(a,b),eL.init(a,b)}),eO=bV("ZodUUID",(a,b)=>{di.init(a,b),eL.init(a,b)}),eP=bV("ZodURL",(a,b)=>{dk.init(a,b),eL.init(a,b)}),eQ=bV("ZodEmoji",(a,b)=>{dl.init(a,b),eL.init(a,b)}),eR=bV("ZodNanoID",(a,b)=>{dm.init(a,b),eL.init(a,b)}),eS=bV("ZodCUID",(a,b)=>{dn.init(a,b),eL.init(a,b)}),eT=bV("ZodCUID2",(a,b)=>{dp.init(a,b),eL.init(a,b)}),eU=bV("ZodULID",(a,b)=>{dq.init(a,b),eL.init(a,b)}),eV=bV("ZodXID",(a,b)=>{dr.init(a,b),eL.init(a,b)}),eW=bV("ZodKSUID",(a,b)=>{ds.init(a,b),eL.init(a,b)}),eX=bV("ZodIPv4",(a,b)=>{dx.init(a,b),eL.init(a,b)}),eY=bV("ZodIPv6",(a,b)=>{dy.init(a,b),eL.init(a,b)}),eZ=bV("ZodCIDRv4",(a,b)=>{dz.init(a,b),eL.init(a,b)}),e$=bV("ZodCIDRv6",(a,b)=>{dA.init(a,b),eL.init(a,b)}),e_=bV("ZodBase64",(a,b)=>{dC.init(a,b),eL.init(a,b)}),e0=bV("ZodBase64URL",(a,b)=>{dD.init(a,b),eL.init(a,b)}),e1=bV("ZodE164",(a,b)=>{dE.init(a,b),eL.init(a,b)}),e2=bV("ZodJWT",(a,b)=>{dF.init(a,b),eL.init(a,b)}),e3=bV("ZodNumber",(a,b)=>{dG.init(a,b),eH.init(a,b),a.gt=(b,c)=>a.check(ei(b,c)),a.gte=(b,c)=>a.check(ej(b,c)),a.min=(b,c)=>a.check(ej(b,c)),a.lt=(b,c)=>a.check(eg(b,c)),a.lte=(b,c)=>a.check(eh(b,c)),a.max=(b,c)=>a.check(eh(b,c)),a.int=b=>a.check(e6(b)),a.safe=b=>a.check(e6(b)),a.positive=b=>a.check(ei(0,b)),a.nonnegative=b=>a.check(ej(0,b)),a.negative=b=>a.check(eg(0,b)),a.nonpositive=b=>a.check(eh(0,b)),a.multipleOf=(b,c)=>a.check(ek(b,c)),a.step=(b,c)=>a.check(ek(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function e4(a){return new e3({type:"number",checks:[],...cf(a)})}let e5=bV("ZodNumberFormat",(a,b)=>{dH.init(a,b),e3.init(a,b)});function e6(a){return new e5({type:"number",check:"number_format",abort:!1,format:"safeint",...cf(a)})}let e7=bV("ZodBoolean",(a,b)=>{dI.init(a,b),eH.init(a,b)});function e8(a){return new e7({type:"boolean",...cf(a)})}let e9=bV("ZodAny",(a,b)=>{dJ.init(a,b),eH.init(a,b)});function fa(){return new e9({type:"any"})}let fb=bV("ZodUnknown",(a,b)=>{dK.init(a,b),eH.init(a,b)});function fc(){return new fb({type:"unknown"})}let fd=bV("ZodNever",(a,b)=>{dL.init(a,b),eH.init(a,b)}),fe=bV("ZodArray",(a,b)=>{dN.init(a,b),eH.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(em(b,c)),a.nonempty=b=>a.check(em(1,b)),a.max=(b,c)=>a.check(el(b,c)),a.length=(b,c)=>a.check(en(b,c)),a.unwrap=()=>a.element});function ff(a,b){return new fe({type:"array",element:a,...cf(b)})}let fg=bV("ZodObject",(a,b)=>{dS.init(a,b),eH.init(a,b),b3(a,"shape",()=>b.shape),a.keyof=()=>fn(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:fc()}),a.loose=()=>a.clone({...a._zod.def,catchall:fc()}),a.strict=()=>a.clone({...a._zod.def,catchall:new fd({type:"never",...cf(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>(function(a,b){if(!ca(b))throw Error("Invalid input to extend: expected a plain object");let c=a._zod.def.checks;if(c&&c.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let d=b5(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return b4(this,"shape",c),c},checks:[]});return ce(a,d)})(a,b),a.safeExtend=b=>(function(a,b){if(!ca(b))throw Error("Invalid input to safeExtend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return b4(this,"shape",c),c},checks:a._zod.def.checks};return ce(a,c)})(a,b),a.merge=b=>(function(a,b){let c=b5(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return b4(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return ce(a,c)})(a,b),a.pick=b=>(function(a,b){let c=a._zod.def,d=b5(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return b4(this,"shape",a),a},checks:[]});return ce(a,d)})(a,b),a.omit=b=>(function(a,b){let c=a._zod.def,d=b5(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return b4(this,"shape",d),d},checks:[]});return ce(a,d)})(a,b),a.partial=(...b)=>(function(a,b,c){let d=b5(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return b4(this,"shape",e),e},checks:[]});return ce(b,d)})(fp,a,b[0]),a.required=(...b)=>(function(a,b,c){let d=b5(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return b4(this,"shape",e),e},checks:[]});return ce(b,d)})(fv,a,b[0])});function fh(a,b){return new fg({type:"object",shape:a??{},...cf(b)})}let fi=bV("ZodUnion",(a,b)=>{dU.init(a,b),eH.init(a,b),a.options=b.options}),fj=bV("ZodIntersection",(a,b)=>{dV.init(a,b),eH.init(a,b)}),fk=bV("ZodRecord",(a,b)=>{dX.init(a,b),eH.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function fl(a,b,c){return new fk({type:"record",keyType:a,valueType:b,...cf(c)})}let fm=bV("ZodEnum",(a,b)=>{dY.init(a,b),eH.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new fm({...b,checks:[],...cf(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new fm({...b,checks:[],...cf(d),entries:e})}});function fn(a,b){return new fm({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...cf(b)})}let fo=bV("ZodTransform",(a,b)=>{dZ.init(a,b),eH.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new bX(a.constructor.name);c.addIssue=d=>{"string"==typeof d?c.issues.push(cn(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(cn(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),fp=bV("ZodOptional",(a,b)=>{d_.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType});function fq(a){return new fp({type:"optional",innerType:a})}let fr=bV("ZodNullable",(a,b)=>{d0.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType});function fs(a){return new fr({type:"nullable",innerType:a})}let ft=bV("ZodDefault",(a,b)=>{d1.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),fu=bV("ZodPrefault",(a,b)=>{d3.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fv=bV("ZodNonOptional",(a,b)=>{d4.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fw=bV("ZodCatch",(a,b)=>{d6.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),fx=bV("ZodPipe",(a,b)=>{d7.init(a,b),eH.init(a,b),a.in=b.in,a.out=b.out});function fy(a,b){return new fx({type:"pipe",in:a,out:b})}let fz=bV("ZodReadonly",(a,b)=>{d9.init(a,b),eH.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fA=bV("ZodCustom",(a,b)=>{eb.init(a,b),eH.init(a,b)});function fB(a){return new e3({type:"number",coerce:!0,checks:[],...cf(a)})}k||(k={}),bZ({localeError:(()=>{let a={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",mac:"MAC address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return c=>{switch(c.code){case"invalid_type":return`Invalid input: expected ${c.expected}, received ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${cg(c.values[0])}`;return`Invalid option: expected one of ${b$(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Too big: expected ${c.origin??"value"} to have ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return`Too big: expected ${c.origin??"value"} to be ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Too small: expected ${c.origin} to have ${b}${c.minimum.toString()} ${d.unit}`;return`Too small: expected ${c.origin} to be ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Invalid string: must start with "${c.prefix}"`;if("ends_with"===c.format)return`Invalid string: must end with "${c.suffix}"`;if("includes"===c.format)return`Invalid string: must include "${c.includes}"`;if("regex"===c.format)return`Invalid string: must match pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${c.divisor}`;case"unrecognized_keys":return`Unrecognized key${c.keys.length>1?"s":""}: ${b$(c.keys,", ")}`;case"invalid_key":return`Invalid key in ${c.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${c.origin}`}}})()});var fC=c(30314),fD=c(48689),fE=c(20862);function fF(a){return(0,fE.ll)`count(${a||fE.ll.raw("*")})`.mapWith(Number)}var fG=c(71559);let fH=[{id:"1a2b3c4d-5e6f-7g8h-9i0j-1k2l3m4n5o6p",email:"john.doe@example.com",firstName:"John",lastName:"Doe",axisEmail:"john.doe@axis.com",reportingLevel1:"APAC",reportingLevel2:"Southeast Asia",reportingLevel3:"Singapore",function:"Sales",location:"Singapore",arrivalDate:"2026-03-15",arrivalTime:"10:30",arrivalFlightNumber:"SQ123",arrivalAirport:"KLIA",departureDate:"2026-03-18",departureTime:"16:00",departureFlightNumber:"SQ456",departureAirport:"KLIA",hotelCheckinDate:"2026-03-15",hotelCheckoutDate:"2026-03-18",roomType:"Deluxe King",needsArrivalTransfer:!0,needsDepartureTransfer:!0,registrationStatus:"confirmed",travelType:"International",version:1,createdAt:new Date("2025-01-15"),updatedAt:new Date("2025-01-15"),deletedAt:null},{id:"2b3c4d5e-6f7g-8h9i-0j1k-2l3m4n5o6p7q",email:"jane.smith@example.com",firstName:"Jane",lastName:"Smith",axisEmail:"jane.smith@axis.com",reportingLevel1:"APAC",reportingLevel2:"North Asia",reportingLevel3:"Japan",function:"Marketing",location:"Tokyo",arrivalDate:"2026-03-14",arrivalTime:"08:15",arrivalFlightNumber:"JL789",arrivalAirport:"KLIA",departureDate:"2026-03-18",departureTime:"20:30",departureFlightNumber:"JL790",departureAirport:"KLIA",hotelCheckinDate:"2026-03-14",hotelCheckoutDate:"2026-03-18",roomType:"Deluxe Twin",needsArrivalTransfer:!0,needsDepartureTransfer:!1,registrationStatus:"confirmed",travelType:"International",version:1,createdAt:new Date("2025-01-14"),updatedAt:new Date("2025-01-14"),deletedAt:null},{id:"3c4d5e6f-7g8h-9i0j-1k2l-3m4n5o6p7q8r",email:"bob.wilson@example.com",firstName:"Bob",lastName:"Wilson",axisEmail:"bob.wilson@axis.com",reportingLevel1:"APAC",reportingLevel2:"Southeast Asia",reportingLevel3:"Malaysia",function:"Engineering",location:"Kuala Lumpur",arrivalDate:"2026-03-15",arrivalTime:null,arrivalFlightNumber:null,arrivalAirport:null,departureDate:"2026-03-17",departureTime:null,departureFlightNumber:null,departureAirport:null,hotelCheckinDate:"2026-03-15",hotelCheckoutDate:"2026-03-17",roomType:"Standard",needsArrivalTransfer:!1,needsDepartureTransfer:!1,registrationStatus:"pending",travelType:"Local",version:1,createdAt:new Date("2025-01-16"),updatedAt:new Date("2025-01-16"),deletedAt:null},{id:"4d5e6f7g-8h9i-0j1k-2l3m-4n5o6p7q8r9s",email:"alice.chen@example.com",firstName:"Alice",lastName:"Chen",axisEmail:"alice.chen@axis.com",reportingLevel1:"APAC",reportingLevel2:"Greater China",reportingLevel3:"Hong Kong",function:"Finance",location:"Hong Kong",arrivalDate:"2026-03-15",arrivalTime:"14:45",arrivalFlightNumber:"CX888",arrivalAirport:"KLIA",departureDate:"2026-03-18",departureTime:"11:00",departureFlightNumber:"CX889",departureAirport:"KLIA",hotelCheckinDate:"2026-03-15",hotelCheckoutDate:"2026-03-18",roomType:"Suite",needsArrivalTransfer:!0,needsDepartureTransfer:!0,registrationStatus:"confirmed",travelType:"International",version:1,createdAt:new Date("2025-01-17"),updatedAt:new Date("2025-01-17"),deletedAt:null},{id:"5e6f7g8h-9i0j-1k2l-3m4n-5o6p7q8r9s0t",email:"david.kumar@example.com",firstName:"David",lastName:"Kumar",axisEmail:"david.kumar@axis.com",reportingLevel1:"APAC",reportingLevel2:"South Asia",reportingLevel3:"India",function:"Operations",location:"Mumbai",arrivalDate:"2026-03-14",arrivalTime:"22:00",arrivalFlightNumber:"AI202",arrivalAirport:"KLIA",departureDate:"2026-03-19",departureTime:"06:30",departureFlightNumber:"AI203",departureAirport:"KLIA",hotelCheckinDate:"2026-03-14",hotelCheckoutDate:"2026-03-19",roomType:"Deluxe King",needsArrivalTransfer:!0,needsDepartureTransfer:!0,registrationStatus:"confirmed",travelType:"International",version:1,createdAt:new Date("2025-01-18"),updatedAt:new Date("2025-01-18"),deletedAt:null}],fI=[{id:"v1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",name:"Van A",type:"van",capacity:12,driverName:"Ahmad",driverPhone:"+60 12 345 6789",licensePlate:"WKL 1234",isActive:!0,createdAt:new Date("2025-01-01"),updatedAt:new Date("2025-01-01")},{id:"v2b3c4d5-e6f7-g8h9-i0j1-k2l3m4n5o6p7",name:"Bus 1",type:"bus",capacity:40,driverName:"Raj",driverPhone:"+60 12 987 6543",licensePlate:"WKL 5678",isActive:!0,createdAt:new Date("2025-01-01"),updatedAt:new Date("2025-01-01")},{id:"v3c4d5e6-f7g8-h9i0-j1k2-l3m4n5o6p7q8",name:"Sedan 1",type:"sedan",capacity:3,driverName:"Lee",driverPhone:"+60 12 111 2222",licensePlate:"WKL 9012",isActive:!0,createdAt:new Date("2025-01-01"),updatedAt:new Date("2025-01-01")}],fJ=[{id:"s1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",vehicleId:"v1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",direction:"arrival",scheduleDate:new Date().toISOString().split("T")[0],pickupTime:"10:00",pickupLocation:"KLIA Terminal 1 - Arrival Hall",dropoffLocation:"Shangri-La Hotel KL",status:"scheduled",notes:"VIP guests",createdAt:new Date("2025-01-10"),updatedAt:new Date("2025-01-10"),vehicle:{id:"v1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",name:"Van A",type:"van",capacity:12},assignments:[{id:"a1",guest:{id:"1a2b3c4d-5e6f-7g8h-9i0j-1k2l3m4n5o6p",firstName:"John",lastName:"Doe",email:"john.doe@example.com"}},{id:"a2",guest:{id:"4d5e6f7g-8h9i-0j1k-2l3m-4n5o6p7q8r9s",firstName:"Alice",lastName:"Chen",email:"alice.chen@example.com"}}]},{id:"s2b3c4d5-e6f7-g8h9-i0j1-k2l3m4n5o6p7",vehicleId:"v2b3c4d5-e6f7-g8h9-i0j1-k2l3m4n5o6p7",direction:"arrival",scheduleDate:new Date().toISOString().split("T")[0],pickupTime:"14:30",pickupLocation:"KLIA Terminal 2 - Arrival Hall",dropoffLocation:"Shangri-La Hotel KL",status:"scheduled",notes:null,createdAt:new Date("2025-01-10"),updatedAt:new Date("2025-01-10"),vehicle:{id:"v2b3c4d5-e6f7-g8h9-i0j1-k2l3m4n5o6p7",name:"Bus 1",type:"bus",capacity:40},assignments:[{id:"a3",guest:{id:"5e6f7g8h-9i0j-1k2l-3m4n-5o6p7q8r9s0t",firstName:"David",lastName:"Kumar",email:"david.kumar@example.com"}}]},{id:"s3c4d5e6-f7g8-h9i0-j1k2-l3m4n5o6p7q8",vehicleId:"v1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",direction:"departure",scheduleDate:new Date().toISOString().split("T")[0],pickupTime:"18:00",pickupLocation:"Shangri-La Hotel KL",dropoffLocation:"KLIA Terminal 1",status:"scheduled",notes:"Early departure",createdAt:new Date("2025-01-10"),updatedAt:new Date("2025-01-10"),vehicle:{id:"v1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6",name:"Van A",type:"van",capacity:12},assignments:[]}],fK=fh({search:eK().optional(),registrationStatus:fn(["pending","confirmed","cancelled","waitlisted"]).optional(),arrivalDateFrom:eK().optional(),arrivalDateTo:eK().optional(),departureDateFrom:eK().optional(),departureDateTo:eK().optional(),reportingLevel1:eK().optional(),needsTransfer:e8().optional(),page:e4().min(1).default(1),pageSize:e4().min(1).max(100).default(20),sortBy:eK().default("createdAt"),sortOrder:fn(["asc","desc"]).default("desc")}),fL=fh({email:eK().email(),firstName:eK().min(1),lastName:eK().min(1),axisEmail:eK().email().optional(),reportingLevel1:eK().optional(),reportingLevel2:eK().optional(),reportingLevel3:eK().optional(),function:eK().optional(),location:eK().optional(),arrivalDate:eK().optional(),arrivalTime:eK().optional(),arrivalFlightNumber:eK().optional(),arrivalAirport:eK().optional(),departureDate:eK().optional(),departureTime:eK().optional(),departureFlightNumber:eK().optional(),departureAirport:eK().optional(),hotelCheckinDate:eK().optional(),hotelCheckoutDate:eK().optional(),extendStayBefore:e8().optional(),extendStayAfter:e8().optional(),needsArrivalTransfer:e8().optional(),needsDepartureTransfer:e8().optional(),registrationStatus:fn(["pending","confirmed","cancelled","waitlisted"]).optional(),travelType:eK().optional()}),fM=fL.partial().extend({id:eK().uuid()}),fN=bP({list:bS.input(fK).query(async({ctx:a,input:b})=>{let{search:c,registrationStatus:d,page:e,pageSize:f}=b;if(a.isDemoMode){let a=[...fH];if(c){let b=c.toLowerCase();a=a.filter(a=>a.firstName.toLowerCase().includes(b)||a.lastName.toLowerCase().includes(b)||a.email.toLowerCase().includes(b))}d&&(a=a.filter(a=>a.registrationStatus===d)),b.reportingLevel1&&(a=a.filter(a=>a.reportingLevel1===b.reportingLevel1));let g=a.length,h=(e-1)*f;return{data:a.slice(h,h+f).map(a=>({...a,transportAssignments:[]})),pagination:{page:e,pageSize:f,total:g,totalPages:Math.ceil(g/f)}}}if(!a.db&&a.supabase){let g=a.supabase.from("guests").select("*",{count:"exact"}).is("deleted_at",null);c&&(g=g.or(`first_name.ilike.%${c}%,last_name.ilike.%${c}%,email.ilike.%${c}%,axis_email.ilike.%${c}%`)),d&&(g=g.eq("registration_status",d)),b.reportingLevel1&&(g=g.eq("reporting_level_1",b.reportingLevel1)),void 0!==b.needsTransfer&&b.needsTransfer&&(g=g.or("needs_arrival_transfer.eq.true,needs_departure_transfer.eq.true"));let h=(e-1)*f,i={createdAt:"created_at",updatedAt:"updated_at",firstName:"first_name",lastName:"last_name",arrivalDate:"arrival_date",departureDate:"departure_date"}[b.sortBy]||"created_at";g=g.order(i,{ascending:"asc"===b.sortOrder}).range(h,h+f-1);let{data:j,count:k,error:l}=await g;if(l)throw console.error("Error fetching guests:",l),Error(`Failed to fetch guests: ${l.message}`);return{data:(j||[]).map(a=>({id:a.id,email:a.email,firstName:a.first_name,lastName:a.last_name,axisEmail:a.axis_email,reportingLevel1:a.reporting_level_1,reportingLevel2:a.reporting_level_2,reportingLevel3:a.reporting_level_3,function:a.function,location:a.location,arrivalDate:a.arrival_date,arrivalTime:a.arrival_time,arrivalFlightNumber:a.arrival_flight_number,arrivalAirport:a.arrival_airport,arrivalFlightRoute:a.arrival_flight_route,departureDate:a.departure_date,departureTime:a.departure_time,departureFlightNumber:a.departure_flight_number,departureAirport:a.departure_airport,departureFlightRoute:a.departure_flight_route,hotelCheckinDate:a.hotel_checkin_date,hotelCheckoutDate:a.hotel_checkout_date,extendStayBefore:a.extend_stay_before,extendStayAfter:a.extend_stay_after,earlyCheckin:a.early_checkin,lateCheckout:a.late_checkout,needsArrivalTransfer:a.needs_arrival_transfer,needsDepartureTransfer:a.needs_departure_transfer,registrationStatus:a.registration_status,travelType:a.travel_type,version:a.version,createdAt:a.created_at,updatedAt:a.updated_at,deletedAt:a.deleted_at,transportAssignments:[]})),pagination:{page:e,pageSize:f,total:k||0,totalPages:Math.ceil((k||0)/f)}}}let g=[(0,fD.kZ)(fC.guests.deletedAt)];c&&g.push((0,fD.or)((0,fD.mj)(fC.guests.firstName,`%${c}%`),(0,fD.mj)(fC.guests.lastName,`%${c}%`),(0,fD.mj)(fC.guests.email,`%${c}%`),(0,fD.mj)(fC.guests.axisEmail,`%${c}%`))),d&&g.push((0,fD.eq)(fC.guests.registrationStatus,d)),b.reportingLevel1&&g.push((0,fD.eq)(fC.guests.reportingLevel1,b.reportingLevel1)),void 0!==b.needsTransfer&&g.push((0,fD.or)((0,fD.eq)(fC.guests.needsArrivalTransfer,b.needsTransfer),(0,fD.eq)(fC.guests.needsDepartureTransfer,b.needsTransfer)));let[{total:h}]=await a.db.select({total:fF()}).from(fC.guests).where((0,fD.Uo)(...g));return{data:await a.db.query.guests.findMany({where:(0,fD.Uo)(...g),limit:f,offset:(e-1)*f,orderBy:"desc"===b.sortOrder?(0,fG.i)(fC.guests[b.sortBy]||fC.guests.createdAt):(0,fG.Y)(fC.guests[b.sortBy]||fC.guests.createdAt),with:{transportAssignments:{with:{schedule:!0}}}}),pagination:{page:e,pageSize:f,total:h,totalPages:Math.ceil(h/f)}}}),getById:bS.input(fh({id:eK().uuid()})).query(async({ctx:a,input:b})=>{if(a.isDemoMode){let a=fH.find(a=>a.id===b.id);if(!a)throw Error("Guest not found");return{...a,transportAssignments:[]}}let c=await a.db.query.guests.findFirst({where:(0,fD.Uo)((0,fD.eq)(fC.guests.id,b.id),(0,fD.kZ)(fC.guests.deletedAt)),with:{transportAssignments:{with:{schedule:{with:{vehicle:!0}}}}}});if(!c)throw Error("Guest not found");return c}),create:bT.input(fL).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{id:`demo-${Date.now()}`,...b,version:1,createdAt:new Date,updatedAt:new Date,deletedAt:null};let[c]=await a.db.insert(fC.guests).values(b).returning();return await a.db.insert(fC.auditLogs).values({entityType:"guest",entityId:c.id,action:"create",changes:Object.entries(b).map(([a,b])=>({field:a,oldValue:null,newValue:b,fieldType:typeof b})),changeSource:"manual",performedBy:a.user.id}),c}),update:bT.input(fM).mutation(async({ctx:a,input:b})=>{let{id:c,...d}=b;if(a.isDemoMode){let a=fH.find(a=>a.id===c);if(!a)throw Error("Guest not found");return{...a,...d,version:a.version+1,updatedAt:new Date}}let e=await a.db.query.guests.findFirst({where:(0,fD.eq)(fC.guests.id,c)});if(!e)throw Error("Guest not found");let f=Object.entries(d).filter(([a,b])=>e[a]!==b).map(([a,b])=>({field:a,oldValue:e[a],newValue:b,fieldType:typeof b}));if(0===f.length)return e;let[g]=await a.db.update(fC.guests).set({...d,version:e.version+1,updatedAt:new Date}).where((0,fD.eq)(fC.guests.id,c)).returning();return await a.db.insert(fC.auditLogs).values({entityType:"guest",entityId:c,action:"update",changes:f,changeSource:"manual",performedBy:a.user.id}),g}),delete:bT.input(fh({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0};if(!await a.db.query.guests.findFirst({where:(0,fD.eq)(fC.guests.id,b.id)}))throw Error("Guest not found");return await a.db.update(fC.guests).set({deletedAt:new Date,updatedAt:new Date}).where((0,fD.eq)(fC.guests.id,b.id)),await a.db.insert(fC.auditLogs).values({entityType:"guest",entityId:b.id,action:"delete",changes:[{field:"deletedAt",oldValue:null,newValue:new Date().toISOString(),fieldType:"date"}],changeSource:"manual",performedBy:a.user.id}),{success:!0}}),stats:bS.query(async({ctx:a})=>{if(a.isDemoMode)return{total:fH.length,confirmed:fH.filter(a=>"confirmed"===a.registrationStatus).length,pending:fH.filter(a=>"pending"===a.registrationStatus).length,cancelled:fH.filter(a=>"cancelled"===a.registrationStatus).length,arrivingToday:2,arrivingTomorrow:1,departingToday:0,departingTomorrow:1,needsTransfer:fH.filter(a=>a.needsArrivalTransfer||a.needsDepartureTransfer).length};let b=new Date().toISOString().split("T")[0],c=new Date(Date.now()+864e5).toISOString().split("T")[0];if(!a.db&&a.supabase){let{data:d,error:e}=await a.supabase.from("guests").select("registration_status, arrival_date, departure_date, needs_arrival_transfer, needs_departure_transfer").is("deleted_at",null);if(e)throw console.error("Error fetching stats:",e),Error(`Failed to fetch stats: ${e.message}`);let f=d||[];return{total:f.length,confirmed:f.filter(a=>"confirmed"===a.registration_status).length,pending:f.filter(a=>"pending"===a.registration_status).length,cancelled:f.filter(a=>"cancelled"===a.registration_status).length,arrivingToday:f.filter(a=>a.arrival_date===b).length,arrivingTomorrow:f.filter(a=>a.arrival_date===c).length,departingToday:f.filter(a=>a.departure_date===b).length,departingTomorrow:f.filter(a=>a.departure_date===c).length,needsTransfer:f.filter(a=>a.needs_arrival_transfer||a.needs_departure_transfer).length}}let[d]=await a.db.select({total:fF(),confirmed:(0,fE.ll)`count(*) filter (where ${fC.guests.registrationStatus} = 'confirmed')`,pending:(0,fE.ll)`count(*) filter (where ${fC.guests.registrationStatus} = 'pending')`,cancelled:(0,fE.ll)`count(*) filter (where ${fC.guests.registrationStatus} = 'cancelled')`,arrivingToday:(0,fE.ll)`count(*) filter (where ${fC.guests.arrivalDate} = ${b})`,arrivingTomorrow:(0,fE.ll)`count(*) filter (where ${fC.guests.arrivalDate} = ${c})`,departingToday:(0,fE.ll)`count(*) filter (where ${fC.guests.departureDate} = ${b})`,departingTomorrow:(0,fE.ll)`count(*) filter (where ${fC.guests.departureDate} = ${c})`,needsTransfer:(0,fE.ll)`count(*) filter (where ${fC.guests.needsArrivalTransfer} = true or ${fC.guests.needsDepartureTransfer} = true)`}).from(fC.guests).where((0,fD.kZ)(fC.guests.deletedAt));return d}),getFilterOptions:bS.query(async({ctx:a})=>{if(a.isDemoMode){let a=[...new Set(fH.map(a=>a.reportingLevel1).filter(Boolean))];return{reportingLevels:a,locations:[...new Set(fH.map(a=>a.location).filter(Boolean))],functions:[...new Set(fH.map(a=>a.function).filter(Boolean))]}}if(!a.db&&a.supabase){let{data:b,error:c}=await a.supabase.from("guests").select("reporting_level_1, location, function").is("deleted_at",null);if(c)return console.error("Error fetching filter options:",c),{reportingLevels:[],locations:[],functions:[]};let d=b||[];return{reportingLevels:[...new Set(d.map(a=>a.reporting_level_1).filter(Boolean))],locations:[...new Set(d.map(a=>a.location).filter(Boolean))],functions:[...new Set(d.map(a=>a.function).filter(Boolean))]}}let b=await a.db.selectDistinct({value:fC.guests.reportingLevel1}).from(fC.guests).where((0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),(0,fE.ll)`${fC.guests.reportingLevel1} is not null`)),c=await a.db.selectDistinct({value:fC.guests.location}).from(fC.guests).where((0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),(0,fE.ll)`${fC.guests.location} is not null`)),d=await a.db.selectDistinct({value:fC.guests.function}).from(fC.guests).where((0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),(0,fE.ll)`${fC.guests.function} is not null`));return{reportingLevels:b.map(a=>a.value).filter(Boolean),locations:c.map(a=>a.value).filter(Boolean),functions:d.map(a=>a.value).filter(Boolean)}})}),fO={SEDAN:{name:"Sedan",minPax:1,maxPax:2,icon:"\uD83D\uDE97"},MPV:{name:"MPV",minPax:3,maxPax:4,icon:"\uD83D\uDE99"},STAREX:{name:"Starex",minPax:5,maxPax:7,icon:"\uD83D\uDE90"},VAN:{name:"Van",minPax:8,maxPax:10,icon:"\uD83D\uDE90"},BUS:{name:"Bus",minPax:11,maxPax:35,icon:"\uD83D\uDE8C"}},fP={"2026-01-18":{direction:"arrival",groups:[{id:"G1",flights:["MU8591","FM863","MH128"],gatherTime:"06:45",transportTime:"07:00",vehicleType:"BUS",combinedPax:24},{id:"G2",flights:["NH885","ANA885","MH181"],gatherTime:"07:50",transportTime:"08:00",vehicleType:"BUS",combinedPax:25},{id:"G3",flights:["MH191","MH193","MH195","MH132","MH199"],gatherTime:"08:30",transportTime:"08:30",vehicleType:"BUS",combinedPax:25},{id:"G4",flights:["MH126","SQ104"],gatherTime:"09:15",transportTime:"09:15",vehicleType:"MPV",combinedPax:4},{id:"G5",flights:["SQ106"],gatherTime:"10:30",transportTime:"10:30",vehicleType:"STAREX",combinedPax:5,remark:"Possible to combine with next transport"},{id:"G6",flights:["SQ108","MH805"],gatherTime:"11:35",transportTime:"11:45",vehicleType:"BUS",combinedPax:22},{id:"G7",flights:["BR217","GA820","TG415"],gatherTime:"12:55",transportTime:"13:00",vehicleType:"VAN",combinedPax:8},{id:"G8",flights:["H14033","VJ825"],gatherTime:"13:35",transportTime:"13:35",vehicleType:"VAN",combinedPax:4},{id:"G9",flights:["OD353","MH614","CX723","GA9282","MH712","CI721","CZ3047"],gatherTime:"13:55",transportTime:"14:00",vehicleType:"VAN",combinedPax:17},{id:"G10",flights:["SQ114","VA5434","MH134"],gatherTime:"14:55",transportTime:"15:00",vehicleType:"BUS",combinedPax:26},{id:"G11",flights:["MH146"],gatherTime:"15:15",transportTime:"15:15",vehicleType:"VAN",combinedPax:10},{id:"G12",flights:["MH710"],gatherTime:"15:20",transportTime:"15:20",vehicleType:"VAN",combinedPax:15},{id:"G13",flights:["MU8641","CZ5031","FM885"],gatherTime:"15:40",transportTime:"15:45",vehicleType:"BUS",combinedPax:31},{id:"G14",flights:["MH606","SQ238"],gatherTime:"16:15",transportTime:"16:15",vehicleType:"MPV",combinedPax:3},{id:"G15",flights:["CZ8011","MH053","MH138","MH250","SQ116","MH0067"],gatherTime:"17:15",transportTime:"17:15",vehicleType:"STAREX",combinedPax:13},{id:"G16",flights:["CX725"],gatherTime:"17:50",transportTime:"17:50",vehicleType:"VAN",combinedPax:10},{id:"G17",flights:["JL7091","MH089"],gatherTime:"18:00",transportTime:"18:00",vehicleType:"VAN",combinedPax:18},{id:"G18",flights:["MH789"],gatherTime:"18:35",transportTime:"18:35",vehicleType:"SEDAN",combinedPax:1},{id:"G19",flights:["MH9117","JL723","VN679"],gatherTime:"19:50",transportTime:"19:50",vehicleType:"VAN",combinedPax:9},{id:"G20",flights:["SQ126","MH144"],gatherTime:"20:55",transportTime:"20:55",vehicleType:"MPV",combinedPax:3},{id:"G21",flights:["SQ128"],gatherTime:"22:00",transportTime:"22:00",vehicleType:"SEDAN",combinedPax:1}]},"2026-01-21":{direction:"departure",groups:[{id:"D21-1",flights:["FM864","MU8592"],gatherTime:"02:50",transportTime:"03:05",vehicleType:"STAREX",combinedPax:6,remark:"Late Night"},{id:"D21-2",flights:["SQ105"],gatherTime:"06:15",transportTime:"06:30",vehicleType:"MPV",combinedPax:3,remark:"Late Night"},{id:"D21-3",flights:["CZ722"],gatherTime:"09:30",transportTime:"09:30",vehicleType:"SEDAN",combinedPax:1},{id:"D21-4",flights:["CZ3048"],gatherTime:"10:45",transportTime:"10:45",vehicleType:"SEDAN",combinedPax:1},{id:"D21-5",flights:["CZ5032","FM886","MU8642"],gatherTime:"11:30",transportTime:"11:40",vehicleType:"BUS",combinedPax:21},{id:"D21-6",flights:["SQ115"],gatherTime:"13:00",transportTime:"13:00",vehicleType:"SEDAN",combinedPax:1},{id:"D21-7",flights:["CX724"],gatherTime:"13:40",transportTime:"13:50",vehicleType:"MPV",combinedPax:3},{id:"D21-8",flights:["SQ8551"],gatherTime:"15:10",transportTime:"15:10",vehicleType:"SEDAN",combinedPax:1,isT2:!0,remark:"T2 Departure"},{id:"D21-9",flights:["VN678"],gatherTime:"15:50",transportTime:"15:50",vehicleType:"SEDAN",combinedPax:1},{id:"D21-10",flights:["SQ125","MH147"],gatherTime:"16:20",transportTime:"16:30",vehicleType:"MPV",combinedPax:3},{id:"D21-11",flights:["6E1038","MH192"],gatherTime:"17:10",transportTime:"17:15",vehicleType:"MPV",combinedPax:3},{id:"D21-12",flights:["JL724"],gatherTime:"18:50",transportTime:"18:50",vehicleType:"SEDAN",combinedPax:1},{id:"D21-13",flights:["KL810"],gatherTime:"19:50",transportTime:"19:50",vehicleType:"SEDAN",combinedPax:1},{id:"D21-14",flights:["HO1354"],gatherTime:"20:15",transportTime:"20:25",vehicleType:"STAREX",combinedPax:6}]},"2026-01-22":{direction:"departure",groups:[{id:"D22-1",flights:["NH816","CX730"],gatherTime:"04:00",transportTime:"04:05",vehicleType:"STAREX",combinedPax:7,remark:"Late Night"},{id:"D22-2",flights:["MH70","JL7092"],gatherTime:"05:15",transportTime:"05:30",vehicleType:"STAREX",combinedPax:6,remark:"Late Night"},{id:"D22-3",flights:["SQ105"],gatherTime:"06:15",transportTime:"06:30",vehicleType:"SEDAN",combinedPax:2,remark:"Late Night"},{id:"D22-4",flights:["SQ107"],gatherTime:"06:45",transportTime:"07:05",vehicleType:"STAREX",combinedPax:11,remark:"Late Night - Possible to make it 7am?"},{id:"D22-5",flights:["GA821","MH5860","TG416"],gatherTime:"08:45",transportTime:"08:50",vehicleType:"VAN",combinedPax:8},{id:"D22-6",flights:["MH38","VJ826"],gatherTime:"09:15",transportTime:"09:25",vehicleType:"MPV",combinedPax:3},{id:"D22-7",flights:["NH886"],gatherTime:"10:00",transportTime:"10:15",vehicleType:"BUS",combinedPax:22},{id:"D22-8",flights:["CI722"],gatherTime:"10:30",transportTime:"10:35",vehicleType:"VAN",combinedPax:8},{id:"D22-9",flights:["MH758","SQ113","MH782"],gatherTime:"10:30",transportTime:"10:40",vehicleType:"VAN",combinedPax:9},{id:"D22-10",flights:["BR228","MH605"],gatherTime:"11:15",transportTime:"11:25",vehicleType:"MPV",combinedPax:3},{id:"D22-11",flights:["MU8642"],gatherTime:"11:45",transportTime:"12:00",vehicleType:"STAREX",combinedPax:11},{id:"D22-12",flights:["SQ115"],gatherTime:"12:45",transportTime:"13:00",vehicleType:"STAREX",combinedPax:7},{id:"D22-13",flights:["MH804"],gatherTime:"13:30",transportTime:"13:35",vehicleType:"MPV",combinedPax:3},{id:"D22-14",flights:["CX724","MH725","GA9275"],gatherTime:"13:45",transportTime:"13:50",vehicleType:"VAN",combinedPax:9},{id:"D22-15",flights:["SQ121","MH190"],gatherTime:"14:45",transportTime:"14:30",vehicleType:"STAREX",combinedPax:6},{id:"D22-16",flights:["MH194"],gatherTime:"15:45",transportTime:"15:55",vehicleType:"MPV",combinedPax:3},{id:"D22-17",flights:["SQ125","MH251"],gatherTime:"16:15",transportTime:"16:30",vehicleType:"STAREX",combinedPax:5},{id:"D22-18",flights:["MH198"],gatherTime:"17:15",transportTime:"17:25",vehicleType:"SEDAN",combinedPax:2},{id:"D22-19",flights:["MH180","MH192"],gatherTime:"17:30",transportTime:"17:30",vehicleType:"STAREX",combinedPax:13},{id:"D22-20",flights:["MH139","MH52"],gatherTime:"18:15",transportTime:"18:30",vehicleType:"MPV",combinedPax:3},{id:"D22-21",flights:["JL724","MH9118"],gatherTime:"18:45",transportTime:"18:50",vehicleType:"STAREX",combinedPax:6},{id:"D22-22",flights:["KE672"],gatherTime:"19:45",transportTime:"19:55",vehicleType:"MPV",combinedPax:3}]},"2026-01-23":{direction:"departure",groups:[{id:"D23-1",flights:["MH141","MH125"],gatherTime:"05:00",transportTime:"05:10",vehicleType:"STAREX",combinedPax:6,remark:"Late Night"},{id:"D23-2",flights:["MH129"],gatherTime:"05:45",transportTime:"05:50",vehicleType:"STAREX",combinedPax:5,remark:"Late Night"},{id:"D23-3",flights:["SQ107","AK451"],gatherTime:"07:00",transportTime:"07:05",vehicleType:"STAREX",combinedPax:6},{id:"D23-4",flights:["AK884"],gatherTime:"09:15",transportTime:"09:25",vehicleType:"SEDAN",combinedPax:1,isT2:!0,remark:"T2 Departure"},{id:"D23-5",flights:["CX722"],gatherTime:"09:30",transportTime:"09:35",vehicleType:"MPV",combinedPax:3},{id:"D23-6",flights:["NH886"],gatherTime:"10:15",transportTime:"10:15",vehicleType:"SEDAN",combinedPax:1},{id:"D23-7",flights:["MU8642"],gatherTime:"12:00",transportTime:"12:00",vehicleType:"SEDAN",combinedPax:1},{id:"D23-8",flights:["SQ115"],gatherTime:"13:00",transportTime:"13:00",vehicleType:"SEDAN",combinedPax:1},{id:"D23-9",flights:["SQ8583","TR473"],gatherTime:"14:00",transportTime:"14:15",vehicleType:"MPV",combinedPax:3},{id:"D23-10",flights:["SQ8551"],gatherTime:"15:00",transportTime:"15:10",vehicleType:"SEDAN",combinedPax:1},{id:"D23-11",flights:["MH251","MH135"],gatherTime:"16:15",transportTime:"16:30",vehicleType:"MPV",combinedPax:4},{id:"D23-12",flights:["MH147"],gatherTime:"16:30",transportTime:"16:35",vehicleType:"STAREX",combinedPax:6},{id:"D23-13",flights:["MH145","TG418"],gatherTime:"16:50",transportTime:"17:05",vehicleType:"MPV",combinedPax:3},{id:"D23-14",flights:["MH192"],gatherTime:"17:15",transportTime:"17:30",vehicleType:"SEDAN",combinedPax:1},{id:"D23-15",flights:["VA5447"],gatherTime:"17:30",transportTime:"17:50",vehicleType:"SEDAN",combinedPax:1},{id:"D23-16",flights:["MH139","MH149"],gatherTime:"18:15",transportTime:"18:30",vehicleType:"SEDAN",combinedPax:2},{id:"D23-17",flights:["MH52","MH9118"],gatherTime:"18:30",transportTime:"18:40",vehicleType:"STAREX",combinedPax:5},{id:"D23-18",flights:["KE672"],gatherTime:"19:45",transportTime:"19:55",vehicleType:"SEDAN",combinedPax:2}]}};function fQ(a,b){let c=fP[b];if(!c)return null;let d=a.toUpperCase().replace(/\s+/g,"");return c.groups.find(a=>a.flights.some(a=>{let b=a.toUpperCase().replace(/\s+/g,"");return b===d||function(a,b){let c=a.toUpperCase().replace(/\s+/g,""),d=b.toUpperCase().replace(/\s+/g,"");if(c===d)return!0;let e=fU[c];return!!e&&e.includes(d)}(b,d)}))||null}function fR(){return Object.keys(fP).sort()}function fS(a){if(a<=2)return{...fO.SEDAN,type:"SEDAN"};if(a<=4)return{...fO.MPV,type:"MPV"};if(a<=7)return{...fO.STAREX,type:"STAREX"};if(a<=9)return{...fO.VAN,type:"VAN"};if(a<=35)return{...fO.BUS,type:"BUS"};let b=Math.ceil(a/35);return{...fO.BUS,type:"BUS",needsMultiple:!0,vehicleCount:b}}function fT(a){if(!a)return!1;let b=a.match(/^(\d{1,2}):(\d{2})/);if(!b)return!1;let c=parseInt(b[1],10);return c>=23||c<7}let fU={GA9282:["MH712"],MH712:["GA9282"],SQ114:["VA5434"],VA5434:["SQ114"],MU8641:["FM885"],FM885:["MU8641"],JL7091:["MH089","MH89"],MH089:["JL7091"],MH89:["JL7091"],JL723:["MH9117"],MH9117:["JL723"],FM864:["MU8592"],MU8592:["FM864"],FM886:["MU8642"],MU8642:["FM886"],JL7092:["MH70"],MH70:["JL7092"],MH5860:["TG416"],TG416:["MH5860"],MH725:["GA9275"],GA9275:["MH725"],JL724:["MH9118"],MH9118:["JL724"],SQ8583:["TR473"],TR473:["SQ8583"],ANA885:["NH885"],NH885:["ANA885"]},fV=fh({name:eK().min(1),type:eK().min(1),capacity:e4().min(1),driverName:eK().optional(),driverPhone:eK().optional(),licensePlate:eK().optional()}),fW=fh({vehicleId:eK().uuid(),direction:fn(["arrival","departure"]),scheduleDate:eK(),pickupTime:eK(),pickupLocation:eK().optional(),dropoffLocation:eK().optional(),notes:eK().optional()}),fX=fh({guestId:eK().uuid(),scheduleId:eK().uuid(),assignmentType:fn(["arrival","departure"])});function fY(a){return!a.db&&a.supabase&&!a.isDemoMode}let fZ=bP({vehicles:bP({list:bU.query(async({ctx:a})=>{if(a.isDemoMode)return fI;if(fY(a)){let{data:b,error:c}=await a.supabase.from("vehicles").select("*").eq("is_active",!0).order("name",{ascending:!0});if(c)throw Error(c.message);return b?.map(a=>({id:a.id,name:a.name,vehicleType:a.vehicle_type,capacity:a.capacity,driverName:a.driver_name,driverPhone:a.driver_phone,licensePlate:a.license_plate,isActive:a.is_active,createdAt:a.created_at,updatedAt:a.updated_at}))||[]}return a.db.query.vehicles.findMany({where:(0,fD.eq)(fC.vehicles.isActive,!0),orderBy:(0,fG.Y)(fC.vehicles.name)})}),getById:bU.input(fh({id:eK().uuid()})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return fI.find(a=>a.id===b.id)||null;if(fY(a)){let{data:c,error:d}=await a.supabase.from("vehicles").select(`
              *,
              transport_schedules (
                *,
                guest_transport_assignments (
                  *,
                  guests (*)
                )
              )
            `).eq("id",b.id).single();return d?null:c}return a.db.query.vehicles.findFirst({where:(0,fD.eq)(fC.vehicles.id,b.id),with:{schedules:{with:{assignments:{with:{guest:!0}}}}}})}),create:bT.input(fV).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{id:`demo-vehicle-${Date.now()}`,...b,isActive:!0,createdAt:new Date,updatedAt:new Date};if(fY(a)){let{data:c,error:d}=await a.supabase.from("vehicles").insert({name:b.name,vehicle_type:b.type,capacity:b.capacity,driver_name:b.driverName,driver_phone:b.driverPhone,license_plate:b.licensePlate}).select().single();if(d)throw Error(d.message);return c}let[c]=await a.db.insert(fC.vehicles).values(b).returning();return await a.db.insert(fC.auditLogs).values({entityType:"vehicle",entityId:c.id,action:"create",changes:Object.entries(b).map(([a,b])=>({field:a,oldValue:null,newValue:b,fieldType:typeof b})),changeSource:"manual",performedBy:a.user.id}),c}),update:bT.input(fV.extend({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{let{id:c,...d}=b;if(a.isDemoMode){let a=fI.find(a=>a.id===c);if(!a)throw Error("Vehicle not found");return{...a,...d,updatedAt:new Date}}if(fY(a)){let{data:b,error:e}=await a.supabase.from("vehicles").update({name:d.name,vehicle_type:d.type,capacity:d.capacity,driver_name:d.driverName,driver_phone:d.driverPhone,license_plate:d.licensePlate,updated_at:new Date().toISOString()}).eq("id",c).select().single();if(e)throw Error(e.message);return b}let e=await a.db.query.vehicles.findFirst({where:(0,fD.eq)(fC.vehicles.id,c)});if(!e)throw Error("Vehicle not found");let f=Object.entries(d).filter(([a,b])=>e[a]!==b).map(([a,b])=>({field:a,oldValue:e[a],newValue:b,fieldType:typeof b})),[g]=await a.db.update(fC.vehicles).set({...d,updatedAt:new Date}).where((0,fD.eq)(fC.vehicles.id,c)).returning();return f.length>0&&await a.db.insert(fC.auditLogs).values({entityType:"vehicle",entityId:c,action:"update",changes:f,changeSource:"manual",performedBy:a.user.id}),g}),delete:bT.input(fh({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0};if(fY(a)){let{error:c}=await a.supabase.from("vehicles").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",b.id);if(c)throw Error(c.message);return{success:!0}}return await a.db.update(fC.vehicles).set({isActive:!1,updatedAt:new Date}).where((0,fD.eq)(fC.vehicles.id,b.id)),await a.db.insert(fC.auditLogs).values({entityType:"vehicle",entityId:b.id,action:"delete",changes:[{field:"isActive",oldValue:!0,newValue:!1,fieldType:"boolean"}],changeSource:"manual",performedBy:a.user.id}),{success:!0}})}),schedules:bP({list:bU.input(fh({dateFrom:eK().optional(),dateTo:eK().optional(),direction:fn(["arrival","departure"]).optional(),vehicleId:eK().uuid().optional()}).optional()).query(async({ctx:a,input:b})=>{if(a.isDemoMode){let a=[...fJ];return b?.dateFrom&&(a=a.filter(a=>a.scheduleDate>=b.dateFrom)),b?.dateTo&&(a=a.filter(a=>a.scheduleDate<=b.dateTo)),b?.direction&&(a=a.filter(a=>a.direction===b.direction)),b?.vehicleId&&(a=a.filter(a=>a.vehicleId===b.vehicleId)),a}if(fY(a)){let c=a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (
                *,
                guest:guests (*)
              )
            `).order("schedule_date",{ascending:!0}).order("pickup_time",{ascending:!0});b?.dateFrom&&(c=c.gte("schedule_date",b.dateFrom)),b?.dateTo&&(c=c.lte("schedule_date",b.dateTo)),b?.direction&&(c=c.eq("direction",b.direction)),b?.vehicleId&&(c=c.eq("vehicle_id",b.vehicleId));let{data:d,error:e}=await c;if(e)throw Error(e.message);return d?.map(a=>({id:a.id,vehicleId:a.vehicle_id,direction:a.direction,scheduleDate:a.schedule_date,pickupTime:a.pickup_time,pickupLocation:a.pickup_location,dropoffLocation:a.dropoff_location,status:a.status,notes:a.notes,createdAt:a.created_at,updatedAt:a.updated_at,vehicle:a.vehicle?{id:a.vehicle.id,name:a.vehicle.name,vehicleType:a.vehicle.vehicle_type,capacity:a.vehicle.capacity,driverName:a.vehicle.driver_name,driverPhone:a.vehicle.driver_phone,licensePlate:a.vehicle.license_plate,isActive:a.vehicle.is_active}:null,assignments:a.assignments?.map(a=>({id:a.id,scheduleId:a.schedule_id,guestId:a.guest_id,assignmentType:a.assignment_type,status:a.status,createdAt:a.created_at,updatedAt:a.updated_at,guest:a.guest?{id:a.guest.id,firstName:a.guest.first_name,lastName:a.guest.last_name,email:a.guest.email,phone:a.guest.phone,arrivalDate:a.guest.arrival_date,arrivalTime:a.guest.arrival_time,arrivalFlightNumber:a.guest.arrival_flight_number,departureDate:a.guest.departure_date,departureTime:a.guest.departure_time,departureFlightNumber:a.guest.departure_flight_number}:null}))||[]}))||[]}let c=[];return b?.dateFrom&&c.push((0,fD.RO)(fC.transportSchedules.scheduleDate,b.dateFrom)),b?.dateTo&&c.push((0,fD.wJ)(fC.transportSchedules.scheduleDate,b.dateTo)),b?.direction&&c.push((0,fD.eq)(fC.transportSchedules.direction,b.direction)),b?.vehicleId&&c.push((0,fD.eq)(fC.transportSchedules.vehicleId,b.vehicleId)),a.db.query.transportSchedules.findMany({where:c.length>0?(0,fD.Uo)(...c):void 0,orderBy:[(0,fG.Y)(fC.transportSchedules.scheduleDate),(0,fG.Y)(fC.transportSchedules.pickupTime)],with:{vehicle:!0,assignments:{with:{guest:!0}}}})}),getById:bU.input(fh({id:eK().uuid()})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return fJ.find(a=>a.id===b.id)||null;if(fY(a)){let{data:c,error:d}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (
                *,
                guest:guests (*)
              )
            `).eq("id",b.id).single();return d?null:c}return a.db.query.transportSchedules.findFirst({where:(0,fD.eq)(fC.transportSchedules.id,b.id),with:{vehicle:!0,assignments:{with:{guest:!0}}}})}),create:bU.input(fW).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{id:`demo-schedule-${Date.now()}`,...b,status:"scheduled",createdAt:new Date,updatedAt:new Date};if(fY(a)){let{data:c,error:d}=await a.supabase.from("transport_schedules").insert({vehicle_id:b.vehicleId,direction:b.direction,schedule_date:b.scheduleDate,pickup_time:b.pickupTime,pickup_location:b.pickupLocation,dropoff_location:b.dropoffLocation,notes:b.notes,status:"scheduled"}).select().single();if(d)throw Error(d.message);return c}let[c]=await a.db.insert(fC.transportSchedules).values(b).returning();return await a.db.insert(fC.auditLogs).values({entityType:"transport_schedule",entityId:c.id,action:"create",changes:Object.entries(b).map(([a,b])=>({field:a,oldValue:null,newValue:b,fieldType:typeof b})),changeSource:"manual",performedBy:a.user.id}),c}),update:bU.input(fW.partial().extend({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{let{id:c,...d}=b;if(a.isDemoMode){let a=fJ.find(a=>a.id===c);if(!a)throw Error("Schedule not found");return{...a,...d,updatedAt:new Date}}if(fY(a)){let b={updated_at:new Date().toISOString()};d.vehicleId&&(b.vehicle_id=d.vehicleId),d.direction&&(b.direction=d.direction),d.scheduleDate&&(b.schedule_date=d.scheduleDate),d.pickupTime&&(b.pickup_time=d.pickupTime),void 0!==d.pickupLocation&&(b.pickup_location=d.pickupLocation),void 0!==d.dropoffLocation&&(b.dropoff_location=d.dropoffLocation),void 0!==d.notes&&(b.notes=d.notes);let{data:e,error:f}=await a.supabase.from("transport_schedules").update(b).eq("id",c).select().single();if(f)throw Error(f.message);return e}let e=await a.db.query.transportSchedules.findFirst({where:(0,fD.eq)(fC.transportSchedules.id,c)});if(!e)throw Error("Schedule not found");let f=Object.entries(d).filter(([a,b])=>e[a]!==b).map(([a,b])=>({field:a,oldValue:e[a],newValue:b,fieldType:typeof b})),[g]=await a.db.update(fC.transportSchedules).set({...d,updatedAt:new Date}).where((0,fD.eq)(fC.transportSchedules.id,c)).returning();return f.length>0&&await a.db.insert(fC.auditLogs).values({entityType:"transport_schedule",entityId:c,action:"update",changes:f,changeSource:"manual",performedBy:a.user.id}),g}),delete:bU.input(fh({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0};if(fY(a)){await a.supabase.from("guest_transport_assignments").delete().eq("schedule_id",b.id);let{error:c}=await a.supabase.from("transport_schedules").delete().eq("id",b.id);if(c)throw Error(c.message);return{success:!0}}return await a.db.delete(fC.guestTransportAssignments).where((0,fD.eq)(fC.guestTransportAssignments.scheduleId,b.id)),await a.db.delete(fC.transportSchedules).where((0,fD.eq)(fC.transportSchedules.id,b.id)),await a.db.insert(fC.auditLogs).values({entityType:"transport_schedule",entityId:b.id,action:"delete",changes:[],changeSource:"manual",performedBy:a.user.id}),{success:!0}})}),assignments:bP({assign:bU.input(fX).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{id:`demo-assignment-${Date.now()}`,...b,createdAt:new Date};if(fY(a)){let{data:c}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (*)
            `).eq("id",b.scheduleId).single();if(!c)throw Error("Schedule not found");let d=c.assignments?.length||0;if(c.vehicle&&d>=c.vehicle.capacity)throw Error("Vehicle is at full capacity");let{data:e}=await a.supabase.from("guest_transport_assignments").select("*").eq("guest_id",b.guestId).eq("assignment_type",b.assignmentType).maybeSingle();if(e)throw Error(`Guest already has ${b.assignmentType} transport assigned`);let{data:f,error:g}=await a.supabase.from("guest_transport_assignments").insert({guest_id:b.guestId,schedule_id:b.scheduleId,assignment_type:b.assignmentType}).select().single();if(g)throw Error(g.message);return f}let c=await a.db.query.transportSchedules.findFirst({where:(0,fD.eq)(fC.transportSchedules.id,b.scheduleId),with:{vehicle:!0,assignments:!0}});if(!c)throw Error("Schedule not found");let d=c.assignments.length;if(c.vehicle&&d>=c.vehicle.capacity)throw Error("Vehicle is at full capacity");if(await a.db.query.guestTransportAssignments.findFirst({where:(0,fD.Uo)((0,fD.eq)(fC.guestTransportAssignments.guestId,b.guestId),(0,fD.eq)(fC.guestTransportAssignments.assignmentType,b.assignmentType))}))throw Error(`Guest already has ${b.assignmentType} transport assigned`);let[e]=await a.db.insert(fC.guestTransportAssignments).values(b).returning();return await a.db.insert(fC.auditLogs).values({entityType:"assignment",entityId:e.id,action:"create",changes:Object.entries(b).map(([a,b])=>({field:a,oldValue:null,newValue:b,fieldType:typeof b})),changeSource:"manual",performedBy:a.user.id}),e}),unassign:bU.input(fh({id:eK().uuid()})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0};if(fY(a)){let{error:c}=await a.supabase.from("guest_transport_assignments").delete().eq("id",b.id);if(c)throw Error(c.message);return{success:!0}}return await a.db.delete(fC.guestTransportAssignments).where((0,fD.eq)(fC.guestTransportAssignments.id,b.id)),await a.db.insert(fC.auditLogs).values({entityType:"assignment",entityId:b.id,action:"delete",changes:[],changeSource:"manual",performedBy:a.user.id}),{success:!0}}),bulkAssign:bU.input(fh({scheduleId:eK().uuid(),guestIds:ff(eK().uuid()),assignmentType:fn(["arrival","departure"])})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return b.guestIds.map((a,c)=>({id:`demo-assignment-${Date.now()}-${c}`,guestId:a,scheduleId:b.scheduleId,assignmentType:b.assignmentType,createdAt:new Date}));if(fY(a)){let{data:c}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (*)
            `).eq("id",b.scheduleId).single();if(!c)throw Error("Schedule not found");let d=c.assignments?.length||0,e=d+b.guestIds.length;if(c.vehicle&&e>c.vehicle.capacity)throw Error(`Cannot assign ${b.guestIds.length} guests. Only ${c.vehicle.capacity-d} spots available.`);let{data:f,error:g}=await a.supabase.from("guest_transport_assignments").insert(b.guestIds.map(a=>({guest_id:a,schedule_id:b.scheduleId,assignment_type:b.assignmentType}))).select();if(g)throw Error(g.message);return f}let c=await a.db.query.transportSchedules.findFirst({where:(0,fD.eq)(fC.transportSchedules.id,b.scheduleId),with:{vehicle:!0,assignments:!0}});if(!c)throw Error("Schedule not found");let d=c.assignments.length,e=d+b.guestIds.length;if(c.vehicle&&e>c.vehicle.capacity)throw Error(`Cannot assign ${b.guestIds.length} guests. Only ${c.vehicle.capacity-d} spots available.`);return await a.db.insert(fC.guestTransportAssignments).values(b.guestIds.map(a=>({guestId:a,scheduleId:b.scheduleId,assignmentType:b.assignmentType}))).returning()})}),dashboard:bP({todaySchedule:bU.query(async({ctx:a})=>{let b=new Date().toISOString().split("T")[0];if(a.isDemoMode)return fJ.filter(a=>a.scheduleDate===b);if(fY(a)){let{data:c,error:d}=await a.supabase.from("transport_schedules").select(`
            *,
            vehicle:vehicles (*),
            assignments:guest_transport_assignments (
              *,
              guest:guests (*)
            )
          `).eq("schedule_date",b).order("pickup_time",{ascending:!0});if(d)throw Error(d.message);return c||[]}return a.db.query.transportSchedules.findMany({where:(0,fD.eq)(fC.transportSchedules.scheduleDate,b),orderBy:(0,fG.Y)(fC.transportSchedules.pickupTime),with:{vehicle:!0,assignments:{with:{guest:!0}}}})}),unassignedGuests:bU.input(fh({direction:fn(["arrival","departure"]),date:eK().optional()})).query(async({ctx:a,input:b})=>{let{direction:c,date:d}=b;if(a.isDemoMode)return fH.filter(a=>{let b="arrival"===c?a.needsArrivalTransfer:a.needsDepartureTransfer,e=!d||("arrival"===c?a.arrivalDate===d:a.departureDate===d);return b&&e});if(fY(a)){let b=a.supabase.from("guests").select(`
              *,
              transport_assignments:guest_transport_assignments (*)
            `).is("deleted_at",null).eq("arrival"===c?"needs_arrival_transfer":"needs_departure_transfer",!0);d&&(b=b.eq("arrival"===c?"arrival_date":"departure_date",d));let{data:e,error:f}=await b;if(f)throw Error(f.message);return(e||[]).filter(a=>!a.transport_assignments?.some(a=>a.assignment_type===c)).map(a=>({id:a.id,firstName:a.first_name,lastName:a.last_name,email:a.email,phone:a.phone,arrivalDate:a.arrival_date,arrivalTime:a.arrival_time,arrivalFlightNumber:a.arrival_flight_number,departureDate:a.departure_date,departureTime:a.departure_time,departureFlightNumber:a.departure_flight_number,needsArrivalTransfer:a.needs_arrival_transfer,needsDepartureTransfer:a.needs_departure_transfer,travelType:a.travel_type}))}return(await a.db.query.guests.findMany({where:(0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),"arrival"===c?(0,fD.eq)(fC.guests.needsArrivalTransfer,!0):(0,fD.eq)(fC.guests.needsDepartureTransfer,!0),d?"arrival"===c?(0,fD.eq)(fC.guests.arrivalDate,d):(0,fD.eq)(fC.guests.departureDate,d):void 0),with:{transportAssignments:!0}})).filter(a=>!a.transportAssignments.some(a=>a.assignmentType===c))}),stats:bU.query(async({ctx:a})=>{if(a.isDemoMode){let a=fH.filter(a=>a.needsArrivalTransfer).length,b=fH.filter(a=>a.needsDepartureTransfer).length,c=fJ.filter(a=>"arrival"===a.direction).reduce((a,b)=>a+(b.assignments?.length||0),0),d=fJ.filter(a=>"departure"===a.direction).reduce((a,b)=>a+(b.assignments?.length||0),0),e=new Date().toISOString().split("T")[0];return{arrivalNeedingTransfer:a,departureNeedingTransfer:b,arrivalAssigned:c,departureAssigned:d,todaySchedules:fJ.filter(a=>a.scheduleDate===e).length}}if(fY(a)){let b=new Date().toISOString().split("T")[0],{count:c}=await a.supabase.from("guests").select("*",{count:"exact",head:!0}).is("deleted_at",null).eq("needs_arrival_transfer",!0),{count:d}=await a.supabase.from("guests").select("*",{count:"exact",head:!0}).is("deleted_at",null).eq("needs_departure_transfer",!0),{count:e}=await a.supabase.from("guest_transport_assignments").select("*",{count:"exact",head:!0}).eq("assignment_type","arrival"),{count:f}=await a.supabase.from("guest_transport_assignments").select("*",{count:"exact",head:!0}).eq("assignment_type","departure"),{count:g}=await a.supabase.from("transport_schedules").select("*",{count:"exact",head:!0}).eq("schedule_date",b);return{arrivalNeedingTransfer:c||0,departureNeedingTransfer:d||0,arrivalAssigned:e||0,departureAssigned:f||0,todaySchedules:g||0}}let b=new Date().toISOString().split("T")[0],[c]=await a.db.select({total:fF()}).from(fC.guests).where((0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),(0,fD.eq)(fC.guests.needsArrivalTransfer,!0))),[d]=await a.db.select({total:fF()}).from(fC.guests).where((0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),(0,fD.eq)(fC.guests.needsDepartureTransfer,!0))),[e]=await a.db.select({arrivals:(0,fE.ll)`count(*) filter (where ${fC.guestTransportAssignments.assignmentType} = 'arrival')`,departures:(0,fE.ll)`count(*) filter (where ${fC.guestTransportAssignments.assignmentType} = 'departure')`}).from(fC.guestTransportAssignments),[f]=await a.db.select({total:fF()}).from(fC.transportSchedules).where((0,fD.eq)(fC.transportSchedules.scheduleDate,b));return{arrivalNeedingTransfer:c.total,departureNeedingTransfer:d.total,arrivalAssigned:e.arrivals,departureAssigned:e.departures,todaySchedules:f.total}}),delayedFlights:bU.input(fh({date:eK().optional(),direction:fn(["arrival","departure"]).optional()}).optional()).query(async({ctx:a,input:b})=>{let c=b?.date||new Date().toISOString().split("T")[0];if(a.isDemoMode)return{impactedSchedules:[],delayedGuests:[],availableCapacity:[]};if(fY(a)){let d=a.supabase.from("guests").select(`
              *,
              transport_assignments:guest_transport_assignments (
                *,
                schedule:transport_schedules (
                  *,
                  vehicle:vehicles (*)
                )
              )
            `).is("deleted_at",null);b?.direction!=="arrival"&&b?.direction||(d=d.eq("arrival_date",c)),b?.direction==="departure"&&(d=d.eq("departure_date",c));let{data:e,error:f}=await d;if(f)throw Error(f.message);let g=(e||[]).filter(a=>!((b?.direction!=="arrival"&&b?.direction||!a.arrival_time_mismatch&&"cancelled"!==a.arrival_flight_status&&"diverted"!==a.arrival_flight_status)&&(b?.direction!=="departure"&&b?.direction||!a.departure_time_mismatch&&"cancelled"!==a.departure_flight_status&&"diverted"!==a.departure_flight_status))),{data:h}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (*)
            `).eq("schedule_date",c),i=(h||[]).filter(a=>!!a.vehicle&&(a.assignments?.length||0)<a.vehicle.capacity).map(a=>({scheduleId:a.id,vehicleName:a.vehicle?.name||"Unknown",direction:a.direction,pickupTime:a.pickup_time,currentCount:a.assignments?.length||0,capacity:a.vehicle?.capacity||0,availableSpots:(a.vehicle?.capacity||0)-(a.assignments?.length||0)}));return{delayedGuests:g.map(a=>({id:a.id,name:`${a.first_name} ${a.last_name}`,arrivalFlight:a.arrival_flight_number,arrivalTime:a.arrival_time,arrivalVerifiedTime:a.arrival_verified_time,arrivalStatus:a.arrival_flight_status,arrivalTimeMismatch:a.arrival_time_mismatch,departureFlight:a.departure_flight_number,departureTime:a.departure_time,departureVerifiedTime:a.departure_verified_time,departureStatus:a.departure_flight_status,departureTimeMismatch:a.departure_time_mismatch,currentAssignments:(a.transport_assignments||[]).map(a=>({id:a.id,type:a.assignment_type,scheduleId:a.schedule_id,scheduledPickup:a.schedule?.pickup_time,vehicleName:a.schedule?.vehicle?.name}))})),impactedScheduleCount:new Set(g.flatMap(a=>(a.transport_assignments||[]).map(a=>a.schedule_id))).size,availableCapacity:i}}let d=(await a.db.query.guests.findMany({where:(0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),b?.direction!=="arrival"&&b?.direction?void 0:(0,fD.eq)(fC.guests.arrivalDate,c),b?.direction!=="departure"&&b?.direction?void 0:(0,fD.eq)(fC.guests.departureDate,c)),with:{transportAssignments:{with:{schedule:{with:{vehicle:!0}}}}}})).filter(a=>!((b?.direction!=="arrival"&&b?.direction||!a.arrivalTimeMismatch&&"cancelled"!==a.arrivalFlightStatus&&"diverted"!==a.arrivalFlightStatus)&&(b?.direction!=="departure"&&b?.direction||!a.departureTimeMismatch&&"cancelled"!==a.departureFlightStatus&&"diverted"!==a.departureFlightStatus))),e=new Set;d.forEach(a=>{a.transportAssignments.forEach(a=>{e.add(a.scheduleId)})});let f=(await a.db.query.transportSchedules.findMany({where:(0,fD.eq)(fC.transportSchedules.scheduleDate,c),with:{vehicle:!0,assignments:!0}})).filter(a=>!!a.vehicle&&a.assignments.length<a.vehicle.capacity).map(a=>({scheduleId:a.id,vehicleName:a.vehicle?.name||"Unknown",direction:a.direction,pickupTime:a.pickupTime,currentCount:a.assignments.length,capacity:a.vehicle?.capacity||0,availableSpots:(a.vehicle?.capacity||0)-a.assignments.length}));return{delayedGuests:d.map(a=>({id:a.id,name:`${a.firstName} ${a.lastName}`,arrivalFlight:a.arrivalFlightNumber,arrivalTime:a.arrivalTime,arrivalVerifiedTime:a.arrivalVerifiedTime,arrivalStatus:a.arrivalFlightStatus,arrivalTimeMismatch:a.arrivalTimeMismatch,departureFlight:a.departureFlightNumber,departureTime:a.departureTime,departureVerifiedTime:a.departureVerifiedTime,departureStatus:a.departureFlightStatus,departureTimeMismatch:a.departureTimeMismatch,currentAssignments:a.transportAssignments.map(a=>({id:a.id,type:a.assignmentType,scheduleId:a.scheduleId,scheduledPickup:a.schedule?.pickupTime,vehicleName:a.schedule?.vehicle?.name}))})),impactedScheduleCount:e.size,availableCapacity:f}}),flightGroupings:bU.input(fh({date:eK(),direction:fn(["arrival","departure"]),timeWindowMinutes:e4().default(60)})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return[];if(fY(a)){let c="arrival"===b.direction?"needs_arrival_transfer":"needs_departure_transfer",d="arrival"===b.direction?"arrival_date":"departure_date",{data:e,error:f}=await a.supabase.from("guests").select(`
              *,
              transport_assignments:guest_transport_assignments (*)
            `).is("deleted_at",null).eq(d,b.date).eq(c,!0);if(f)throw Error(f.message);let g=(e||[]).filter(a=>!a.transport_assignments?.some(a=>a.assignment_type===b.direction)),h=new Map;for(let a of g){let c="arrival"===b.direction?a.arrival_verified_time||a.arrival_time:a.departure_verified_time||a.departure_time;if(!c)continue;let[d,e]=c.split(":").map(Number),f=Math.floor((60*d+e)/b.timeWindowMinutes)*b.timeWindowMinutes,g=Math.floor(f/60),i=f%60,j=`${String(g).padStart(2,"0")}:${String(i).padStart(2,"0")}`;h.has(j)||h.set(j,[]),h.get(j).push(a)}return Array.from(h.entries()).map(([a,c])=>({timeWindow:a,guestCount:c.length,guests:c.map(a=>({id:a.id,name:`${a.first_name} ${a.last_name}`,flightNumber:"arrival"===b.direction?a.arrival_flight_number:a.departure_flight_number,time:"arrival"===b.direction?a.arrival_verified_time||a.arrival_time:a.departure_verified_time||a.departure_time,status:"arrival"===b.direction?a.arrival_flight_status:a.departure_flight_status,travelType:a.travel_type}))})).sort((a,b)=>a.timeWindow.localeCompare(b.timeWindow))}let c=(await a.db.query.guests.findMany({where:(0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),"arrival"===b.direction?(0,fD.Uo)((0,fD.eq)(fC.guests.arrivalDate,b.date),(0,fD.eq)(fC.guests.needsArrivalTransfer,!0)):(0,fD.Uo)((0,fD.eq)(fC.guests.departureDate,b.date),(0,fD.eq)(fC.guests.needsDepartureTransfer,!0))),with:{transportAssignments:!0}})).filter(a=>!a.transportAssignments.some(a=>a.assignmentType===b.direction)),d=new Map;for(let a of c){let c="arrival"===b.direction?a.arrivalVerifiedTime||a.arrivalTime:a.departureVerifiedTime||a.departureTime;if(!c)continue;let[e,f]=c.split(":").map(Number),g=Math.floor((60*e+f)/b.timeWindowMinutes)*b.timeWindowMinutes,h=Math.floor(g/60),i=g%60,j=`${String(h).padStart(2,"0")}:${String(i).padStart(2,"0")}`;d.has(j)||d.set(j,[]),d.get(j).push(a)}return Array.from(d.entries()).map(([a,c])=>({timeWindow:a,guestCount:c.length,guests:c.map(a=>({id:a.id,name:`${a.firstName} ${a.lastName}`,flightNumber:"arrival"===b.direction?a.arrivalFlightNumber:a.departureFlightNumber,time:"arrival"===b.direction?a.arrivalVerifiedTime||a.arrivalTime:a.departureVerifiedTime||a.departureTime,status:"arrival"===b.direction?a.arrivalFlightStatus:a.departureFlightStatus,travelType:a.travelType}))})).sort((a,b)=>a.timeWindow.localeCompare(b.timeWindow))}),reassignGuest:bU.input(fh({guestId:eK().uuid(),fromScheduleId:eK().uuid(),toScheduleId:eK().uuid(),assignmentType:fn(["arrival","departure"])})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0};if(fY(a)){let{data:c}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (*)
            `).eq("id",b.toScheduleId).single();if(!c)throw Error("Target schedule not found");if(c.vehicle&&(c.assignments?.length||0)>=c.vehicle.capacity)throw Error("Target vehicle is at full capacity");let{data:d}=await a.supabase.from("guest_transport_assignments").select("*").eq("guest_id",b.guestId).eq("schedule_id",b.fromScheduleId).eq("assignment_type",b.assignmentType).single();if(!d)throw Error("Current assignment not found");await a.supabase.from("guest_transport_assignments").delete().eq("id",d.id);let{data:e,error:f}=await a.supabase.from("guest_transport_assignments").insert({guest_id:b.guestId,schedule_id:b.toScheduleId,assignment_type:b.assignmentType}).select().single();if(f)throw Error(f.message);return{success:!0,newAssignment:e}}let c=await a.db.query.transportSchedules.findFirst({where:(0,fD.eq)(fC.transportSchedules.id,b.toScheduleId),with:{vehicle:!0,assignments:!0}});if(!c)throw Error("Target schedule not found");if(c.vehicle&&c.assignments.length>=c.vehicle.capacity)throw Error("Target vehicle is at full capacity");let d=await a.db.query.guestTransportAssignments.findFirst({where:(0,fD.Uo)((0,fD.eq)(fC.guestTransportAssignments.guestId,b.guestId),(0,fD.eq)(fC.guestTransportAssignments.scheduleId,b.fromScheduleId),(0,fD.eq)(fC.guestTransportAssignments.assignmentType,b.assignmentType))});if(!d)throw Error("Current assignment not found");await a.db.delete(fC.guestTransportAssignments).where((0,fD.eq)(fC.guestTransportAssignments.id,d.id));let[e]=await a.db.insert(fC.guestTransportAssignments).values({guestId:b.guestId,scheduleId:b.toScheduleId,assignmentType:b.assignmentType}).returning();return await a.db.insert(fC.auditLogs).values({entityType:"assignment",entityId:e.id,action:"update",changes:[{field:"scheduleId",oldValue:b.fromScheduleId,newValue:b.toScheduleId,fieldType:"string"}],changeSource:"manual",performedBy:a.user.id}),{success:!0,newAssignment:e}}),suggestReallocation:bU.input(fh({guestId:eK().uuid(),direction:fn(["arrival","departure"])})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return[];if(fY(a)){let{data:c}=await a.supabase.from("guests").select("*").eq("id",b.guestId).single();if(!c)throw Error("Guest not found");let d="arrival"===b.direction?c.arrival_date:c.departure_date,e="arrival"===b.direction?c.arrival_verified_time||c.arrival_time:c.departure_verified_time||c.departure_time;if(!d||!e)return[];let{data:f}=await a.supabase.from("transport_schedules").select(`
              *,
              vehicle:vehicles (*),
              assignments:guest_transport_assignments (*)
            `).eq("schedule_date",d).eq("direction",b.direction),[g,h]=e.split(":").map(Number),i=60*g+h;return(f||[]).filter(a=>!!a.vehicle&&(a.assignments?.length||0)<a.vehicle.capacity).map(a=>{let[b,c]=a.pickup_time.split(":").map(Number),d=Math.abs(60*b+c-i),e=Math.max(0,100-d),f=((a.vehicle?.capacity||0)-(a.assignments?.length||0))*10;return{scheduleId:a.id,vehicleName:a.vehicle?.name||"Unknown",pickupTime:a.pickup_time,pickupLocation:a.pickup_location,currentCount:a.assignments?.length||0,capacity:a.vehicle?.capacity||0,availableSpots:(a.vehicle?.capacity||0)-(a.assignments?.length||0),timeDifferenceMinutes:d,score:e+f,isRecommended:d<=60}}).sort((a,b)=>b.score-a.score)}let c=await a.db.query.guests.findFirst({where:(0,fD.eq)(fC.guests.id,b.guestId)});if(!c)throw Error("Guest not found");let d="arrival"===b.direction?c.arrivalDate:c.departureDate,e="arrival"===b.direction?c.arrivalVerifiedTime||c.arrivalTime:c.departureVerifiedTime||c.departureTime;if(!d||!e)return[];let f=await a.db.query.transportSchedules.findMany({where:(0,fD.Uo)((0,fD.eq)(fC.transportSchedules.scheduleDate,d),(0,fD.eq)(fC.transportSchedules.direction,b.direction)),with:{vehicle:!0,assignments:!0}}),[g,h]=e.split(":").map(Number),i=60*g+h;return f.filter(a=>!!a.vehicle&&a.assignments.length<a.vehicle.capacity).map(a=>{let[b,c]=a.pickupTime.split(":").map(Number),d=Math.abs(60*b+c-i),e=Math.max(0,100-d),f=((a.vehicle?.capacity||0)-a.assignments.length)*10;return{scheduleId:a.id,vehicleName:a.vehicle?.name||"Unknown",pickupTime:a.pickupTime,pickupLocation:a.pickupLocation,currentCount:a.assignments.length,capacity:a.vehicle?.capacity||0,availableSpots:(a.vehicle?.capacity||0)-a.assignments.length,timeDifferenceMinutes:d,score:e+f,isRecommended:d<=60}}).sort((a,b)=>b.score-a.score)})}),prePlannedGroups:bP({getByDate:bU.input(fh({date:eK()})).query(({input:a})=>{let b=fP[a.date]||null;return b?{date:a.date,direction:b.direction,groups:b.groups.map(a=>({...a,vehicleInfo:fO[a.vehicleType]})),totalPax:b.groups.reduce((a,b)=>a+b.combinedPax,0),totalGroups:b.groups.length}:null}),getScheduledDates:bU.query(()=>fR()),getSummary:bU.query(()=>fR().map(a=>{let b=fP[a]||null;if(!b)return null;let c={};return b.groups.forEach(a=>{c[a.vehicleType]=(c[a.vehicleType]||0)+1}),{date:a,direction:b.direction,totalGroups:b.groups.length,totalPax:b.groups.reduce((a,b)=>a+b.combinedPax,0),vehicleCounts:c}}).filter(Boolean))})}),f$=fh({entityType:fn(["guest","vehicle","transport_schedule","assignment"]).optional(),entityId:eK().uuid().optional(),action:fn(["create","update","delete","restore"]).optional(),changeSource:fn(["import","manual","system"]).optional(),performedBy:eK().uuid().optional(),dateFrom:eK().optional(),dateTo:eK().optional(),page:e4().min(1).default(1),pageSize:e4().min(1).max(100).default(50)}),f_=bP({list:bS.input(f$).query(async({ctx:a,input:b})=>{let{entityType:c,entityId:d,action:e,changeSource:f,performedBy:g,dateFrom:h,dateTo:i,page:j,pageSize:k}=b,l=[];a.user?.role==="transport_arranger"&&l.push((0,fD.eq)(fC.auditLogs.entityType,"transport_schedule")),c&&l.push((0,fD.eq)(fC.auditLogs.entityType,c)),d&&l.push((0,fD.eq)(fC.auditLogs.entityId,d)),e&&l.push((0,fD.eq)(fC.auditLogs.action,e)),f&&l.push((0,fD.eq)(fC.auditLogs.changeSource,f)),g&&l.push((0,fD.eq)(fC.auditLogs.performedBy,g)),h&&l.push((0,fD.RO)(fC.auditLogs.performedAt,new Date(h))),i&&l.push((0,fD.wJ)(fC.auditLogs.performedAt,new Date(i)));let[{total:m}]=await a.db.select({total:fF()}).from(fC.auditLogs).where(l.length>0?(0,fD.Uo)(...l):void 0);return{data:await a.db.query.auditLogs.findMany({where:l.length>0?(0,fD.Uo)(...l):void 0,limit:k,offset:(j-1)*k,orderBy:(0,fG.i)(fC.auditLogs.performedAt),with:{performedByUser:!0,importSession:!0}}),pagination:{page:j,pageSize:k,total:m,totalPages:Math.ceil(m/k)}}}),getByEntity:bS.input(fh({entityType:fn(["guest","vehicle","transport_schedule","assignment"]),entityId:eK().uuid()})).query(async({ctx:a,input:b})=>a.db.query.auditLogs.findMany({where:(0,fD.Uo)((0,fD.eq)(fC.auditLogs.entityType,b.entityType),(0,fD.eq)(fC.auditLogs.entityId,b.entityId)),orderBy:(0,fG.i)(fC.auditLogs.performedAt),with:{performedByUser:!0,importSession:!0}})),export:bT.input(f$.omit({page:!0,pageSize:!0})).query(async({ctx:a,input:b})=>{let{entityType:c,entityId:d,action:e,changeSource:f,performedBy:g,dateFrom:h,dateTo:i}=b,j=[];return c&&j.push((0,fD.eq)(fC.auditLogs.entityType,c)),d&&j.push((0,fD.eq)(fC.auditLogs.entityId,d)),e&&j.push((0,fD.eq)(fC.auditLogs.action,e)),f&&j.push((0,fD.eq)(fC.auditLogs.changeSource,f)),g&&j.push((0,fD.eq)(fC.auditLogs.performedBy,g)),h&&j.push((0,fD.RO)(fC.auditLogs.performedAt,new Date(h))),i&&j.push((0,fD.wJ)(fC.auditLogs.performedAt,new Date(i))),a.db.query.auditLogs.findMany({where:j.length>0?(0,fD.Uo)(...j):void 0,orderBy:(0,fG.i)(fC.auditLogs.performedAt),with:{performedByUser:!0,importSession:!0}})}),getUsers:bS.query(async({ctx:a})=>a.db.query.users.findMany({columns:{id:!0,name:!0,email:!0}}))}),f0=fl(eK(),eK().nullable()),f1=fh({data:ff(fl(eK(),fc())),columnMapping:f0,filename:eK()}),f2=["email","first_name","last_name","axis_email","reporting_level_1","reporting_level_2","reporting_level_3","function","location","arrival_date","arrival_time","arrival_flight_number","arrival_airport","arrival_flight_route","departure_date","departure_time","departure_flight_number","departure_airport","departure_flight_route","hotel_checkin_date","hotel_checkout_date","extend_stay_before","extend_stay_after","early_checkin","late_checkout","needs_arrival_transfer","needs_departure_transfer","registration_status","travel_type"],f3={firstName:"first_name",lastName:"last_name",axisEmail:"axis_email",reportingLevel1:"reporting_level_1",reportingLevel2:"reporting_level_2",reportingLevel3:"reporting_level_3",arrivalDate:"arrival_date",arrivalTime:"arrival_time",arrivalFlightNumber:"arrival_flight_number",arrivalAirport:"arrival_airport",arrivalFlightRoute:"arrival_flight_route",departureDate:"departure_date",departureTime:"departure_time",departureFlightNumber:"departure_flight_number",departureAirport:"departure_airport",departureFlightRoute:"departure_flight_route",hotelCheckinDate:"hotel_checkin_date",hotelCheckoutDate:"hotel_checkout_date",extendStayBefore:"extend_stay_before",extendStayAfter:"extend_stay_after",earlyCheckin:"early_checkin",lateCheckout:"late_checkout",needsArrivalTransfer:"needs_arrival_transfer",needsDepartureTransfer:"needs_departure_transfer",registrationStatus:"registration_status",travelType:"travel_type"},f4=bP({preview:bT.input(f1).mutation(async({ctx:a,input:b})=>{let{data:c,columnMapping:d,filename:e}=b;if(!a.supabase)throw Error("Database not configured");let{data:f,error:g}=await a.supabase.from("guests").select("*").is("deleted_at",null);if(g)throw Error(`Failed to fetch guests: ${g.message}`);let h=new Map((f||[]).map(a=>[a.email?.toLowerCase(),a])),i=new Set,j={added:[],modified:[],removed:[],unchanged:[],errors:[]};for(let a=0;a<c.length;a++){let b={...c[a]},d=[];if(b.email||d.push("Email is required"),b.firstName||d.push("First name is required"),b.lastName||d.push("Last name is required"),d.length>0){j.errors.push({row:a+2,email:b.email,errors:d});continue}let e=b.email.toLowerCase(),f=h.get(e),g=function(a){let b={};for(let[c,d]of Object.entries(a))b[f3[c]||c]=d;return b}(b);if(f){i.add(f.id);let a=[];for(let b of f2){let c=f[b],d=g[b];!function(a,b){return a===b||null===a&&void 0===b||void 0===a&&null===b||null===a&&""===b||""===a&&null===b||(a instanceof Date&&"string"==typeof b?a.toISOString().split("T")[0]===b:"string"==typeof a&&b instanceof Date?a===b.toISOString().split("T")[0]:"string"==typeof a&&"string"==typeof b&&a.trim()===b.trim())}(c,d)&&a.push({field:b,oldValue:c,newValue:d,fieldType:function(a){return null==a?"null":"boolean"==typeof a?"boolean":"number"==typeof a?"number":a instanceof Date||"string"==typeof a&&/^\d{4}-\d{2}-\d{2}/.test(a)?"date":"string"}(d)})}a.length>0?j.modified.push({existing:f,changes:a,newData:g}):j.unchanged.push(f)}else j.added.push(g)}for(let a of f||[])i.has(a.id)||j.removed.push(a);let{data:k,error:l}=await a.supabase.from("import_sessions").insert({filename:e,uploaded_by:a.user.id,status:"pending",total_rows:c.length,rows_added:j.added.length,rows_modified:j.modified.length,rows_removed:j.removed.length,rows_unchanged:j.unchanged.length,rows_error:j.errors.length,error_details:j.errors.length>0?{errors:j.errors}:null}).select().single();return l&&console.error("Session creation error:",l),{sessionId:k?.id||"temp-session",diff:j,summary:{added:j.added.length,modified:j.modified.length,removed:j.removed.length,unchanged:j.unchanged.length,errors:j.errors.length}}}),executeImport:bT.input(fh({sessionId:eK(),diff:fh({added:ff(fl(eK(),fc())),modified:ff(fh({existing:fa(),changes:ff(fh({field:eK(),oldValue:fc(),newValue:fc(),fieldType:eK()})),newData:fl(eK(),fc())})),removed:ff(fa())}),removeDeleted:e8().default(!1)})).mutation(async({ctx:a,input:b})=>{let{sessionId:c,diff:d,removeDeleted:e}=b;if(!a.supabase)throw Error("Database not configured");"temp-session"!==c&&await a.supabase.from("import_sessions").update({status:"processing",started_at:new Date().toISOString()}).eq("id",c);try{let b=0,f=0,g=0;for(let c of d.added){let{error:d}=await a.supabase.from("guests").insert(c);d?console.error("Insert error:",d):b++}for(let{existing:b,newData:c}of d.modified){let{error:d}=await a.supabase.from("guests").update({...c,version:(b.version||1)+1,updated_at:new Date().toISOString()}).eq("id",b.id);d?console.error("Update error:",d):f++}if(e)for(let b of d.removed){let{error:c}=await a.supabase.from("guests").update({deleted_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",b.id);c?console.error("Delete error:",c):g++}return"temp-session"!==c&&await a.supabase.from("import_sessions").update({status:"completed",completed_at:new Date().toISOString(),rows_removed:e?g:0}).eq("id",c),{success:!0,sessionId:c,results:{added:b,modified:f,removed:g}}}catch(b){throw"temp-session"!==c&&await a.supabase.from("import_sessions").update({status:"failed",completed_at:new Date().toISOString(),error_details:{error:String(b)}}).eq("id",c),b}}),getSessions:bT.input(fh({page:e4().min(1).default(1),pageSize:e4().min(1).max(50).default(20)})).query(async({ctx:a,input:b})=>{let{page:c,pageSize:d}=b,e=(c-1)*d;if(!a.supabase)return[];let{data:f,error:g}=await a.supabase.from("import_sessions").select("*").order("created_at",{ascending:!1}).range(e,e+d-1);return g?(console.error("Error fetching sessions:",g),[]):f||[]}),getSession:bT.input(fh({id:eK().uuid()})).query(async({ctx:a,input:b})=>{if(!a.supabase)return null;let{data:c,error:d}=await a.supabase.from("import_sessions").select("*").eq("id",b.id).single();return d?(console.error("Error fetching session:",d),null):c})}),f5={SQ238:{flightNumber:"SQ238",flightDate:"2026-01-18",airline:{name:"Singapore Airlines",iata:"SQ",icao:"SIA"},departure:{airport:"Singapore Changi Airport",iata:"SIN",icao:"WSSS",terminal:"3",gate:"B12",scheduled:"2026-01-18T12:15:00+08:00",estimated:null,actual:null,delay:null,timezone:"Asia/Singapore"},arrival:{airport:"Kuala Lumpur International Airport",iata:"KUL",icao:"WMKK",terminal:"1",gate:"C8",baggage:"Belt 5",scheduled:"2026-01-18T15:15:00+08:00",estimated:null,actual:null,delay:null,timezone:"Asia/Kuala_Lumpur"},flightStatus:"scheduled",aircraft:{registration:"9V-SMG",iata:"B789",icao:"B789"}},MH123:{flightNumber:"MH123",flightDate:"2026-01-18",airline:{name:"Malaysia Airlines",iata:"MH",icao:"MAS"},departure:{airport:"Hong Kong International",iata:"HKG",icao:"VHHH",terminal:"1",gate:"A15",scheduled:"2026-01-18T08:00:00+08:00",estimated:null,actual:null,delay:null,timezone:"Asia/Hong_Kong"},arrival:{airport:"Kuala Lumpur International Airport",iata:"KUL",icao:"WMKK",terminal:"1",gate:"A22",baggage:"Belt 3",scheduled:"2026-01-18T12:00:00+08:00",estimated:null,actual:null,delay:null,timezone:"Asia/Kuala_Lumpur"},flightStatus:"scheduled",aircraft:{registration:"9M-MTB",iata:"A359",icao:"A359"}}};function f6(a){if(!a)return null;try{return new Date(a).toTimeString().slice(0,5)}catch{return null}}function f7(a,b,c=30){if(!a||!b)return!1;let[d,e]=a.split(":").map(Number),[f,g]=b.split(":").map(Number);return Math.abs(60*d+e-(60*f+g))>c}function f8(a,b){if(!a||!b)return"";let[c,d]=a.split(":").map(Number),[e,f]=b.split(":").map(Number),g=60*e+f-(60*c+d),h=Math.floor(Math.abs(g)/60),i=Math.abs(g)%60,j=g>0?"+":"-";return h>0?`${j}${h}h ${i}m`:`${j}${i}m`}async function f9(a,b,c){let d=process.env.AVIATIONSTACK_API_KEY;if(!d)return console.log("No AVIATIONSTACK_API_KEY configured, using mock data"),ga(a);try{let{airline:e,number:f}=function(a){let b=a.replace(/\s+/g,"").toUpperCase(),c=b.match(/^([A-Z]{2})(\d+)$/);if(c)return{airline:c[1],number:c[2]};let d=b.match(/^([A-Z]{3})(\d+)$/);return d?{airline:d[1],number:d[2]}:{airline:"",number:a}}(a),g=new URLSearchParams({access_key:d,flight_iata:`${e}${f}`,flight_date:b});c&&g.append("arr_iata",c.toUpperCase());let h=`http://api.aviationstack.com/v1/flights?${g.toString()}`,i=await fetch(h),j=await i.json();if(j.error)return console.error("AviationStack API error:",j.error),ga(a);if(!j.data||0===j.data.length)return{success:!1,data:null,error:"Flight not found",source:"api"};let k=j.data[0],l={flightNumber:k.flight.iata,flightDate:k.flight_date,airline:{name:k.airline.name,iata:k.airline.iata,icao:k.airline.icao},departure:{airport:k.departure.airport,iata:k.departure.iata,icao:k.departure.icao,terminal:k.departure.terminal,gate:k.departure.gate,scheduled:k.departure.scheduled,estimated:k.departure.estimated,actual:k.departure.actual,delay:k.departure.delay,timezone:k.departure.timezone},arrival:{airport:k.arrival.airport,iata:k.arrival.iata,icao:k.arrival.icao,terminal:k.arrival.terminal,gate:k.arrival.gate,baggage:k.arrival.baggage,scheduled:k.arrival.scheduled,estimated:k.arrival.estimated,actual:k.arrival.actual,delay:k.arrival.delay,timezone:k.arrival.timezone},flightStatus:{scheduled:"scheduled",active:"active","en-route":"active",landed:"landed",arrived:"landed",cancelled:"cancelled",diverted:"diverted"}[k.flight_status.toLowerCase()]||"unknown",aircraft:k.aircraft};return{success:!0,data:l,source:"api"}}catch(b){return console.error("Error fetching flight status:",b),ga(a)}}function ga(a){let b=a.replace(/\s+/g,"").toUpperCase(),c=f5[b];return c?{success:!0,data:c,source:"mock"}:{success:!0,data:{flightNumber:b,flightDate:new Date().toISOString().split("T")[0],airline:{name:"Unknown Airline",iata:b.slice(0,2),icao:b.slice(0,3)},departure:{airport:"Origin Airport",iata:"XXX",icao:"XXXX",terminal:"1",gate:"A1",scheduled:new Date().toISOString(),estimated:null,actual:null,delay:null,timezone:"UTC"},arrival:{airport:"Kuala Lumpur International Airport",iata:"KUL",icao:"WMKK",terminal:"1",gate:null,baggage:null,scheduled:new Date().toISOString(),estimated:null,actual:null,delay:null,timezone:"Asia/Kuala_Lumpur"},flightStatus:"unknown",aircraft:null},source:"mock"}}let gb={SQ:"SIA",MH:"MAS",AK:"AXM",TR:"TGW",CX:"CPA",QF:"QFA",EK:"UAE",BA:"BAW",QR:"QTR",TG:"THA",GA:"GIA",JL:"JAL",NH:"ANA",KE:"KAL",OZ:"AAR",CI:"CAL",BR:"EVA",PR:"PAL",VN:"HVN"};function gc(a){let b=a.replace(/\s+/g,"").toUpperCase(),c=b.match(/^([A-Z]{2})(\d+)$/);if(c){let[,a,b]=c,d=gb[a]||a;return`${d}${b}`}return b}function gd(a){return{icao24:a[0],callsign:a[1]?a[1].trim():null,originCountry:a[2],timePosition:a[3],lastContact:a[4],longitude:a[5],latitude:a[6],baroAltitude:a[7],onGround:a[8],velocity:a[9],trueTrack:a[10],verticalRate:a[11],geoAltitude:a[13]}}let ge=null;async function gf(){if(ge&&Date.now()-ge.timestamp<3e4)return{success:!0,states:ge.data};try{let a=await fetch("https://opensky-network.org/api/states/all",{headers:{Accept:"application/json"}});if(!a.ok){if(429===a.status)return{success:!1,states:[],error:"Rate limit exceeded"};throw Error(`OpenSky API error: ${a.status}`)}let b=(await a.json()).states||[];return ge={data:b,timestamp:Date.now()},{success:!0,states:b}}catch(a){return console.error("OpenSky API error:",a),{success:!1,states:[],error:a instanceof Error?a.message:"Failed to fetch flights"}}}async function gg(a){let b=gc(a),{success:c,states:d,error:e}=await gf();if(!c)return{success:!1,data:null,error:e};if(0===d.length)return{success:!1,data:null,error:"No flights currently tracked"};let f=d.find(a=>{let c=a[1]?a[1].trim().toUpperCase():"";return c===b||c.startsWith(b)});if(!f)return{success:!1,data:null,error:`Flight ${a} (${b}) not currently in the air`};let g=gd(f);return{success:!0,data:{flightNumber:a,callsign:g.callsign||b,isInAir:!g.onGround&&null!==g.latitude,hasLanded:g.onGround&&null!==g.latitude,position:g.latitude&&g.longitude?{lat:g.latitude,lng:g.longitude,altitude:g.baroAltitude||g.geoAltitude||0,heading:g.trueTrack||0,speed:g.velocity?3.6*g.velocity:0}:null,lastUpdate:new Date(1e3*g.lastContact)}}}async function gh(a){let b=new Map,c=new Map;a.forEach(a=>{c.set(gc(a),a)});let{success:d,states:e}=await gf();return d&&0!==e.length?(e.forEach(a=>{let d=a[1]?a[1].trim().toUpperCase():"";for(let[e,f]of c)if(d===e||d.startsWith(e)){let c=gd(a);b.set(f,{flightNumber:f,callsign:c.callsign||e,isInAir:!c.onGround&&null!==c.latitude,hasLanded:c.onGround&&null!==c.latitude,position:c.latitude&&c.longitude?{lat:c.latitude,lng:c.longitude,altitude:c.baroAltitude||c.geoAltitude||0,heading:c.trueTrack||0,speed:c.velocity?3.6*c.velocity:0}:null,lastUpdate:new Date(1e3*c.lastContact)});break}}),a.forEach(a=>{b.has(a)||b.set(a,null)})):a.forEach(a=>b.set(a,null)),b}async function gi(a){let b={KUL:{lamin:2.5,lomin:101.4,lamax:3,lomax:101.9},SIN:{lamin:1.2,lomin:103.8,lamax:1.5,lomax:104.1},HKG:{lamin:22.2,lomin:113.8,lamax:22.4,lomax:114},BKK:{lamin:13.6,lomin:100.6,lamax:13.8,lomax:100.8}}[a.toUpperCase()];if(!b)return{success:!1,flights:[],error:`Unknown airport: ${a}`};try{let a=`https://opensky-network.org/api/states/all?lamin=${b.lamin}&lomin=${b.lomin}&lamax=${b.lamax}&lomax=${b.lomax}`,c=await fetch(a,{headers:{Accept:"application/json"},next:{revalidate:60}});if(!c.ok)throw Error(`OpenSky API error: ${c.status}`);let d=await c.json();if(!d.states||0===d.states.length)return{success:!0,flights:[]};let e=d.states.map(a=>{let b=gd(a);return{flightNumber:b.callsign||"Unknown",callsign:b.callsign||"",isInAir:!b.onGround,hasLanded:b.onGround,position:b.latitude&&b.longitude?{lat:b.latitude,lng:b.longitude,altitude:b.baroAltitude||0,heading:b.trueTrack||0,speed:b.velocity?3.6*b.velocity:0}:null,lastUpdate:new Date(1e3*b.lastContact)}});return{success:!0,flights:e}}catch(a){return console.error("OpenSky API error:",a),{success:!1,flights:[],error:a instanceof Error?a.message:"Failed to fetch flights"}}}let gj=null,gk=0,gl="production"===process.env.AMADEUS_ENV?"https://api.amadeus.com":"https://test.api.amadeus.com";function gm(a){let b=a.replace(/\s+/g,"").toUpperCase(),c=b.match(/^([A-Z]{2})(\d+)$/);if(c)return{carrier:c[1],number:c[2]};let d=b.match(/^([A-Z]{3})(\d+)$/);return d?{carrier:d[1],number:d[2]}:{carrier:"",number:a}}async function gn(){let a=process.env.AMADEUS_CLIENT_ID,b=process.env.AMADEUS_CLIENT_SECRET;if(!a||!b)return console.log("Amadeus credentials not configured"),null;if(gj&&Date.now()<gk-6e4)return gj;try{let c=await fetch(`${gl}/v1/security/oauth2/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"client_credentials",client_id:a,client_secret:b})});if(!c.ok){let a=await c.text();return console.error("Amadeus auth error:",a),null}let d=await c.json();return gj=d.access_token,gk=Date.now()+1e3*d.expires_in,gj}catch(a){return console.error("Amadeus token error:",a),null}}async function go(a,b){let{carrier:c,number:d}=gm(a);if(!c)return{success:!1,data:null,error:"Invalid flight number format",source:"amadeus"};let e=await gn();if(!e)return gq(a,b);try{let f=new URL(`${gl}/v2/schedule/flights`);f.searchParams.set("carrierCode",c),f.searchParams.set("flightNumber",d),f.searchParams.set("scheduledDepartureDate",b);let g=await fetch(f.toString(),{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!g.ok){if(401===g.status&&(gj=null,gk=0,await gn()))return go(a,b);let c=await g.json().catch(()=>({}));if(console.error("Amadeus API error:",g.status,c),404===g.status)return{success:!1,data:null,error:"Flight not found",source:"amadeus"};return gq(a,b)}let h=await g.json();if(!h.data||0===h.data.length)return{success:!1,data:null,error:"Flight not found",source:"amadeus"};let i=h.data[0],j=i.flightPoints||[],k=i.segments||[],l=j.find(a=>a.departure),m=j.find(a=>a.arrival);if(!l||!m)return{success:!1,data:null,error:"Incomplete flight data",source:"amadeus"};let n={flightNumber:`${c}${d}`,carrierCode:c,flightDate:b,departure:{airport:l.iataCode,iataCode:l.iataCode,terminal:l.departure?.terminal,gate:l.departure?.gate?.mainGate,scheduledTime:l.departure?.timings?.find(a=>"STD"===a.qualifier)?.value||"",estimatedTime:l.departure?.timings?.find(a=>"ETD"===a.qualifier)?.value,actualTime:l.departure?.timings?.find(a=>"ATD"===a.qualifier)?.value},arrival:{airport:m.iataCode,iataCode:m.iataCode,terminal:m.arrival?.terminal,gate:m.arrival?.gate?.mainGate,scheduledTime:m.arrival?.timings?.find(a=>"STA"===a.qualifier)?.value||"",estimatedTime:m.arrival?.timings?.find(a=>"ETA"===a.qualifier)?.value,actualTime:m.arrival?.timings?.find(a=>"ATA"===a.qualifier)?.value},status:function(a){if(!a||0===a.length)return"unknown";let b=a[0].status?.toLowerCase()||"";return b.includes("cancel")?"cancelled":b.includes("divert")?"diverted":b.includes("land")||b.includes("arrived")?"landed":b.includes("active")||b.includes("airborne")||b.includes("departed")?"active":b.includes("scheduled")||b.includes("confirmed")?"scheduled":"unknown"}(k),duration:k[0]?.scheduledSegmentDuration};return{success:!0,data:n,source:"amadeus"}}catch(c){return console.error("Amadeus fetch error:",c),gq(a,b)}}let gp={SQ238:{flightNumber:"SQ238",carrierCode:"SQ",departure:{airport:"Singapore Changi Airport",iataCode:"SIN",terminal:"3",gate:"B12",scheduledTime:"12:15"},arrival:{airport:"Kuala Lumpur International Airport",iataCode:"KUL",terminal:"1",gate:"C8",scheduledTime:"15:15"},status:"scheduled",duration:"PT1H0M"},SQ114:{flightNumber:"SQ114",carrierCode:"SQ",departure:{airport:"Singapore Changi Airport",iataCode:"SIN",terminal:"2",gate:"D5",scheduledTime:"12:40"},arrival:{airport:"Kuala Lumpur International Airport",iataCode:"KUL",terminal:"1",gate:"A3",scheduledTime:"13:50"},status:"scheduled",duration:"PT1H10M"},MH123:{flightNumber:"MH123",carrierCode:"MH",departure:{airport:"Hong Kong International",iataCode:"HKG",terminal:"1",gate:"A15",scheduledTime:"08:00"},arrival:{airport:"Kuala Lumpur International Airport",iataCode:"KUL",terminal:"1",gate:"A22",scheduledTime:"12:00"},status:"scheduled",duration:"PT4H0M"}};function gq(a,b){let c=a.replace(/\s+/g,"").toUpperCase(),d=gp[c];if(d)return{success:!0,data:{...d,flightDate:b},source:"mock"};let{carrier:e,number:f}=gm(a);return{success:!0,data:{flightNumber:c,carrierCode:e||"XX",flightDate:b,departure:{airport:"Origin Airport",iataCode:"XXX",scheduledTime:"12:00"},arrival:{airport:"Kuala Lumpur International Airport",iataCode:"KUL",terminal:"1",scheduledTime:"16:00"},status:"scheduled"},source:"mock"}}function gr(a){let b=new Date;b.setHours(0,0,0,0);let c=new Date(a);return c.setHours(0,0,0,0),Math.ceil((c.getTime()-b.getTime())/864e5)}function gs(a){let b=gr(a),c=new Date;return b<=0?{frequency:"realtime",nextCheckAt:new Date(c.getTime()+3e5),checksRemaining:-1,reason:"Event day - real-time tracking via OpenSky"}:b<=7?{frequency:"five_daily",nextCheckAt:new Date(c.getTime()+1728e4),checksRemaining:5*b,reason:`${b} days until flight - checking 5x daily`}:{frequency:"twice_daily",nextCheckAt:new Date(c.getTime()+432e5),checksRemaining:2*b,reason:`${b} days until flight - checking 2x daily`}}async function gt(a){if("realtime"===gs(a.flightDate).frequency){let b=await gg(a.flightNumber);return{flightNumber:a.flightNumber,flightDate:a.flightDate,status:b.success?"verified":"not_found",liveStatus:b.data||void 0,lastCheckedAt:new Date}}{let b=null;if(process.env.AMADEUS_CLIENT_ID&&process.env.AMADEUS_CLIENT_SECRET){let c=await go(a.flightNumber,a.flightDate);if(c.success&&c.data){b=function(a){if(!a)return null;if(/^\d{2}:\d{2}$/.test(a))return a;try{return new Date(a).toTimeString().slice(0,5)}catch{return null}}(c.data.arrival.scheduledTime),c.source;let d={flightNumber:c.data.flightNumber,flightDate:c.data.flightDate,airline:{name:c.data.carrierCode,iata:c.data.carrierCode,icao:c.data.carrierCode},departure:{airport:c.data.departure.airport,iata:c.data.departure.iataCode,icao:c.data.departure.iataCode,terminal:c.data.departure.terminal||null,gate:c.data.departure.gate||null,scheduled:c.data.departure.scheduledTime,estimated:c.data.departure.estimatedTime||null,actual:c.data.departure.actualTime||null,delay:null,timezone:"UTC"},arrival:{airport:c.data.arrival.airport,iata:c.data.arrival.iataCode,icao:c.data.arrival.iataCode,terminal:c.data.arrival.terminal||null,gate:c.data.arrival.gate||null,baggage:null,scheduled:c.data.arrival.scheduledTime,estimated:c.data.arrival.estimatedTime||null,actual:c.data.arrival.actualTime||null,delay:null,timezone:"UTC"},flightStatus:c.data.status,aircraft:null},e=!!b&&!!a.expectedTime&&Math.abs(parseInt(b.replace(":",""))-parseInt(a.expectedTime.replace(":","")))>30;return{flightNumber:a.flightNumber,flightDate:a.flightDate,status:e?"changed":"verified",scheduledInfo:d,timeMismatch:e,lastCheckedAt:new Date}}}let c=await f9(a.flightNumber,a.flightDate,"KUL");if(!c.success||!c.data)return{flightNumber:a.flightNumber,flightDate:a.flightDate,status:"not_found",lastCheckedAt:new Date};let d=!!(b=c.data.arrival.scheduled?new Date(c.data.arrival.scheduled).toTimeString().slice(0,5):null)&&!!a.expectedTime&&Math.abs(parseInt(b.replace(":",""))-parseInt(a.expectedTime.replace(":","")))>30;return{flightNumber:a.flightNumber,flightDate:a.flightDate,status:d?"changed":"verified",scheduledInfo:c.data,timeMismatch:d,lastCheckedAt:new Date}}}let gu=bP({verifyFlight:bS.input(fh({flightNumber:eK().min(1),flightDate:eK().regex(/^\d{4}-\d{2}-\d{2}$/),arrivalAirport:eK().optional()})).mutation(async({input:a})=>{let b=await f9(a.flightNumber,a.flightDate,a.arrivalAirport);return b.success&&b.data?{success:!0,flight:b.data,source:b.source}:{success:!1,error:b.error||"Flight not found",source:b.source}}),verifyGuestFlight:bS.input(fh({guestId:eK().uuid(),direction:fn(["arrival","departure"])})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0,verified:!0,source:"mock",flightInfo:{terminal:"1",gate:"A5",scheduledTime:"15:15",actualTime:null,status:"scheduled",timeMismatch:!1,timeDifference:null}};if(!a.db)throw Error("Database not available");let c=await a.db.query.guests.findFirst({where:(0,fD.eq)(fC.guests.id,b.guestId)});if(!c)throw Error("Guest not found");let d="arrival"===b.direction?c.arrivalFlightNumber:c.departureFlightNumber,e="arrival"===b.direction?c.arrivalDate:c.departureDate,f="arrival"===b.direction?c.arrivalTime:c.departureTime;if(!d||!e)throw Error("Flight information not available for this guest");let g=await f9(d,e,"KUL");if(!g.success||!g.data)return{success:!1,error:g.error||"Flight not found",source:g.source};let h=g.data,i="arrival"===b.direction?h.arrival:h.departure,j=f6(i.scheduled),k=f6(i.actual||i.estimated),l=f7(f,j),m=l?f8(f,j):null,n="arrival"===b.direction?{arrivalTerminal:i.terminal,arrivalGate:i.gate,arrivalVerifiedTime:j,arrivalFlightStatus:h.flightStatus,arrivalVerifiedAt:new Date,arrivalTimeMismatch:l}:{departureTerminal:i.terminal,departureGate:i.gate,departureVerifiedTime:j,departureFlightStatus:h.flightStatus,departureVerifiedAt:new Date,departureTimeMismatch:l};return await a.db.update(fC.guests).set(n).where((0,fD.eq)(fC.guests.id,b.guestId)),{success:!0,verified:!0,source:g.source,flightInfo:{terminal:i.terminal,gate:i.gate,scheduledTime:j,actualTime:k,status:h.flightStatus,timeMismatch:l,timeDifference:m,airlineName:h.airline.name,departureAirport:h.departure.airport,arrivalAirport:h.arrival.airport}}}),verifyFlightsByDate:bS.input(fh({date:eK().regex(/^\d{4}-\d{2}-\d{2}$/),direction:fn(["arrival","departure"])})).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode)return{success:!0,totalFlights:5,verified:5,mismatches:[{guestName:"Stuart Howie",flightNumber:"SQ238",enteredTime:"18:10",actualTime:"15:15",difference:"-2h 55m",terminal:"1"}],source:"mock"};if(!a.db)throw Error("Database not available");let c=await a.db.query.guests.findMany({where:(0,fD.Uo)("arrival"===b.direction?(0,fD.eq)(fC.guests.arrivalDate,b.date):(0,fD.eq)(fC.guests.departureDate,b.date),"arrival"===b.direction?(0,fD.Pe)(fC.guests.arrivalFlightNumber):(0,fD.Pe)(fC.guests.departureFlightNumber),(0,fD.kZ)(fC.guests.deletedAt))}),d={success:!0,totalFlights:c.length,verified:0,errors:0,mismatches:[],source:"api"},e=new Map;for(let a of c){let c="arrival"===b.direction?a.arrivalFlightNumber:a.departureFlightNumber;c&&(e.has(c)||e.set(c,[]),e.get(c).push(a))}for(let[c,f]of e){let e=await f9(c,b.date,"KUL");if(e.success&&e.data){let g=e.data,h="arrival"===b.direction?g.arrival:g.departure,i=f6(h.scheduled);for(let e of f){let f="arrival"===b.direction?e.arrivalTime:e.departureTime,j=f7(f,i),k=j?f8(f,i):null,l="arrival"===b.direction?{arrivalTerminal:h.terminal,arrivalGate:h.gate,arrivalVerifiedTime:i,arrivalFlightStatus:g.flightStatus,arrivalVerifiedAt:new Date,arrivalTimeMismatch:j}:{departureTerminal:h.terminal,departureGate:h.gate,departureVerifiedTime:i,departureFlightStatus:g.flightStatus,departureVerifiedAt:new Date,departureTimeMismatch:j};await a.db.update(fC.guests).set(l).where((0,fD.eq)(fC.guests.id,e.id)),d.verified++,j&&d.mismatches.push({guestId:e.id,guestName:`${e.firstName} ${e.lastName}`,flightNumber:c,enteredTime:f,actualTime:i,difference:k,terminal:h.terminal})}}else d.errors+=f.length;"api"===e.source&&await new Promise(a=>setTimeout(a,1e3))}return d}),getMismatches:bS.input(fh({direction:fn(["arrival","departure","both"]).default("both")})).query(async({ctx:a,input:b})=>{let c;if(a.isDemoMode)return[{id:"demo-1",firstName:"Stuart",lastName:"Howie",flightNumber:"SQ238",flightDate:"2026-01-18",enteredTime:"18:10",verifiedTime:"15:15",terminal:"1",gate:"C8",status:"scheduled",direction:"arrival"},{id:"demo-2",firstName:"Mark Stuart",lastName:"Borg",flightNumber:"SQ238",flightDate:"2026-01-18",enteredTime:"18:10",verifiedTime:"15:15",terminal:"1",gate:"C8",status:"scheduled",direction:"arrival"}];if(!a.db&&a.supabase){let c=a.supabase.from("guests").select("*").is("deleted_at",null);c="both"===b.direction?c.or("arrival_time_mismatch.eq.true,departure_time_mismatch.eq.true"):"arrival"===b.direction?c.eq("arrival_time_mismatch",!0):c.eq("departure_time_mismatch",!0);let{data:d,error:e}=await c;if(e)throw Error(e.message);let f=[];for(let a of d||[])("arrival"===b.direction||"both"===b.direction)&&a.arrival_time_mismatch&&f.push({id:a.id,firstName:a.first_name,lastName:a.last_name,flightNumber:a.arrival_flight_number,flightDate:a.arrival_date,enteredTime:a.arrival_time,verifiedTime:a.arrival_verified_time,terminal:a.arrival_terminal,gate:a.arrival_gate,status:a.arrival_flight_status,direction:"arrival"}),("departure"===b.direction||"both"===b.direction)&&a.departure_time_mismatch&&f.push({id:a.id,firstName:a.first_name,lastName:a.last_name,flightNumber:a.departure_flight_number,flightDate:a.departure_date,enteredTime:a.departure_time,verifiedTime:a.departure_verified_time,terminal:a.departure_terminal,gate:a.departure_gate,status:a.departure_flight_status,direction:"departure"});return f}if(!a.db)throw Error("Database not available");c="both"===b.direction?(0,fD.or)((0,fD.eq)(fC.guests.arrivalTimeMismatch,!0),(0,fD.eq)(fC.guests.departureTimeMismatch,!0)):"arrival"===b.direction?(0,fD.eq)(fC.guests.arrivalTimeMismatch,!0):(0,fD.eq)(fC.guests.departureTimeMismatch,!0);let d=await a.db.query.guests.findMany({where:(0,fD.Uo)((0,fD.kZ)(fC.guests.deletedAt),c)}),e=[];for(let a of d)("arrival"===b.direction||"both"===b.direction)&&a.arrivalTimeMismatch&&e.push({id:a.id,firstName:a.firstName,lastName:a.lastName,flightNumber:a.arrivalFlightNumber,flightDate:a.arrivalDate,enteredTime:a.arrivalTime,verifiedTime:a.arrivalVerifiedTime,terminal:a.arrivalTerminal,gate:a.arrivalGate,status:a.arrivalFlightStatus,direction:"arrival"}),("departure"===b.direction||"both"===b.direction)&&a.departureTimeMismatch&&e.push({id:a.id,firstName:a.firstName,lastName:a.lastName,flightNumber:a.departureFlightNumber,flightDate:a.departureDate,enteredTime:a.departureTime,verifiedTime:a.departureVerifiedTime,terminal:a.departureTerminal,gate:a.departureGate,status:a.departureFlightStatus,direction:"departure"});return e}),getFlightSummary:bS.input(fh({date:eK().regex(/^\d{4}-\d{2}-\d{2}$/),direction:fn(["arrival","departure"])})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return[{flightNumber:"SQ238",scheduledTime:"15:15",verifiedTime:"15:15",terminal:"1",guestCount:2,status:"scheduled",hasTimeMismatch:!0,guests:[{id:"demo-1",name:"Stuart Howie",enteredTime:"18:10"},{id:"demo-2",name:"Mark Stuart Borg",enteredTime:"18:10"}]},{flightNumber:"MH123",scheduledTime:"12:00",verifiedTime:"12:00",terminal:"1",guestCount:3,status:"scheduled",hasTimeMismatch:!1,guests:[{id:"demo-3",name:"John Smith",enteredTime:"12:00"},{id:"demo-4",name:"Jane Doe",enteredTime:"12:00"},{id:"demo-5",name:"Bob Wilson",enteredTime:"12:00"}]}];let c=a=>a?"string"==typeof a?a:a instanceof Date?a.toISOString().slice(11,16):String(a):null;if(!a.db&&a.supabase){let d="arrival"===b.direction?"arrival_date":"departure_date",{data:e,error:f}=await a.supabase.from("guests").select("*").eq(d,b.date).is("deleted_at",null);if(f)throw Error(f.message);let g=new Map;for(let a of e||[]){let d="arrival"===b.direction?a.arrival_flight_number:a.departure_flight_number;if(!d)continue;if(!g.has(d)){let e=c("arrival"===b.direction?a.arrival_time:a.departure_time),f=fQ(d,b.date),h=!!e&&fT(e);g.set(d,{flightNumber:d,scheduledTime:e,verifiedTime:c("arrival"===b.direction?a.arrival_verified_time:a.departure_verified_time),terminal:"arrival"===b.direction?a.arrival_terminal:a.departure_terminal,status:"arrival"===b.direction?a.arrival_flight_status:a.departure_flight_status,hasTimeMismatch:"arrival"===b.direction?!!a.arrival_time_mismatch:!!a.departure_time_mismatch,guests:[],transportGroup:f?{id:f.id,gatherTime:f.gatherTime,transportTime:f.transportTime,vehicleType:f.vehicleType,vehicleIcon:fO[f.vehicleType].icon,combinedPax:f.combinedPax,otherFlights:f.flights.filter(a=>a.toUpperCase()!==d.toUpperCase()),remark:f.remark}:null,hasMidnightSurcharge:h,recommendedVehicle:{type:"SEDAN",name:"Sedan",icon:"\uD83D\uDE97"}})}let e=g.get(d);e.guests.push({id:a.id,name:`${a.first_name} ${a.last_name}`,enteredTime:c("arrival"===b.direction?a.arrival_time:a.departure_time)}),("arrival"===b.direction?a.arrival_time_mismatch:a.departure_time_mismatch)&&(e.hasTimeMismatch=!0)}for(let a of g.values()){let b=fS(a.guests.length);a.recommendedVehicle={type:b.type,name:b.name,icon:b.icon}}return Array.from(g.values()).sort((a,b)=>{let c=a.verifiedTime||a.scheduledTime||"",d=b.verifiedTime||b.scheduledTime||"";return c.localeCompare(d)})}if(!a.db)throw Error("Database not available");let d=await a.db.query.guests.findMany({where:(0,fD.Uo)("arrival"===b.direction?(0,fD.eq)(fC.guests.arrivalDate,b.date):(0,fD.eq)(fC.guests.departureDate,b.date),(0,fD.kZ)(fC.guests.deletedAt))}),e=new Map;for(let a of d){let d="arrival"===b.direction?a.arrivalFlightNumber:a.departureFlightNumber;if(!d)continue;if(!e.has(d)){let f=c("arrival"===b.direction?a.arrivalTime:a.departureTime),g=fQ(d,b.date),h=!!f&&fT(f);e.set(d,{flightNumber:d,scheduledTime:f,verifiedTime:c("arrival"===b.direction?a.arrivalVerifiedTime:a.departureVerifiedTime),terminal:"arrival"===b.direction?a.arrivalTerminal:a.departureTerminal,status:"arrival"===b.direction?a.arrivalFlightStatus:a.departureFlightStatus,hasTimeMismatch:"arrival"===b.direction?!!a.arrivalTimeMismatch:!!a.departureTimeMismatch,guests:[],transportGroup:g?{id:g.id,gatherTime:g.gatherTime,transportTime:g.transportTime,vehicleType:g.vehicleType,vehicleIcon:fO[g.vehicleType].icon,combinedPax:g.combinedPax,otherFlights:g.flights.filter(a=>a.toUpperCase()!==d.toUpperCase()),remark:g.remark}:null,hasMidnightSurcharge:h,recommendedVehicle:{type:"SEDAN",name:"Sedan",icon:"\uD83D\uDE97"}})}let f=e.get(d);f.guests.push({id:a.id,name:`${a.firstName} ${a.lastName}`,enteredTime:c("arrival"===b.direction?a.arrivalTime:a.departureTime)}),("arrival"===b.direction?a.arrivalTimeMismatch:a.departureTimeMismatch)&&(f.hasTimeMismatch=!0)}for(let a of e.values()){let b=fS(a.guests.length);a.recommendedVehicle={type:b.type,name:b.name,icon:b.icon}}return Array.from(e.values()).sort((a,b)=>{let c=a.verifiedTime||a.scheduledTime||"",d=b.verifiedTime||b.scheduledTime||"";return c.localeCompare(d)})}),getUniqueFlightNumbers:bS.input(fh({eventDate:eK().regex(/^\d{4}-\d{2}-\d{2}$/)})).query(async({ctx:a,input:b})=>{if(a.isDemoMode)return{flights:[{flightNumber:"SQ238",flightDate:b.eventDate,direction:"arrival",expectedTime:"15:15",schedule:gs(b.eventDate)},{flightNumber:"MH123",flightDate:b.eventDate,direction:"arrival",expectedTime:"12:00",schedule:gs(b.eventDate)}],apiUsage:{aviationStackCalls:10,openSkyCalls:0,withinFreeTier:!0}};if(!a.db)throw Error("Database not available");let c=function(a){let b=new Map;return a.forEach(a=>{if(a.arrivalFlightNumber&&a.arrivalDate){let c=`${a.arrivalFlightNumber}-${a.arrivalDate}-arrival`;b.has(c)||b.set(c,{flightNumber:a.arrivalFlightNumber,flightDate:a.arrivalDate,direction:"arrival",expectedTime:a.arrivalTime||""})}if(a.departureFlightNumber&&a.departureDate){let c=`${a.departureFlightNumber}-${a.departureDate}-departure`;b.has(c)||b.set(c,{flightNumber:a.departureFlightNumber,flightDate:a.departureDate,direction:"departure",expectedTime:a.departureTime||""})}}),Array.from(b.values())}(await a.db.query.guests.findMany({where:(0,fD.kZ)(fC.guests.deletedAt)}));return{flights:c.map(a=>({...a,schedule:gs(a.flightDate)})),apiUsage:function(a){let b=0,c=0;return a.forEach(a=>{let d=gs(a.flightDate),e=gr(a.flightDate);"realtime"===d.frequency?c+=144:"five_daily"===d.frequency?b+=5*Math.min(e,7):b+=2*Math.min(e-7,30)}),{aviationStackCalls:b,openSkyCalls:c,withinFreeTier:b<=100}}(c)}}),verifyUniqueFlights:bS.input(fh({flights:ff(fh({flightNumber:eK(),flightDate:eK(),direction:fn(["arrival","departure"]),expectedTime:eK()}))})).mutation(async({ctx:a,input:b})=>{let c=[];for(let a of b.flights)if("realtime"===gs(a.flightDate).frequency){let b=await gg(a.flightNumber);c.push({flightNumber:a.flightNumber,flightDate:a.flightDate,status:b.success?b.data?.hasLanded?"landed":b.data?.isInAir?"in_air":"unknown":"not_found",timeMismatch:!1,isLive:!0,liveStatus:b.data?{isInAir:b.data.isInAir,hasLanded:b.data.hasLanded,position:b.data.position||void 0}:void 0})}else{let b=await gt(a),d=b.scheduledInfo?.arrival.scheduled?new Date(b.scheduledInfo.arrival.scheduled).toTimeString().slice(0,5):void 0;c.push({flightNumber:a.flightNumber,flightDate:a.flightDate,status:b.status,verifiedTime:d,timeMismatch:b.timeMismatch||!1,isLive:!1}),await new Promise(a=>setTimeout(a,1e3))}return{results:c}}),getLiveFlightStatus:bS.input(fh({flightNumber:eK()})).query(async({input:a})=>await gg(a.flightNumber)),getBatchLiveStatus:bS.input(fh({flightNumbers:ff(eK())})).query(async({input:a})=>{let b=await gh(a.flightNumbers),c=[];for(let[a,d]of b)d?c.push({flightNumber:a,found:!0,isInAir:d.isInAir,hasLanded:d.hasLanded,position:d.position||void 0,lastUpdate:d.lastUpdate.toISOString()}):c.push({flightNumber:a,found:!1});return{success:!0,apiCallsUsed:1,results:c}}),getArrivingFlights:bS.query(async()=>await gi("KUL")),getPollingInfo:bS.input(fh({flightDate:eK().regex(/^\d{4}-\d{2}-\d{2}$/)})).query(({input:a})=>gs(a.flightDate)),getFlightDateRange:bS.query(async({ctx:a})=>{if(a.isDemoMode)return{firstArrivalDate:"2026-01-18",firstDepartureDate:"2026-01-21",lastArrivalDate:"2026-01-18",lastDepartureDate:"2026-01-22"};if(!a.db&&a.supabase){let{data:b}=await a.supabase.from("guests").select("arrival_date").not("arrival_date","is",null).is("deleted_at",null).order("arrival_date",{ascending:!0}),{data:c}=await a.supabase.from("guests").select("departure_date").not("departure_date","is",null).is("deleted_at",null).order("departure_date",{ascending:!0}),d=b?.map(a=>a.arrival_date).filter(Boolean)||[],e=c?.map(a=>a.departure_date).filter(Boolean)||[];return{firstArrivalDate:d[0]||null,firstDepartureDate:e[0]||null,lastArrivalDate:d[d.length-1]||null,lastDepartureDate:e[e.length-1]||null}}if(!a.db)throw Error("Database not available");let b=await a.db.query.guests.findMany({where:(0,fD.kZ)(fC.guests.deletedAt)}),c=b.map(a=>a.arrivalDate).filter(Boolean).sort(),d=b.map(a=>a.departureDate).filter(Boolean).sort();return{firstArrivalDate:c[0]||null,firstDepartureDate:d[0]||null,lastArrivalDate:c[c.length-1]||null,lastDepartureDate:d[d.length-1]||null}})}),gv={greeting:`Hello! I'm your Axis Event Tracker assistant. I can help you with:
- Finding guest information
- Checking arrival and departure schedules
- Transport and vehicle assignments
- Event statistics and summaries

What would you like to know?`,noResults:`I couldn't find any results for your query. Here are some things you can try:
- Check the spelling of names
- Try broader search terms
- Ask about specific dates or departments`,error:"I'm sorry, I encountered an error processing your request. Please try rephrasing your question or contact support if the issue persists.",outOfScope:`I'm specialized in helping with event guest management and logistics. I can answer questions about:
- Guest lists and registration status
- Travel arrangements (flights, dates)
- Transport schedules and vehicle assignments
- Hotel bookings

For other questions, please contact your event coordinator.`},gw=["guests","vehicles","transport_schedules","guest_transport_assignments"],gx={guests:["id","email","first_name","last_name","axis_email","reporting_level_1","reporting_level_2","reporting_level_3","function","location","arrival_date","arrival_time","arrival_flight_number","arrival_airport","departure_date","departure_time","departure_flight_number","departure_airport","hotel_checkin_date","hotel_checkout_date","needs_arrival_transfer","needs_departure_transfer","registration_status","travel_type","created_at","updated_at"],vehicles:["id","name","type","capacity","driver_name","driver_phone","license_plate","is_active","created_at","updated_at"],transport_schedules:["id","vehicle_id","direction","schedule_date","pickup_time","pickup_location","dropoff_location","status","notes","created_at","updated_at"],guest_transport_assignments:["id","guest_id","schedule_id","assignment_type","status","created_at"]},gy=["DROP","DELETE","UPDATE","INSERT","ALTER","TRUNCATE","CREATE","GRANT","REVOKE","EXEC","EXECUTE","XP_","SP_","SHUTDOWN","WAITFOR"],gz=["--","/*","*/"],gA=[/;.*$/i,/--.*$/m,/\/\*[\s\S]*?\*\//g,/union\s+all/i,/union\s+select/i,/into\s+outfile/i,/into\s+dumpfile/i,/load_file/i,/benchmark\s*\(/i,/sleep\s*\(/i,/pg_sleep/i,/information_schema/i,/pg_catalog/i],gB=`
You are an AI assistant for the Axis Event Tracker system. You help users query event and guest data.

DATABASE SCHEMA:

1. guests - Main guest information table
   Columns:
   - id (uuid, primary key)
   - email (varchar, unique)
   - first_name (varchar)
   - last_name (varchar)
   - axis_email (varchar, nullable)
   - reporting_level_1, reporting_level_2, reporting_level_3 (varchar, organization hierarchy)
   - function (varchar, job function/department)
   - location (varchar, office location)
   - arrival_date (date), arrival_time (time)
   - arrival_flight_number (varchar), arrival_airport (varchar)
   - arrival_flight_status (enum: 'scheduled', 'active', 'landed', 'cancelled', 'diverted', 'unknown')
   - departure_date (date), departure_time (time)
   - departure_flight_number (varchar), departure_airport (varchar)
   - departure_flight_status (enum: same as arrival)
   - hotel_checkin_date (date), hotel_checkout_date (date)
   - needs_arrival_transfer (boolean) - true if guest needs pickup from airport
   - needs_departure_transfer (boolean) - true if guest needs dropoff to airport
   - registration_status (enum: 'pending', 'confirmed', 'cancelled', 'waitlisted')
   - travel_type (varchar)
   - is_duplicate (boolean), is_removed (boolean)
   - created_at, updated_at, deleted_at (timestamps)

2. vehicles - Transport vehicles
   Columns:
   - id (uuid, primary key)
   - name (varchar)
   - type (varchar, e.g., 'van', 'bus', 'sedan')
   - capacity (integer)
   - driver_name, driver_phone (varchar)
   - license_plate (varchar)
   - is_active (boolean)

3. transport_schedules - Scheduled transport trips
   Columns:
   - id (uuid, primary key)
   - vehicle_id (uuid, references vehicles)
   - direction (enum: 'arrival', 'departure')
   - schedule_date (date)
   - pickup_time (time)
   - pickup_location, dropoff_location (varchar)
   - status (enum: 'scheduled', 'in_progress', 'completed', 'cancelled')
   - notes (text)

4. guest_transport_assignments - Links guests to transport schedules
   Columns:
   - id (uuid, primary key)
   - guest_id (uuid, references guests)
   - schedule_id (uuid, references transport_schedules)
   - assignment_type (enum: 'arrival', 'departure')
   - status (enum: 'assigned', 'completed', 'no_show')

IMPORTANT RULES:
1. ONLY generate SELECT queries - never INSERT, UPDATE, DELETE, DROP, or any modifying statements
2. Use PostgreSQL syntax
3. Always use lowercase column names with underscores (e.g., first_name, not firstName)
4. For date comparisons, use CURRENT_DATE for today, CURRENT_DATE + 1 for tomorrow
5. When counting guests needing transport, check needs_arrival_transfer OR needs_departure_transfer
6. Exclude removed guests: WHERE is_removed = false OR is_removed IS NULL
7. For name searches, use ILIKE for case-insensitive matching
8. Limit results to 50 rows max unless specifically asked for more
`;async function gC(a){let b=process.env.OPENROUTER_API_KEY;if(!b)throw Error("OPENROUTER_API_KEY is not configured");let c=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json","HTTP-Referer":"https://axis-event.netlify.app","X-Title":"Axis Event Tracker"},body:JSON.stringify({model:"x-ai/grok-4.1-fast",messages:a,temperature:.3,max_tokens:1024})});if(!c.ok){let a=await c.text();throw Error(`OpenRouter API error: ${c.status} - ${a}`)}let d=await c.json();if(d.error)throw Error(`OpenRouter error: ${d.error.message}`);return d.choices[0]?.message?.content||""}async function gD(a){let b=`${gB}

Your task is to generate a PostgreSQL SELECT query based on the user's question.

RESPONSE FORMAT (JSON only, no markdown):
{
  "query": "SELECT ... FROM ...",
  "explanation": "Brief explanation of what this query does",
  "isReadOnly": true
}

If the user's question cannot be answered with a database query, or is a greeting/general question, respond with:
{
  "query": null,
  "explanation": "This is a conversational question, not a data query",
  "isReadOnly": true
}

Remember: ONLY SELECT queries are allowed. If asked to modify data, set query to null.`;try{let c=(await gC([{role:"system",content:b},{role:"user",content:a}])).match(/\{[\s\S]*\}/);if(!c)return{query:null,explanation:"Could not parse AI response",isReadOnly:!0};let d=JSON.parse(c[0]);if(d.query){let a=d.query.toUpperCase().trim();for(let b of["INSERT","UPDATE","DELETE","DROP","TRUNCATE","ALTER","CREATE","GRANT","REVOKE"])if(a.startsWith(b)||a.includes(` ${b} `))return{query:null,explanation:"Query rejected: Only SELECT queries are allowed",isReadOnly:!1};if(!a.startsWith("SELECT"))return{query:null,explanation:"Query rejected: Must be a SELECT query",isReadOnly:!1}}return d}catch(a){return console.error("Error generating query:",a),{query:null,explanation:a instanceof Error?a.message:"Unknown error",isReadOnly:!0}}}async function gE(a,b,c){let d=`You are a helpful assistant for the Axis Event Tracker system.
You help transport managers and event staff understand guest and transport data.

Guidelines:
- Be concise and friendly
- Format numbers clearly (e.g., "339 guests" not "339")
- Use bullet points for lists
- Highlight important information with **bold**
- Include relevant dates when discussing arrivals/departures
- If the data is empty, explain it clearly (e.g., "No guests are arriving today")
- Don't mention SQL queries or technical details to the user
- Use natural language, not code

Current date: ${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`,e=`User asked: "${a}"

Query explanation: ${c}

Query results (JSON):
${JSON.stringify(b,null,2)}

Please provide a helpful, natural language response to the user's question based on these results.`;try{return{response:await gC([{role:"system",content:d},{role:"user",content:e}])}}catch(a){return console.error("Error generating response:",a),{response:"I apologize, but I encountered an error processing your request. Please try again."}}}async function gF(a){let b=`You are a friendly AI assistant for the Axis Event Tracker system.
You help transport managers and event registration staff with:
- Finding guest information
- Checking arrival and departure schedules
- Transport and vehicle assignments
- Event statistics and summaries

If the user greets you or asks what you can do, explain your capabilities briefly.
If they ask a data question, encourage them to ask specifically.

Be concise, friendly, and professional. Use bullet points when listing capabilities.
Current date: ${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`;try{return await gC([{role:"system",content:b},{role:"user",content:a}])}catch(a){return console.error("Error in conversation:",a),"Hello! I'm your Axis Event Tracker assistant. I can help you with guest information, arrivals, departures, and transport assignments. What would you like to know?"}}let gG={name:"count_guests",description:"Count the total number of guests, optionally filtered by criteria like location, registration status, or date",parameters:fh({location:eK().optional().describe('Filter by location (e.g., "Japan", "USA")'),registration_status:fn(["confirmed","pending","cancelled","waitlisted"]).optional().describe("Filter by registration status"),needs_arrival_transfer:e8().optional().describe("Filter by whether guest needs arrival transfer"),needs_departure_transfer:e8().optional().describe("Filter by whether guest needs departure transfer"),arrival_date:eK().optional().describe("Filter by arrival date (YYYY-MM-DD format)"),departure_date:eK().optional().describe("Filter by departure date (YYYY-MM-DD format)")}),execute:async(a,b)=>{let c=b.from("guests").select("*",{count:"exact",head:!0}).or("is_removed.eq.false,is_removed.is.null");a.location&&(c=c.ilike("location",`%${a.location}%`)),a.registration_status&&(c=c.eq("registration_status",a.registration_status)),void 0!==a.needs_arrival_transfer&&(c=c.eq("needs_arrival_transfer",a.needs_arrival_transfer)),void 0!==a.needs_departure_transfer&&(c=c.eq("needs_departure_transfer",a.needs_departure_transfer)),a.arrival_date&&(c=c.eq("arrival_date",a.arrival_date)),a.departure_date&&(c=c.eq("departure_date",a.departure_date));let{count:d,error:e}=await c;return e?{success:!1,error:e.message}:{success:!0,data:{count:d||0,filters_applied:Object.entries(a).filter(([,a])=>void 0!==a).map(([a])=>a)}}}},gH={name:"get_guests",description:"Get a list of guests with their details, optionally filtered and limited",parameters:fh({location:eK().optional().describe("Filter by location"),registration_status:fn(["confirmed","pending","cancelled","waitlisted"]).optional(),arrival_date:eK().optional().describe("Filter by arrival date (YYYY-MM-DD)"),departure_date:eK().optional().describe("Filter by departure date (YYYY-MM-DD)"),search:eK().optional().describe("Search by name or email"),limit:fB().max(50).default(20).describe("Maximum number of results"),order_by:fn(["first_name","last_name","arrival_date","departure_date"]).optional()}),execute:async(a,b)=>{let c=b.from("guests").select("id, first_name, last_name, email, location, registration_status, arrival_date, arrival_time, departure_date, departure_time, needs_arrival_transfer, needs_departure_transfer").or("is_removed.eq.false,is_removed.is.null");a.location&&(c=c.ilike("location",`%${a.location}%`)),a.registration_status&&(c=c.eq("registration_status",a.registration_status)),a.arrival_date&&(c=c.eq("arrival_date",a.arrival_date)),a.departure_date&&(c=c.eq("departure_date",a.departure_date)),a.search&&(c=c.or(`first_name.ilike.%${a.search}%,last_name.ilike.%${a.search}%,email.ilike.%${a.search}%`)),a.order_by&&(c=c.order(a.order_by)),c=c.limit(a.limit||20);let{data:d,error:e}=await c;return e?{success:!1,error:e.message}:{success:!0,data:{guests:d||[],count:d?.length||0}}}},gI={name:"get_busiest_arrival_day",description:"Find the arrival date with the most guests",parameters:fh({top_n:fB().max(10).default(1).describe("Number of top days to return")}),execute:async(a,b)=>{let c=`
      SELECT arrival_date, COUNT(*) as guest_count
      FROM guests
      WHERE registration_status = 'confirmed'
        AND (is_removed = false OR is_removed IS NULL)
        AND arrival_date IS NOT NULL
      GROUP BY arrival_date
      ORDER BY guest_count DESC
      LIMIT ${a.top_n||1}
    `.trim(),{data:d,error:e}=await b.rpc("execute_readonly_query",{query_text:c});return e?{success:!1,error:e.message}:{success:!0,data:{busiest_days:d||[]}}}},gJ={name:"get_guest_stats",description:"Get statistics about guests including counts by status, location breakdown, and transfer needs",parameters:fh({group_by:fn(["registration_status","location","arrival_date","departure_date"]).optional().describe("Group statistics by this field")}),execute:async(a,b)=>{let c={},{count:d}=await b.from("guests").select("*",{count:"exact",head:!0}).or("is_removed.eq.false,is_removed.is.null");c.total_guests=d||0;let{data:e}=await b.from("guests").select("registration_status").or("is_removed.eq.false,is_removed.is.null");if(e){let a={};e.forEach(b=>{let c=b.registration_status||"unknown";a[c]=(a[c]||0)+1}),c.by_status=a}let{count:f}=await b.from("guests").select("*",{count:"exact",head:!0}).eq("needs_arrival_transfer",!0).or("is_removed.eq.false,is_removed.is.null"),{count:g}=await b.from("guests").select("*",{count:"exact",head:!0}).eq("needs_departure_transfer",!0).or("is_removed.eq.false,is_removed.is.null");if(c.transfer_needs={arrival:f||0,departure:g||0},"location"===a.group_by){let{data:a}=await b.from("guests").select("location").or("is_removed.eq.false,is_removed.is.null");if(a){let b={};a.forEach(a=>{let c=a.location||"Unknown";b[c]=(b[c]||0)+1}),c.by_location=b}}return{success:!0,data:c}}},gK=[gG,gH,gI,gJ,{name:"get_vehicles",description:"Get list of available vehicles and their details",parameters:fh({active_only:e8().default(!0).describe("Only return active vehicles")}),execute:async(a,b)=>{let c=b.from("vehicles").select("id, name, type, capacity, driver_name, driver_phone, license_plate, is_active");a.active_only&&(c=c.eq("is_active",!0));let{data:d,error:e}=await c.order("name");if(e)return{success:!1,error:e.message};let f=(d||[]).reduce((a,b)=>a+(b.capacity||0),0);return{success:!0,data:{vehicles:d||[],count:d?.length||0,total_capacity:f}}}},{name:"get_transport_schedules",description:"Get transport schedules for a specific date",parameters:fh({date:eK().describe("Date to get schedules for (YYYY-MM-DD)"),direction:fn(["arrival","departure"]).optional().describe("Filter by direction"),status:fn(["scheduled","in_progress","completed","cancelled"]).optional()}),execute:async(a,b)=>{let c=b.from("transport_schedules").select(`
        id, direction, schedule_date, pickup_time, pickup_location, dropoff_location, status, notes,
        vehicles (name, type, capacity, driver_name)
      `).eq("schedule_date",a.date);a.direction&&(c=c.eq("direction",a.direction)),a.status&&(c=c.eq("status",a.status));let{data:d,error:e}=await c.order("pickup_time");return e?{success:!1,error:e.message}:{success:!0,data:{schedules:d||[],count:d?.length||0,date:a.date}}}}];async function gL(a,b,c){let d=gK.find(b=>b.name===a);if(!d)return{success:!1,error:`Unknown tool: ${a}`};try{let a=d.parameters.parse(b);return await d.execute(a,c)}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}let gM="https://openrouter.ai/api/v1/chat/completions",gN="x-ai/grok-4.1-fast",gO=`You are an AI assistant for the Axis Event Tracker system. You help transport managers and event staff with guest and transport data.

You have access to the following tools to query the database:
- count_guests: Count guests with optional filters (location, status, transfer needs, dates)
- get_guests: Get guest details with filters and search
- get_busiest_arrival_day: Find the busiest arrival day(s)
- get_guest_stats: Get comprehensive guest statistics
- get_vehicles: Get vehicle fleet information
- get_transport_schedules: Get transport schedules for a specific date

IMPORTANT RULES:
1. ALWAYS use tools to get data - never make up numbers or dates
2. Use the most specific tool for the user's question
3. For counts, use count_guests with appropriate filters
4. For "how many guests from [location]", use count_guests with location filter
5. For "busiest day", use get_busiest_arrival_day
6. For transport info, use get_vehicles or get_transport_schedules
7. After getting tool results, provide a natural, helpful response
8. Format numbers clearly (e.g., "252 guests" not just "252")
9. Include relevant context in your response

Current date: ${new Date().toISOString().split("T")[0]}`;async function gP(a,b,c=[]){let d=process.env.OPENROUTER_API_KEY;if(!d)throw Error("OPENROUTER_API_KEY is not configured");let e=gK.map(a=>({type:"function",function:{name:a.name,description:a.description,parameters:function(a){let b=a.shape,c={},d=[];for(let[a,e]of Object.entries(b)){let b=e.description,f=e.isOptional();f||d.push(a);let g=f?e._def.innerType:e;c[a]={...function a(b){switch(b._def.typeName){case"ZodString":default:return{type:"string"};case"ZodNumber":return{type:"number"};case"ZodBoolean":return{type:"boolean"};case"ZodEnum":return{type:"string",enum:b._def.values};case"ZodDefault":return a(b._def.innerType)}}(g),...b?{description:b}:{}}}return{type:"object",properties:c,required:d.length>0?d:void 0}}(a.parameters)}})),f=[],g=[{role:"system",content:gO},...c,{role:"user",content:a}],h=await gQ(d,g,e),i=h.choices[0]?.message,j=0;for(;i?.tool_calls&&j<5;){for(let a of(j++,g.push({role:"assistant",content:i.content||"",tool_calls:i.tool_calls}),i.tool_calls)){let c,d=a.function.name;f.push(d),console.log(`[Tool Call] ${d}:`,a.function.arguments);try{let e=JSON.parse(a.function.arguments);c=await gL(d,e,b)}catch(a){c={success:!1,error:a instanceof Error?a.message:"Failed to parse arguments"}}console.log(`[Tool Result] ${d}:`,c),g.push({role:"tool",tool_call_id:a.id,name:d,content:JSON.stringify(c)})}h=await gQ(d,g,e),i=h.choices[0]?.message}return{response:i?.content||"I apologize, but I encountered an issue processing your request.",toolsUsed:f}}async function gQ(a,b,c){let d=await fetch(gM,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json","HTTP-Referer":"https://axis-event.netlify.app","X-Title":"Axis Event Tracker"},body:JSON.stringify({model:gN,messages:b,tools:c,tool_choice:"auto",temperature:.3,max_tokens:2048})});if(!d.ok){let a=await d.text();throw Error(`OpenRouter API error: ${d.status} - ${a}`)}let e=await d.json();if(e.error)throw Error(`OpenRouter error: ${e.error.message}`);return e}async function gR(a){let b=process.env.OPENROUTER_API_KEY;if(!b)return"Hello! I'm your Axis Event Tracker assistant. I can help you with guest information, arrivals, departures, and transport assignments. What would you like to know?";let c=await fetch(gM,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json","HTTP-Referer":"https://axis-event.netlify.app","X-Title":"Axis Event Tracker"},body:JSON.stringify({model:gN,messages:[{role:"system",content:`You are a friendly AI assistant for the Axis Event Tracker system.
You help transport managers and event staff with:
- Finding guest information
- Checking arrival and departure schedules
- Transport and vehicle assignments
- Event statistics and summaries

Be concise, friendly, and professional. Use bullet points when listing capabilities.
Current date: ${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`},{role:"user",content:a}],temperature:.7,max_tokens:512})});if(!c.ok)return"Hello! I'm your Axis Event Tracker assistant. I can help you with guest information, arrivals, departures, and transport assignments. What would you like to know?";let d=await c.json();return d.choices[0]?.message?.content||"Hello! How can I help you today?"}let gS={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function gT(a){return (b={})=>{let c=b.width?String(b.width):a.defaultWidth;return a.formats[c]||a.formats[a.defaultWidth]}}let gU={date:gT({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:gT({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:gT({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},gV={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function gW(a){return(b,c)=>{let d;if("formatting"===(c?.context?String(c.context):"standalone")&&a.formattingValues){let b=a.defaultFormattingWidth||a.defaultWidth,e=c?.width?String(c.width):b;d=a.formattingValues[e]||a.formattingValues[b]}else{let b=a.defaultWidth,e=c?.width?String(c.width):a.defaultWidth;d=a.values[e]||a.values[b]}return d[a.argumentCallback?a.argumentCallback(b):b]}}function gX(a){return(b,c={})=>{let d,e=c.width,f=e&&a.matchPatterns[e]||a.matchPatterns[a.defaultMatchWidth],g=b.match(f);if(!g)return null;let h=g[0],i=e&&a.parsePatterns[e]||a.parsePatterns[a.defaultParseWidth],j=Array.isArray(i)?function(a,b){for(let c=0;c<a.length;c++)if(b(a[c]))return c}(i,a=>a.test(h)):function(a,b){for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)&&b(a[c]))return c}(i,a=>a.test(h));return d=a.valueCallback?a.valueCallback(j):j,{value:d=c.valueCallback?c.valueCallback(d):d,rest:b.slice(h.length)}}}let gY={code:"en-US",formatDistance:(a,b,c)=>{let d,e=gS[a];if(d="string"==typeof e?e:1===b?e.one:e.other.replace("{{count}}",b.toString()),c?.addSuffix)if(c.comparison&&c.comparison>0)return"in "+d;else return d+" ago";return d},formatLong:gU,formatRelative:(a,b,c,d)=>gV[a],localize:{ordinalNumber:(a,b)=>{let c=Number(a),d=c%100;if(d>20||d<10)switch(d%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"},era:gW({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:gW({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:a=>a-1}),month:gW({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:gW({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:gW({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:function(a){return(b,c={})=>{let d=b.match(a.matchPattern);if(!d)return null;let e=d[0],f=b.match(a.parsePattern);if(!f)return null;let g=a.valueCallback?a.valueCallback(f[0]):f[0];return{value:g=c.valueCallback?c.valueCallback(g):g,rest:b.slice(e.length)}}}({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:a=>parseInt(a,10)}),era:gX({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:gX({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:a=>a+1}),month:gX({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:gX({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:gX({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},gZ={},g$=Symbol.for("constructDateFrom");function g_(a,b){return"function"==typeof a?a(b):a&&"object"==typeof a&&g$ in a?a[g$](b):a instanceof Date?new a.constructor(b):new Date(b)}function g0(a,b){return g_(b||a,a)}function g1(a){let b=g0(a),c=new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds()));return c.setUTCFullYear(b.getFullYear()),a-c}function g2(a,b){let c=g0(a,b?.in);return c.setHours(0,0,0,0),c}function g3(a,b){let c=b?.weekStartsOn??b?.locale?.options?.weekStartsOn??gZ.weekStartsOn??gZ.locale?.options?.weekStartsOn??0,d=g0(a,b?.in),e=d.getDay();return d.setDate(d.getDate()-(7*(e<c)+e-c)),d.setHours(0,0,0,0),d}function g4(a,b){return g3(a,{...b,weekStartsOn:1})}function g5(a,b){let c=g0(a,b?.in),d=c.getFullYear(),e=g_(c,0);e.setFullYear(d+1,0,4),e.setHours(0,0,0,0);let f=g4(e),g=g_(c,0);g.setFullYear(d,0,4),g.setHours(0,0,0,0);let h=g4(g);return c.getTime()>=f.getTime()?d+1:c.getTime()>=h.getTime()?d:d-1}function g6(a,b){let c=g0(a,b?.in),d=c.getFullYear(),e=b?.firstWeekContainsDate??b?.locale?.options?.firstWeekContainsDate??gZ.firstWeekContainsDate??gZ.locale?.options?.firstWeekContainsDate??1,f=g_(b?.in||a,0);f.setFullYear(d+1,0,e),f.setHours(0,0,0,0);let g=g3(f,b),h=g_(b?.in||a,0);h.setFullYear(d,0,e),h.setHours(0,0,0,0);let i=g3(h,b);return+c>=+g?d+1:+c>=+i?d:d-1}function g7(a,b){let c=Math.abs(a).toString().padStart(b,"0");return(a<0?"-":"")+c}let g8={y(a,b){let c=a.getFullYear(),d=c>0?c:1-c;return g7("yy"===b?d%100:d,b.length)},M(a,b){let c=a.getMonth();return"M"===b?String(c+1):g7(c+1,2)},d:(a,b)=>g7(a.getDate(),b.length),a(a,b){let c=a.getHours()/12>=1?"pm":"am";switch(b){case"a":case"aa":return c.toUpperCase();case"aaa":return c;case"aaaaa":return c[0];default:return"am"===c?"a.m.":"p.m."}},h:(a,b)=>g7(a.getHours()%12||12,b.length),H:(a,b)=>g7(a.getHours(),b.length),m:(a,b)=>g7(a.getMinutes(),b.length),s:(a,b)=>g7(a.getSeconds(),b.length),S(a,b){let c=b.length;return g7(Math.trunc(a.getMilliseconds()*Math.pow(10,c-3)),b.length)}},g9={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ha={G:function(a,b,c){let d=+(a.getFullYear()>0);switch(b){case"G":case"GG":case"GGG":return c.era(d,{width:"abbreviated"});case"GGGGG":return c.era(d,{width:"narrow"});default:return c.era(d,{width:"wide"})}},y:function(a,b,c){if("yo"===b){let b=a.getFullYear();return c.ordinalNumber(b>0?b:1-b,{unit:"year"})}return g8.y(a,b)},Y:function(a,b,c,d){let e=g6(a,d),f=e>0?e:1-e;return"YY"===b?g7(f%100,2):"Yo"===b?c.ordinalNumber(f,{unit:"year"}):g7(f,b.length)},R:function(a,b){return g7(g5(a),b.length)},u:function(a,b){return g7(a.getFullYear(),b.length)},Q:function(a,b,c){let d=Math.ceil((a.getMonth()+1)/3);switch(b){case"Q":return String(d);case"QQ":return g7(d,2);case"Qo":return c.ordinalNumber(d,{unit:"quarter"});case"QQQ":return c.quarter(d,{width:"abbreviated",context:"formatting"});case"QQQQQ":return c.quarter(d,{width:"narrow",context:"formatting"});default:return c.quarter(d,{width:"wide",context:"formatting"})}},q:function(a,b,c){let d=Math.ceil((a.getMonth()+1)/3);switch(b){case"q":return String(d);case"qq":return g7(d,2);case"qo":return c.ordinalNumber(d,{unit:"quarter"});case"qqq":return c.quarter(d,{width:"abbreviated",context:"standalone"});case"qqqqq":return c.quarter(d,{width:"narrow",context:"standalone"});default:return c.quarter(d,{width:"wide",context:"standalone"})}},M:function(a,b,c){let d=a.getMonth();switch(b){case"M":case"MM":return g8.M(a,b);case"Mo":return c.ordinalNumber(d+1,{unit:"month"});case"MMM":return c.month(d,{width:"abbreviated",context:"formatting"});case"MMMMM":return c.month(d,{width:"narrow",context:"formatting"});default:return c.month(d,{width:"wide",context:"formatting"})}},L:function(a,b,c){let d=a.getMonth();switch(b){case"L":return String(d+1);case"LL":return g7(d+1,2);case"Lo":return c.ordinalNumber(d+1,{unit:"month"});case"LLL":return c.month(d,{width:"abbreviated",context:"standalone"});case"LLLLL":return c.month(d,{width:"narrow",context:"standalone"});default:return c.month(d,{width:"wide",context:"standalone"})}},w:function(a,b,c,d){let e=function(a,b){let c=g0(a,b?.in);return Math.round((g3(c,b)-function(a,b){let c=b?.firstWeekContainsDate??b?.locale?.options?.firstWeekContainsDate??gZ.firstWeekContainsDate??gZ.locale?.options?.firstWeekContainsDate??1,d=g6(a,b),e=g_(b?.in||a,0);return e.setFullYear(d,0,c),e.setHours(0,0,0,0),g3(e,b)}(c,b))/6048e5)+1}(a,d);return"wo"===b?c.ordinalNumber(e,{unit:"week"}):g7(e,b.length)},I:function(a,b,c){let d=function(a,b){let c=g0(a,void 0);return Math.round((g4(c)-function(a,b){let c=g5(a,void 0),d=g_(a,0);return d.setFullYear(c,0,4),d.setHours(0,0,0,0),g4(d)}(c))/6048e5)+1}(a);return"Io"===b?c.ordinalNumber(d,{unit:"week"}):g7(d,b.length)},d:function(a,b,c){return"do"===b?c.ordinalNumber(a.getDate(),{unit:"date"}):g8.d(a,b)},D:function(a,b,c){let d=function(a,b){let c=g0(a,void 0);return function(a,b,c){let[d,e]=function(a,...b){let c=g_.bind(null,a||b.find(a=>"object"==typeof a));return b.map(c)}(void 0,a,b),f=g2(d),g=g2(e);return Math.round((f-g1(f)-(g-g1(g)))/864e5)}(c,function(a,b){let c=g0(a,void 0);return c.setFullYear(c.getFullYear(),0,1),c.setHours(0,0,0,0),c}(c))+1}(a);return"Do"===b?c.ordinalNumber(d,{unit:"dayOfYear"}):g7(d,b.length)},E:function(a,b,c){let d=a.getDay();switch(b){case"E":case"EE":case"EEE":return c.day(d,{width:"abbreviated",context:"formatting"});case"EEEEE":return c.day(d,{width:"narrow",context:"formatting"});case"EEEEEE":return c.day(d,{width:"short",context:"formatting"});default:return c.day(d,{width:"wide",context:"formatting"})}},e:function(a,b,c,d){let e=a.getDay(),f=(e-d.weekStartsOn+8)%7||7;switch(b){case"e":return String(f);case"ee":return g7(f,2);case"eo":return c.ordinalNumber(f,{unit:"day"});case"eee":return c.day(e,{width:"abbreviated",context:"formatting"});case"eeeee":return c.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return c.day(e,{width:"short",context:"formatting"});default:return c.day(e,{width:"wide",context:"formatting"})}},c:function(a,b,c,d){let e=a.getDay(),f=(e-d.weekStartsOn+8)%7||7;switch(b){case"c":return String(f);case"cc":return g7(f,b.length);case"co":return c.ordinalNumber(f,{unit:"day"});case"ccc":return c.day(e,{width:"abbreviated",context:"standalone"});case"ccccc":return c.day(e,{width:"narrow",context:"standalone"});case"cccccc":return c.day(e,{width:"short",context:"standalone"});default:return c.day(e,{width:"wide",context:"standalone"})}},i:function(a,b,c){let d=a.getDay(),e=0===d?7:d;switch(b){case"i":return String(e);case"ii":return g7(e,b.length);case"io":return c.ordinalNumber(e,{unit:"day"});case"iii":return c.day(d,{width:"abbreviated",context:"formatting"});case"iiiii":return c.day(d,{width:"narrow",context:"formatting"});case"iiiiii":return c.day(d,{width:"short",context:"formatting"});default:return c.day(d,{width:"wide",context:"formatting"})}},a:function(a,b,c){let d=a.getHours()/12>=1?"pm":"am";switch(b){case"a":case"aa":return c.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return c.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return c.dayPeriod(d,{width:"narrow",context:"formatting"});default:return c.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(a,b,c){let d,e=a.getHours();switch(d=12===e?g9.noon:0===e?g9.midnight:e/12>=1?"pm":"am",b){case"b":case"bb":return c.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return c.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return c.dayPeriod(d,{width:"narrow",context:"formatting"});default:return c.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(a,b,c){let d,e=a.getHours();switch(d=e>=17?g9.evening:e>=12?g9.afternoon:e>=4?g9.morning:g9.night,b){case"B":case"BB":case"BBB":return c.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return c.dayPeriod(d,{width:"narrow",context:"formatting"});default:return c.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(a,b,c){if("ho"===b){let b=a.getHours()%12;return 0===b&&(b=12),c.ordinalNumber(b,{unit:"hour"})}return g8.h(a,b)},H:function(a,b,c){return"Ho"===b?c.ordinalNumber(a.getHours(),{unit:"hour"}):g8.H(a,b)},K:function(a,b,c){let d=a.getHours()%12;return"Ko"===b?c.ordinalNumber(d,{unit:"hour"}):g7(d,b.length)},k:function(a,b,c){let d=a.getHours();return(0===d&&(d=24),"ko"===b)?c.ordinalNumber(d,{unit:"hour"}):g7(d,b.length)},m:function(a,b,c){return"mo"===b?c.ordinalNumber(a.getMinutes(),{unit:"minute"}):g8.m(a,b)},s:function(a,b,c){return"so"===b?c.ordinalNumber(a.getSeconds(),{unit:"second"}):g8.s(a,b)},S:function(a,b){return g8.S(a,b)},X:function(a,b,c){let d=a.getTimezoneOffset();if(0===d)return"Z";switch(b){case"X":return hc(d);case"XXXX":case"XX":return hd(d);default:return hd(d,":")}},x:function(a,b,c){let d=a.getTimezoneOffset();switch(b){case"x":return hc(d);case"xxxx":case"xx":return hd(d);default:return hd(d,":")}},O:function(a,b,c){let d=a.getTimezoneOffset();switch(b){case"O":case"OO":case"OOO":return"GMT"+hb(d,":");default:return"GMT"+hd(d,":")}},z:function(a,b,c){let d=a.getTimezoneOffset();switch(b){case"z":case"zz":case"zzz":return"GMT"+hb(d,":");default:return"GMT"+hd(d,":")}},t:function(a,b,c){return g7(Math.trunc(a/1e3),b.length)},T:function(a,b,c){return g7(+a,b.length)}};function hb(a,b=""){let c=a>0?"-":"+",d=Math.abs(a),e=Math.trunc(d/60),f=d%60;return 0===f?c+String(e):c+String(e)+b+g7(f,2)}function hc(a,b){return a%60==0?(a>0?"-":"+")+g7(Math.abs(a)/60,2):hd(a,b)}function hd(a,b=""){let c=Math.abs(a);return(a>0?"-":"+")+g7(Math.trunc(c/60),2)+b+g7(c%60,2)}let he=(a,b)=>{switch(a){case"P":return b.date({width:"short"});case"PP":return b.date({width:"medium"});case"PPP":return b.date({width:"long"});default:return b.date({width:"full"})}},hf=(a,b)=>{switch(a){case"p":return b.time({width:"short"});case"pp":return b.time({width:"medium"});case"ppp":return b.time({width:"long"});default:return b.time({width:"full"})}},hg={p:hf,P:(a,b)=>{let c,d=a.match(/(P+)(p+)?/)||[],e=d[1],f=d[2];if(!f)return he(a,b);switch(e){case"P":c=b.dateTime({width:"short"});break;case"PP":c=b.dateTime({width:"medium"});break;case"PPP":c=b.dateTime({width:"long"});break;default:c=b.dateTime({width:"full"})}return c.replace("{{date}}",he(e,b)).replace("{{time}}",hf(f,b))}},hh=/^D+$/,hi=/^Y+$/,hj=["D","DD","YY","YYYY"],hk=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,hl=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,hm=/^'([^]*?)'?$/,hn=/''/g,ho=/[a-zA-Z]/;function hp(a,b,c){let d=c?.locale??gZ.locale??gY,e=c?.firstWeekContainsDate??c?.locale?.options?.firstWeekContainsDate??gZ.firstWeekContainsDate??gZ.locale?.options?.firstWeekContainsDate??1,f=c?.weekStartsOn??c?.locale?.options?.weekStartsOn??gZ.weekStartsOn??gZ.locale?.options?.weekStartsOn??0,g=g0(a,c?.in);if(!(g instanceof Date||"object"==typeof g&&"[object Date]"===Object.prototype.toString.call(g))&&"number"!=typeof g||isNaN(+g0(g)))throw RangeError("Invalid time value");let h=b.match(hl).map(a=>{let b=a[0];return"p"===b||"P"===b?(0,hg[b])(a,d.formatLong):a}).join("").match(hk).map(a=>{if("''"===a)return{isToken:!1,value:"'"};let b=a[0];if("'"===b)return{isToken:!1,value:function(a){let b=a.match(hm);return b?b[1].replace(hn,"'"):a}(a)};if(ha[b])return{isToken:!0,value:a};if(b.match(ho))throw RangeError("Format string contains an unescaped latin alphabet character `"+b+"`");return{isToken:!1,value:a}});d.localize.preprocessor&&(h=d.localize.preprocessor(g,h));let i={firstWeekContainsDate:e,weekStartsOn:f,locale:d};return h.map(e=>{if(!e.isToken)return e.value;let f=e.value;return(!c?.useAdditionalWeekYearTokens&&hi.test(f)||!c?.useAdditionalDayOfYearTokens&&hh.test(f))&&function(a,b,c){let d=function(a,b,c){let d="Y"===a[0]?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${b}\`) for formatting ${d} to the input \`${c}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(a,b,c);if(console.warn(d),hj.includes(a))throw RangeError(d)}(f,b,String(a)),(0,ha[f[0]])(g,f,d.localize,i)}).join("")}function hq(a,b,c){let d=g0(a,c?.in);return isNaN(b)?g_(c?.in||a,NaN):(b&&d.setDate(d.getDate()+b),d)}let hr=[{patterns:[/how many (total\s+)?guests?/i,/count (all\s+)?guests?/i,/total (number of\s+)?guests?/i],handler:async(a,b)=>{let{count:c,error:d}=await b.from("guests").select("*",{count:"exact",head:!0}).is("deleted_at",null);if(d)throw d;return{message:`There are **${c||0} guests** registered in the system.`,metadata:{queryType:"count",resultCount:c||0}}}},{patterns:[/(?:who|guests?|how many).*arriv(?:ing|e|al).*today/i,/today['s]?\s+arrivals?/i],handler:async(a,b)=>{let c=hp(new Date,"yyyy-MM-dd"),{data:d,count:e,error:f}=await b.from("guests").select("first_name, last_name, arrival_time, arrival_flight_number, arrival_airport",{count:"exact"}).eq("arrival_date",c).is("deleted_at",null).order("arrival_time");if(f)throw f;if(!d||0===d.length)return{message:`No guests are arriving today (${hp(new Date,"MMMM d, yyyy")}).`,metadata:{queryType:"list",resultCount:0}};let g=d.map((a,b)=>`${b+1}. **${a.first_name} ${a.last_name}** - ${a.arrival_time||"Time TBD"}${a.arrival_flight_number?` (${a.arrival_flight_number})`:""}`).join("\n");return{message:`**${e} guest${1!==e?"s":""} arriving today** (${hp(new Date,"MMMM d, yyyy")}):

${g}`,metadata:{queryType:"list",resultCount:e||0}}}},{patterns:[/(?:who|guests?|how many).*arriv(?:ing|e|al).*tomorrow/i,/tomorrow['s]?\s+arrivals?/i],handler:async(a,b)=>{let c=hp(hq(new Date,1),"yyyy-MM-dd"),{data:d,count:e,error:f}=await b.from("guests").select("first_name, last_name, arrival_time, arrival_flight_number",{count:"exact"}).eq("arrival_date",c).is("deleted_at",null).order("arrival_time");if(f)throw f;if(!d||0===d.length)return{message:`No guests are arriving tomorrow (${hp(hq(new Date,1),"MMMM d, yyyy")}).`,metadata:{queryType:"list",resultCount:0}};let g=d.slice(0,10).map((a,b)=>`${b+1}. **${a.first_name} ${a.last_name}** - ${a.arrival_time||"Time TBD"}${a.arrival_flight_number?` (${a.arrival_flight_number})`:""}`).join("\n"),h=e&&e>10?`

_...and ${e-10} more_`:"";return{message:`**${e} guest${1!==e?"s":""} arriving tomorrow** (${hp(hq(new Date,1),"MMMM d, yyyy")}):

${g}${h}`,metadata:{queryType:"list",resultCount:e||0}}}},{patterns:[/(?:who|guests?|how many).*depart(?:ing|ure).*today/i,/today['s]?\s+departures?/i],handler:async(a,b)=>{let c=hp(new Date,"yyyy-MM-dd"),{data:d,count:e,error:f}=await b.from("guests").select("first_name, last_name, departure_time, departure_flight_number",{count:"exact"}).eq("departure_date",c).is("deleted_at",null).order("departure_time");if(f)throw f;if(!d||0===d.length)return{message:`No guests are departing today (${hp(new Date,"MMMM d, yyyy")}).`,metadata:{queryType:"list",resultCount:0}};let g=d.map((a,b)=>`${b+1}. **${a.first_name} ${a.last_name}** - ${a.departure_time||"Time TBD"}${a.departure_flight_number?` (${a.departure_flight_number})`:""}`).join("\n");return{message:`**${e} guest${1!==e?"s":""} departing today** (${hp(new Date,"MMMM d, yyyy")}):

${g}`,metadata:{queryType:"list",resultCount:e||0}}}},{patterns:[/(?:who|guests?|how many).*need.*transfer/i,/transfer.*(?:list|needs?)/i,/airport.*(?:pickup|transfer)/i],handler:async(a,b)=>{let{data:c,count:d,error:e}=await b.from("guests").select("first_name, last_name, arrival_date, arrival_time, departure_date, departure_time, needs_arrival_transfer, needs_departure_transfer",{count:"exact"}).is("deleted_at",null).or("needs_arrival_transfer.eq.true,needs_departure_transfer.eq.true").order("arrival_date");if(e)throw e;if(!c||0===c.length)return{message:"No guests currently need airport transfer.",metadata:{queryType:"list",resultCount:0}};let f=c.filter(a=>a.needs_arrival_transfer),g=c.filter(a=>a.needs_departure_transfer),h=`**${d} guest${1!==d?"s":""} need transfer**

`;return f.length>0&&(h+=`**Arrival transfers (${f.length}):**
`,h+=f.slice(0,5).map((a,b)=>`${b+1}. ${a.first_name} ${a.last_name}${a.arrival_date?` - ${a.arrival_date}`:""}`).join("\n"),f.length>5&&(h+=`
_...and ${f.length-5} more_`),h+="\n\n"),g.length>0&&(h+=`**Departure transfers (${g.length}):**
`,h+=g.slice(0,5).map((a,b)=>`${b+1}. ${a.first_name} ${a.last_name}${a.departure_date?` - ${a.departure_date}`:""}`).join("\n"),g.length>5&&(h+=`
_...and ${g.length-5} more_`)),{message:h,metadata:{queryType:"list",resultCount:d||0}}}},{patterns:[/registration.*status/i,/status.*breakdown/i,/(?:confirmed|pending|cancelled).*guests?/i],handler:async(a,b)=>{let{data:c,error:d}=await b.from("guests").select("registration_status").is("deleted_at",null);if(d)throw d;let e={confirmed:0,pending:0,cancelled:0,waitlisted:0};(c||[]).forEach(a=>{let b=a.registration_status;b in e&&e[b]++});let f=Object.values(e).reduce((a,b)=>a+b,0);return{message:`**Registration Status Summary**

Total: ${f} guests

- **Confirmed:** ${e.confirmed} (${f>0?Math.round(e.confirmed/f*100):0}%)
- **Pending:** ${e.pending} (${f>0?Math.round(e.pending/f*100):0}%)
- **Cancelled:** ${e.cancelled} (${f>0?Math.round(e.cancelled/f*100):0}%)
- **Waitlisted:** ${e.waitlisted} (${f>0?Math.round(e.waitlisted/f*100):0}%)`,metadata:{queryType:"stats",resultCount:f}}}},{patterns:[/find\s+(?:guest\s+)?(.+)/i,/search\s+(?:for\s+)?(?:guest\s+)?(.+)/i,/who\s+is\s+(.+)/i,/show\s+(?:me\s+)?(.+?)(?:'s)?\s+(?:info|details|information)/i],handler:async(a,b)=>{let c=a[1]?.trim();if(!c||c.length<2)return{message:"Please provide a name to search for.",metadata:{queryType:"search",resultCount:0}};let{data:d,error:e}=await b.from("guests").select("*").is("deleted_at",null).or(`first_name.ilike.%${c}%,last_name.ilike.%${c}%,email.ilike.%${c}%`).limit(10);if(e)throw e;if(!d||0===d.length)return{message:`No guests found matching "${c}". Try a different spelling or search term.`,metadata:{queryType:"search",resultCount:0}};if(1===d.length){let a=d[0];return{message:`**${a.first_name} ${a.last_name}**

- **Email:** ${a.email}
- **Status:** ${a.registration_status||"Unknown"}
- **Department:** ${a.reporting_level_1||"N/A"}
- **Arrival:** ${a.arrival_date||"N/A"}${a.arrival_time?` at ${a.arrival_time}`:""}${a.arrival_flight_number?` (${a.arrival_flight_number})`:""}
- **Departure:** ${a.departure_date||"N/A"}${a.departure_time?` at ${a.departure_time}`:""}${a.departure_flight_number?` (${a.departure_flight_number})`:""}
- **Hotel:** ${a.hotel_checkin_date?`${a.hotel_checkin_date} to ${a.hotel_checkout_date}`:"N/A"}
- **Transfer needed:** ${a.needs_arrival_transfer?"Arrival ":""}${a.needs_departure_transfer?"Departure":""}${!a.needs_arrival_transfer&&!a.needs_departure_transfer?"No":""}`,metadata:{queryType:"search",resultCount:1}}}let f=d.map((a,b)=>`${b+1}. **${a.first_name} ${a.last_name}** (${a.email}) - ${a.registration_status||"Unknown status"}`).join("\n");return{message:`Found **${d.length} guests** matching "${c}":

${f}

_Ask me about a specific guest for more details._`,metadata:{queryType:"search",resultCount:d.length}}}},{patterns:[/(?:list|show|all).*vehicles?/i,/what vehicles?.*(?:available|have)/i,/vehicle.*(?:list|info)/i],handler:async(a,b)=>{let{data:c,count:d,error:e}=await b.from("vehicles").select("*",{count:"exact"}).eq("is_active",!0).order("name");if(e)throw e;if(!c||0===c.length)return{message:"No active vehicles in the system.",metadata:{queryType:"list",resultCount:0}};let f=c.map((a,b)=>`${b+1}. **${a.name}** (${a.type}) - Capacity: ${a.capacity}${a.driver_name?` | Driver: ${a.driver_name}`:""}`).join("\n");return{message:`**${d} Active Vehicle${1!==d?"s":""}**

${f}`,metadata:{queryType:"list",resultCount:d||0}}}},{patterns:[/(?:guests?|breakdown|list).*(?:by\s+)?(?:department|team|reporting)/i,/department.*(?:breakdown|summary)/i],handler:async(a,b)=>{let{data:c,error:d}=await b.from("guests").select("reporting_level_1").is("deleted_at",null);if(d)throw d;let e={};(c||[]).forEach(a=>{let b=a.reporting_level_1||"Unassigned";e[b]=(e[b]||0)+1});let f=Object.entries(e).sort((a,b)=>b[1]-a[1]),g=f.reduce((a,[,b])=>a+b,0),h=f.map(([a,b],c)=>`${c+1}. **${a}:** ${b} (${Math.round(b/g*100)}%)`).join("\n");return{message:`**Guests by Department**

Total: ${g}

${h}`,metadata:{queryType:"stats",resultCount:g}}}}];class hs{constructor(a){this.supabase=a.supabase,this.useAI=!1!==a.useAI&&!!process.env.OPENROUTER_API_KEY,this.useMcpTools=!1!==a.useMcpTools&&!!process.env.OPENROUTER_API_KEY}async processMessage(a,b=[]){let c=a.trim().toLowerCase();if(/^(hi|hello|hey|good\s+(morning|afternoon|evening)|greetings|what can you do|help)$/i.test(c)){if(this.useMcpTools)try{return{message:await gR(a)}}catch(a){console.error("MCP greeting error:",a)}else if(this.useAI)try{return{message:await gF(a)}}catch(a){console.error("AI greeting error:",a)}return{message:gv.greeting}}if(this.useMcpTools)try{return await this.processWithMcpTools(a,b)}catch(a){console.error("MCP tools error:",a)}if(this.useAI)try{return await this.processWithAI(a,b)}catch(a){console.error("AI processing error:",a)}for(let{patterns:b,handler:c}of hr)for(let d of b){let b=a.match(d);if(b)try{return await c(b,this.supabase)}catch(a){console.error("Pattern handler error:",a);break}}return{message:'I\'m not sure how to answer that question. Here are some things you can ask me:\n\n- **Guest counts:** "How many guests total?"\n- **Arrivals/Departures:** "Who\'s arriving today?" or "Tomorrow\'s departures"\n- **Find guests:** "Find John Smith" or "Search for engineering"\n- **Transfers:** "Who needs airport transfer?"\n- **Status:** "Registration status breakdown"\n- **Vehicles:** "List all vehicles"\n- **Departments:** "Guests by department"'}}async processWithMcpTools(a,b){console.log("[MCP Tools] Processing message:",a);let{response:c,toolsUsed:d}=await gP(a,this.supabase);return console.log("[MCP Tools] Tools used:",d),console.log("[MCP Tools] Response:",c.substring(0,200)+"..."),{message:c,metadata:{queryType:d.length>0?"tool_call":"conversation",toolsUsed:d}}}async processWithAI(a,b){let c=await gD(a);if(console.log("AI Generated Query:",c.query),console.log("Query Explanation:",c.explanation),!c.query)return{message:await gF(a)};let d=function(a){let b=[],c=a.toUpperCase().trim();if(!c.startsWith("SELECT"))return b.push("Only SELECT queries are allowed"),{isValid:!1,errors:b};let d=c.replace(/DELETED_AT/g,"COL_PLACEHOLDER").replace(/IS_DELETED/g,"COL_PLACEHOLDER").replace(/IS_REMOVED/g,"COL_PLACEHOLDER").replace(/CREATED_AT/g,"COL_PLACEHOLDER").replace(/UPDATED_AT/g,"COL_PLACEHOLDER");for(let a of gy)RegExp(`\\b${a}\\b`,"i").test(d)&&b.push(`Dangerous keyword detected: ${a}`);for(let c of gz)a.includes(c)&&b.push(`Dangerous character sequence detected: ${c}`);for(let c of gA)if(c.test(a)){b.push("Dangerous pattern detected in query");break}for(let c of[...a.match(/FROM\s+(\w+)/gi)||[],...a.match(/JOIN\s+(\w+)/gi)||[]]){let a=c.replace(/^(FROM|JOIN)\s+/i,"").toLowerCase();gw.includes(a)||b.push(`Table not allowed: ${a}`)}let e=a.match(/SELECT\s+([\s\S]+?)\s+FROM/i);if(e){let a=e[1];if("*"!==a.trim())for(let c of a.split(",").map(a=>a.trim())){let a=c.replace(/\s+AS\s+\w+/i,"").replace(/^\w+\./,"").replace(/COUNT\s*\(\s*\*?\s*\)/i,"count").replace(/SUM\s*\(\s*\w+\s*\)/i,"sum").replace(/AVG\s*\(\s*\w+\s*\)/i,"avg").replace(/MAX\s*\(\s*\w+\s*\)/i,"max").replace(/MIN\s*\(\s*\w+\s*\)/i,"min").toLowerCase().trim();!["count","sum","avg","max","min","*"].includes(a)&&(Object.values(gx).some(b=>b.includes(a))||!(a.length>0)||a.includes("(")||b.push(`Column not allowed: ${a}`))}}let f=a;if(a.toLowerCase().includes("limit")){let b=a.match(/LIMIT\s+(\d+)/i);b&&parseInt(b[1])>1e3&&(f=a.replace(/LIMIT\s+\d+/i,"LIMIT 1000"))}else f=`${a.trim()} LIMIT 100`;return{isValid:0===b.length,errors:b,sanitizedQuery:0===b.length?f:void 0}}(c.query);if(!d.isValid)return console.error("Generated query failed validation:",c.query),{message:await gF(a)};try{let{data:b,error:e}=await this.supabase.rpc("execute_readonly_query",{query_text:d.sanitizedQuery||c.query});if(e){if(console.error("Query execution error:",e),c.query.toLowerCase().includes("count(*)")){let b=c.query.match(/from\s+(\w+)/i);if(b){let d=b[1],{count:e,error:f}=await this.supabase.from(d).select("*",{count:"exact",head:!0});if(!f&&null!==e)return{message:(await gE(a,[{count:e}],c.explanation)).response,metadata:{queryType:"count",executedQuery:c.query,resultCount:e}}}}return{message:await gF(`I tried to answer "${a}" but couldn't execute the database query. Please suggest alternative ways to ask this question.`),metadata:{error:e.message}}}return{message:(await gE(a,b,c.explanation)).response,metadata:{queryType:this.inferQueryType(c.query),executedQuery:c.query,resultCount:Array.isArray(b)?b.length:1}}}catch(b){return console.error("Query execution error:",b),{message:await gF(a),metadata:{error:b instanceof Error?b.message:"Unknown error"}}}}inferQueryType(a){let b=a.toLowerCase();return b.includes("count(")?"count":b.includes("group by")?"stats":b.includes("where")&&(b.includes("ilike")||b.includes("like"))?"search":"list"}formatQueryResults(a,b){if(!a||0===a.length)return{message:gv.noResults,metadata:{queryType:"unknown",executedQuery:b,resultCount:0}};if(1===a.length&&"object"==typeof a[0]){let b=a[0];if("count"in b)return{message:`The count is **${b.count}**.`,metadata:{queryType:"count",resultCount:Number(b.count)}}}let c=a.slice(0,20).map((a,b)=>{let c=a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.name||a.email||`Item ${b+1}`;return`${b+1}. **${c}**`}).join("\n"),d=a.length>20?`

_...and ${a.length-20} more_`:"";return{message:`Found **${a.length} results**:

${c}${d}`,metadata:{queryType:"list",resultCount:a.length}}}}let ht=fh({message:eK().min(1).max(2e3),sessionId:eK().optional()}),hu=fh({sessionId:eK()}),hv=fh({sessionId:eK().optional()}),hw={default:"Hello! I'm your Axis Event Tracker assistant. I can help you with:\n- Finding guest information\n- Checking arrival and departure schedules\n- Transport and vehicle assignments\n- Event statistics and summaries\n\nWhat would you like to know?",guests:"There are **42 guests** registered in the system.\n\n- **Confirmed:** 35 (83%)\n- **Pending:** 5 (12%)\n- **Cancelled:** 2 (5%)",arriving:"**3 guests arriving today** (November 27, 2025):\n\n1. **Sarah Johnson** - 14:30 (AA123)\n2. **Michael Chen** - 16:45 (UA456)\n3. **Emma Williams** - 18:20 (DL789)",transfer:"**8 guests need transfer**\n\n**Arrival transfers (5):**\n1. Sarah Johnson - Nov 27\n2. Michael Chen - Nov 27\n3. David Brown - Nov 28\n4. Lisa Anderson - Nov 28\n5. James Wilson - Nov 29\n\n**Departure transfers (3):**\n1. Emma Williams - Nov 30\n2. Robert Taylor - Dec 1\n3. Jennifer Davis - Dec 1",vehicles:"**3 Active Vehicles**\n\n1. **Mercedes Sprinter** (Van) - Capacity: 12 | Driver: John Driver\n2. **Toyota Hiace** (Van) - Capacity: 8 | Driver: Mike Smith\n3. **Lincoln Navigator** (SUV) - Capacity: 6 | Driver: Bob Johnson"},hx=bP({sendMessage:bS.input(ht).mutation(async({ctx:a,input:b})=>{let{message:c,sessionId:d=`session-${Date.now()}`}=b;if(a.isDemoMode||!a.supabase)return{response:function(a){let b=a.toLowerCase();return/how many.*guests?|count.*guests?|total.*guests?/i.test(b)?hw.guests:/arriv.*today|today.*arriv/i.test(b)?hw.arriving:/transfer|pickup/i.test(b)?hw.transfer:/vehicle/i.test(b)?hw.vehicles:/^(hi|hello|hey|help)/i.test(b)?hw.default:'I can help you with guest information, arrivals, departures, transfers, and vehicle assignments. Try asking:\n- "How many guests?"\n- "Who\'s arriving today?"\n- "Who needs transfer?"\n- "List all vehicles"'}(c),sessionId:d,metadata:{queryType:"unknown",isDemoMode:!0}};try{var e;let b=(e=a.supabase,new hs({supabase:e})),f=[];if(a.db){let b=await a.db.query.chatbotConversations.findFirst({where:(0,fD.eq)(fC.chatbotConversations.sessionId,d),with:{messages:{orderBy:(0,fG.i)(fC.chatbotMessages.createdAt),limit:10}}});b?.messages&&(f=b.messages.reverse().map(a=>({role:a.role,content:a.content})))}let g=await b.processMessage(c,f);if(a.db)try{let b=await a.db.query.chatbotConversations.findFirst({where:(0,fD.eq)(fC.chatbotConversations.sessionId,d)});if(!b){let[e]=await a.db.insert(fC.chatbotConversations).values({sessionId:d,userId:a.user?.id,title:c.slice(0,100)}).returning();b=e}await a.db.insert(fC.chatbotMessages).values({conversationId:b.id,role:"user",content:c}),await a.db.insert(fC.chatbotMessages).values({conversationId:b.id,role:"assistant",content:g.message,metadata:g.metadata})}catch(a){console.error("Error storing conversation:",a)}return{response:g.message,sessionId:d,metadata:g.metadata}}catch(a){return console.error("Chatbot error:",a),{response:"I'm sorry, I encountered an error processing your request. Please try again.",sessionId:d,metadata:{error:a instanceof Error?a.message:"Unknown error"}}}}),getConversation:bS.input(hu).query(async({ctx:a,input:b})=>{if(a.isDemoMode||!a.db)return{messages:[],sessionId:b.sessionId};let c=await a.db.query.chatbotConversations.findFirst({where:(0,fD.eq)(fC.chatbotConversations.sessionId,b.sessionId),with:{messages:{orderBy:(0,fG.i)(fC.chatbotMessages.createdAt),limit:50}}});return c?{messages:c.messages.reverse().map(a=>({id:a.id,role:a.role,content:a.content,createdAt:a.createdAt})),sessionId:b.sessionId}:{messages:[],sessionId:b.sessionId}}),getConversations:bS.query(async({ctx:a})=>a.isDemoMode||!a.db?[]:(await a.db.query.chatbotConversations.findMany({where:a.user?.id?(0,fD.eq)(fC.chatbotConversations.userId,a.user.id):void 0,orderBy:(0,fG.i)(fC.chatbotConversations.updatedAt),limit:20})).map(a=>({id:a.id,sessionId:a.sessionId,title:a.title||"Untitled conversation",createdAt:a.createdAt,updatedAt:a.updatedAt}))),clearHistory:bS.input(hv).mutation(async({ctx:a,input:b})=>{if(a.isDemoMode||!a.db)return{success:!0};if(b.sessionId){let c=await a.db.query.chatbotConversations.findFirst({where:(0,fD.eq)(fC.chatbotConversations.sessionId,b.sessionId)});c&&(await a.db.delete(fC.chatbotMessages).where((0,fD.eq)(fC.chatbotMessages.conversationId,c.id)),await a.db.delete(fC.chatbotConversations).where((0,fD.eq)(fC.chatbotConversations.id,c.id)))}else if(a.user?.id)for(let b of(await a.db.query.chatbotConversations.findMany({where:(0,fD.eq)(fC.chatbotConversations.userId,a.user.id)})))await a.db.delete(fC.chatbotMessages).where((0,fD.eq)(fC.chatbotMessages.conversationId,b.id)),await a.db.delete(fC.chatbotConversations).where((0,fD.eq)(fC.chatbotConversations.id,b.id));return{success:!0}})}),hy=bP({guests:fN,transport:fZ,audit:f_,import:f4,flights:gu,chatbot:hx}),hz=a=>bs({endpoint:"/api/trpc",req:a,router:hy,createContext:bN}),hA=new m.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/trpc/[trpc]/route",pathname:"/api/trpc/[trpc]",filename:"route",bundlePath:"app/api/trpc/[trpc]/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/baito.kevin/Downloads/dev/BMAD-METHOD/Axis/axis-event-tracker/src/app/api/trpc/[trpc]/route.ts",nextConfigOutput:"standalone",userland:l}),{workAsyncStorage:hB,workUnitAsyncStorage:hC,serverHooks:hD}=hA;function hE(){return(0,o.patchFetch)({workAsyncStorage:hB,workUnitAsyncStorage:hC})}async function hF(a,b,c){var d;let e="/api/trpc/[trpc]/route";"/index"===e&&(e="/");let f=await hA.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:o,resolvedPathname:C}=f,D=(0,r.normalizeAppPath)(e),E=!!(k.dynamicRoutes[D]||k.routes[C]);if(E&&!j){let a=!!k.routes[C],b=k.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new A.NoFallbackError}let F=null;!E||hA.isDev||j||(F="/index"===(F=C)?"/":F);let G=!0===hA.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,q.getTracer)(),K=J.getActiveScopeSpan(),L={params:h,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!i.experimental.cacheComponents,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,p.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>hA.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},M=new s.NodeNextRequest(a),N=new s.NodeNextResponse(b),O=t.NextRequestAdapter.fromNodeNextRequest(M,(0,t.signalFromNodeResponse)(b));try{let d=async c=>hA.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var g,h;let q=async({previousCacheEntry:g})=>{try{if(!(0,p.getRequestMeta)(a,"minimalMode")&&m&&o&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=L.renderOpts.collectedTags;if(!E)return await (0,w.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,x.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[z.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=z.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=z.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:B.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await hA.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,v.c)({isRevalidate:H,isOnDemandRevalidate:m})},l),b}},r=await hA.handleResponse({req:a,nextConfig:i,cacheKey:F,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:o,responseGenerator:q,waitUntil:c.waitUntil});if(!E)return null;if((null==r||null==(g=r.value)?void 0:g.kind)!==B.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==r||null==(h=r.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,p.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":r.isMiss?"MISS":r.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,x.fromNodeOutgoingHttpHeaders)(r.value.headers);return(0,p.getRequestMeta)(a,"minimalMode")&&E||s.delete(z.NEXT_CACHE_TAGS_HEADER),!r.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,y.getCacheControlHeader)(r.cacheControl)),await (0,w.I)(M,N,new Response(r.value.body,{headers:s,status:r.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(u.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:q.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(b instanceof A.NoFallbackError||await hA.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,v.c)({isRevalidate:H,isOnDemandRevalidate:m})}),E)throw b;return await (0,w.I)(M,N,new Response(null,{status:500})),null}}},95736:(a,b,c)=>{"use strict";a.exports=c(44870)},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[996,136,450],()=>b(b.s=91725));module.exports=c})();